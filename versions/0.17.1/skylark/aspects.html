<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Aspects - Bazel</title>

    <link rel="canonical" href="/versions/0.17.1/skylark/aspects.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700|Source+Code+Pro:400,500,700" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Aspects"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="012346921571893344015:xv_nfgpzbu4">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="page-title-bar">
      <div class="container">
        <h1>Documentation</h1>
      </div>
    </div>

    <div class="container vpad">
      <div class="row">
        <div class="col-md-3">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>
          <nav class="sidebar collapse" id="sidebar-nav">
           <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/skylark/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

           <h3>Using Bazel</h3>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                 </ul>
                </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#tutorials-menu" aria-expanded="false"
                    aria-controls="tutorials-menu">
                  Tutorials<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="tutorials-menu">
                   <li><a href="/versions/master/tutorial/java.html">Building a Java Project</a></li>
                   <li><a href="/versions/master/tutorial/cpp.html">Building a C++ Project</a></li>
                   <li><a href="/versions/master/tutorial/android-app.html">Building an Android App</a></li>
                   <li><a href="/versions/master/tutorial/ios-app.html">Building an iOS App</a></li>
                   <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                   <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
              <li><a href="/versions/master/guide.html">User's Guide</a></li>
              <li><a href="/versions/master/external.html">External Dependencies</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/user-manual.html#aquery">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
              <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/remote-caching.html">Remote Caching</a></li>
             </ul>

           <h3>Rules</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/be/overview.html">Build Encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/master/bazel-and-android.html">Android Resources</a></li>
                  <li><a href="/versions/master/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/master/android-instrumentation-test.html">Android Instrumentation Tests</a></li>
                  <li><a href="/versions/master/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio Plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/master/bazel-and-apple.html">Apple Resources</a></li>
                  <li><a href="/versions/master/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/master/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/master/bazel-and-cpp.html">C++ Resources</a></li>
                  <li><a href="/versions/master/cpp-use-cases.html">C++ Use Cases</a></li>
                  <li><a href="/versions/master/crosstool-reference.html">Understanding CROSSTOOL</a></li>
                  <li><a href="/versions/master/tutorial/crosstool.html">Tutorial: CROSSTOOL</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/master/bazel-and-java.html">Java Resources</a></li>
                  <li><a href="/versions/master/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/master/generate-workspace.html">Converting Maven Dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/master/bazel-and-javascript.html">JavaScript Resources</a></li>
                  <li><a href="/versions/master/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="/versions/master/skylark/skylint.html">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-9">
          <a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a>
          <script>
            var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
            var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
            var editButton = document.getElementById('gh-edit');
            // if there is an edit button and we are not in the Build Encyclopedia
            if (editButton
                && window.location.pathname.match(versionDocsURLRegex)
                && window.location.pathname.lastIndexOf('/be/') == -1
                && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
              var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
              // some pages are not using markdown :(
              if (docFile !== 'user-manual.html'
                  && docFile !== 'build-ref.html'
                  && docFile !== 'query.html'
                  && docFile !== 'test-encyclopedia.html') {
                docFile = docFile.replace('html', 'md');
              }
              editButton.href = ghDocsBazeURL + docFile;
              editButton.style.visibility = 'visible';
            }
          </script>

          <h1 id="aspects">Aspects</h1>

<!-- [TOC] -->

<p><strong>Status: Experimental</strong>. We may make breaking changes to the API, but we will
announce them.</p>

<p>Aspects allow augmenting build dependency graphs with additional information
and actions. Some typical scenarios when aspects can be useful:</p>

<ul>
  <li>IDEs that integrate Bazel can use aspects to collect information about the
project.</li>
  <li>Code generation tools can leverage aspects to execute on their inputs in
“target-agnostic” manner. As an example, BUILD files can specify a hierarchy
of <a href="https://developers.google.com/protocol-buffers/">protobuf</a> library
definitions, and language-specific rules can use aspects to attach
actions generating protobuf support code for a particular language.</li>
</ul>

<h2 id="aspect-basics">Aspect basics</h2>

<p>Bazel BUILD files provide a description of a project’s source code: what source
files are part of the project, what artifacts (<em>targets</em>) should be built from
those files, what the dependencies between those files are, etc. Bazel uses
this information to perform a build, that is, it figures out the set of actions
needed to produce the artifacts (such as running compiler or linker) and
executes those actions. Bazel accomplishes this by constructing a <em>dependency
graph</em> between targets and visiting this graph to collect those actions.</p>

<p>Consider the following BUILD file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'W'</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Y'</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">':W'</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Z'</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">':W'</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Q'</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'T'</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">':Q'</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">'X'</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">':Y'</span><span class="p">,</span><span class="s">':Z'</span><span class="p">],</span> <span class="n">runtime_deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">':T'</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>This BUILD file defines a dependency graph shown in the following figure:</p>

<p><img src="build-graph.png" alt="Build Graph" width="250px" /></p>

<p>Bazel analyzes this dependency graph by calling an implementation function of
the corresponding <a href="rules.html">rule</a> (in this case “java_library”) for every
target in the above example. Rule implementation functions generate actions that
build artifacts, such as <code class="highlighter-rouge">.jar</code> files, and pass information, such as locations
and names of those artifacts, to the dependencies of those targets in
<a href="rules.html#providers">providers</a>.</p>

<p>Aspects are similar to rules in that they have an implementation function that
generates actions and returns providers. However, their power comes from
the way the dependency graph is built for them. An aspect has an implementation
and a list of all attributes it propagates along. Consider an aspect A that
propagates along attributes named “deps”. This aspect can be applied to
a target X, yielding an aspect application node A(X). During its application,
aspect A is applied recursively to all targets that X refers to in its “deps”
attribute (all attributes in A’s propagation list). Thus a single act of
applying aspect A to a target X yields a “shadow graph” of the original
dependency graph of targets (see Fig.2).</p>

<p><img src="build-graph-aspects.png" alt="Build Graph with Aspect" /></p>

<p>The only edges that are shadowed are the edges along the attributes in
the propagation set, thus the <code class="highlighter-rouge">runtime_deps</code> edge is not shadowed in this
example. An aspect implementation function is then invoked on all nodes in
the shadow graph similar to how rule implementations are invoked on the nodes
of the original graph.</p>

<h2 id="simple-example">Simple example</h2>

<p>This example demonstrates how to recursively print the source files for a
rule and all of its dependencies that have a <code class="highlighter-rouge">deps</code> attribute. It shows
an aspect implementation, an aspect definition, and how to invoke the aspect
from the Bazel command line.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_print_aspect_impl</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="c"># Make sure the rule has a srcs attribute.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">'srcs'</span><span class="p">):</span>
        <span class="c"># Iterate through the files that make up the sources and</span>
        <span class="c"># print their paths.</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">srcs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="n">print_aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_print_aspect_impl</span><span class="p">,</span>
    <span class="n">attr_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="s">'deps'</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Let’s break the example up into its parts and examine each one individually.</p>

<h3 id="aspect-definition">Aspect definition</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print_aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_print_aspect_impl</span><span class="p">,</span>
    <span class="n">attr_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="s">'deps'</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>
<p>Aspect definitions are similar to rule definitions, and defined using
the <a href="lib/globals.html#aspect"><code class="highlighter-rouge">aspect</code></a> function.</p>

<p>Just like a rule, an aspect has an implementation function which in this case is
<code class="highlighter-rouge">_print_aspect_impl</code>.</p>

<p><code class="highlighter-rouge">attr_aspects</code> is a list of rule attributes along which the aspect propagates.
In this case, the aspect will propagate along the <code class="highlighter-rouge">deps</code> attribute of the
rules that it is applied to.</p>

<p>Another common argument for <code class="highlighter-rouge">attr_aspects</code> is <code class="highlighter-rouge">['*']</code> which would propagate the
aspect to all attributes of a rule.</p>

<h3 id="aspect-implementation">Aspect implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">_print_aspect_impl</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="c"># Make sure the rule has a srcs attribute.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">'srcs'</span><span class="p">):</span>
        <span class="c"># Iterate through the files that make up the sources and</span>
        <span class="c"># print their paths.</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">srcs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></div>

<p>Aspect implementation functions are similar to the rule implementation
functions. They return <a href="rules.html#providers">providers</a>, can generate
<a href="rules.html#actions">actions</a>, and take two arguments:</p>

<ul>
  <li><code class="highlighter-rouge">target</code>: the <a href="lib/Target.html">target</a> the aspect is being applied to.</li>
  <li><code class="highlighter-rouge">ctx</code>: <a href="lib/ctx.html"><code class="highlighter-rouge">ctx</code></a> object that can be used to access attributes
and generate outputs and actions.</li>
</ul>

<p>The implementation function can access the attributes of the target rule via
<a href="lib/ctx.html#rule"><code class="highlighter-rouge">ctx.rule.attr</code></a>. It can examine providers that are
provided by the target to which it is applied (via the <code class="highlighter-rouge">target</code> argument).</p>

<p>Aspects are required to return a list of providers. In this example, the aspect
does not provide anything, so it returns an empty list.</p>

<h3 id="invoking-the-aspect-using-the-command-line">Invoking the aspect using the command line</h3>

<p>The simplest way to apply an aspect is from the command line using the
<a href="https://docs.bazel.build/versions/master/command-line-reference.html#flag--aspects"><code class="highlighter-rouge">--aspects</code></a>
argument. Assuming the rule above were defined in a file named <code class="highlighter-rouge">print.bzl</code> this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //MyExample:example <span class="nt">--aspects</span> print.bzl%print_aspect
</code></pre></div></div>

<p>would apply the <code class="highlighter-rouge">print_aspect</code> to the target <code class="highlighter-rouge">example</code> and all of the
target rules that are accessible recursively via the <code class="highlighter-rouge">deps</code> attribute.</p>

<p>The <code class="highlighter-rouge">--aspects</code> flag takes one argument, which is a specification of the aspect
in the format <code class="highlighter-rouge">&lt;extension file label&gt;%&lt;aspect top-level name&gt;</code>.</p>

<h2 id="advanced-example">Advanced example</h2>

<p>The following example demonstrates using an aspect from a target rule
that counts files in targets, potentially filtering them by extension.
It shows how to use a provider to return values, how to use parameters to pass
an argument into an aspect implementation, and how to invoke an aspect from a rule.</p>

<p>FileCount.bzl file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FileCount</span> <span class="o">=</span> <span class="n">provider</span><span class="p">(</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'count'</span> <span class="p">:</span> <span class="s">'number of files'</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_file_count_aspect_impl</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># Make sure the rule has a srcs attribute.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">'srcs'</span><span class="p">):</span>
        <span class="c"># Iterate through the sources counting files</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">srcs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s">'*'</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">extension</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c"># Get the counts from our dependencies.</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">deps</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">dep</span><span class="p">[</span><span class="n">FileCount</span><span class="p">]</span><span class="o">.</span><span class="n">count</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">FileCount</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">)]</span>

<span class="n">file_count_aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">(</span><span class="n">implementation</span> <span class="o">=</span> <span class="n">_file_count_aspect_impl</span><span class="p">,</span>
    <span class="n">attr_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="s">'deps'</span><span class="p">],</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'extension'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s">'*'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'cc'</span><span class="p">]),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_file_count_rule_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">deps</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">FileCount</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

<span class="n">file_count_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_file_count_rule_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'deps'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label_list</span><span class="p">(</span><span class="n">aspects</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_count_aspect</span><span class="p">]),</span>
        <span class="s">'extension'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="s">'*'</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>BUILD.bazel file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">'//file_count.bzl'</span><span class="p">,</span> <span class="s">'file_count_rule'</span><span class="p">)</span>

<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'lib'</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">'lib.h'</span><span class="p">,</span>
        <span class="s">'lib.cc'</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'app'</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">'app.h'</span><span class="p">,</span>
        <span class="s">'app.cc'</span><span class="p">,</span>
        <span class="s">'main.cc'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">'lib'</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">file_count_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'file_count'</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">'app'</span><span class="p">],</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="s">'h'</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="aspect-definition-1">Aspect definition</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">file_count_aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">(</span><span class="n">implementation</span> <span class="o">=</span> <span class="n">_file_count_aspect_impl</span><span class="p">,</span>
    <span class="n">attr_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="s">'deps'</span><span class="p">],</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'extension'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s">'*'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'cc'</span><span class="p">]),</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>In this example, we are again propagating the aspect via the <code class="highlighter-rouge">deps</code> attribute.</p>

<p><code class="highlighter-rouge">attrs</code> defines a set of attributes for an aspect. Public aspect attributes
are of type <code class="highlighter-rouge">string</code> and are called parameters. Parameters must have a<code class="highlighter-rouge">values</code>
attribute specified on them. In this case we have a parameter called <code class="highlighter-rouge">extension</code>
that is allowed to have ‘<code class="highlighter-rouge">*</code>’, ‘<code class="highlighter-rouge">h</code>’, or ‘<code class="highlighter-rouge">cc</code>’ as a value.</p>

<p>Parameter values for the aspect are taken from the string attribute with the same
name of the rule requesting the aspect (see the definition of <code class="highlighter-rouge">file_count_rule</code>).
Aspects with parameters cannot be used via the command line because there is no
syntax to define the parameters.</p>

<p>Aspects are also allowed to have private attributes of types <code class="highlighter-rouge">label</code> or
<code class="highlighter-rouge">label_list</code>. Private label attributes can be used to specify dependencies on
tools or libraries that are needed for actions generated by aspects. There is not
a private attribute defined in this example, but the following code snippet
demonstrates how you could pass in a tool to a aspect:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'_protoc'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s">'//tools:protoc'</span><span class="p">),</span>
            <span class="n">executable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="s">"host"</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="o">...</span>
</code></pre></div></div>

<h3 id="aspect-implementation-1">Aspect implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FileCount</span> <span class="o">=</span> <span class="n">provider</span><span class="p">(</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'count'</span> <span class="p">:</span> <span class="s">'number of files'</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_file_count_aspect_impl</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># Make sure the rule has a srcs attribute.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">'srcs'</span><span class="p">):</span>
        <span class="c"># Iterate through the sources counting files</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">srcs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s">'*'</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">extension</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c"># Get the counts from our dependencies.</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">deps</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">dep</span><span class="p">[</span><span class="n">FileCount</span><span class="p">]</span><span class="o">.</span><span class="n">count</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">FileCount</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">)]</span>
</code></pre></div></div>

<p>Just like a rule implementation function, an aspect implementation function
returns a struct of providers that are accessible to its dependencies.</p>

<p>In this example, the <code class="highlighter-rouge">FileCount</code> is defined as a provider that has one field
<code class="highlighter-rouge">count</code>. It is best practice to explicitly define the fields of a provider
using the <code class="highlighter-rouge">fields</code> attribute.</p>

<p>The set of providers for an aspect application A(X) is the union of providers
that come from the implementation of a rule for target X and from
the implementation of aspect A. It is an error if a target and an aspect that
is applied to it each provide a provider with the same name. The providers that
a rule implementation propagates are created and frozen before aspects are
applied and cannot be modified from an aspect.</p>

<p>The parameters and private attributes are passed in the attributes of the
<code class="highlighter-rouge">ctx</code>. In this example, we reference the <code class="highlighter-rouge">extension</code> parameter to decide
what files to count.</p>

<p>For returning providers, the values of attributes along which
the aspect is propagated (from the <code class="highlighter-rouge">attr_aspect</code> list) are replaced with
the results of an application of the aspect to them. For example, if target
X has Y and Z in its deps, <code class="highlighter-rouge">ctx.rule.attr.deps</code> for A(X) will be [A(Y), A(Z)].
In this example, <code class="highlighter-rouge">ctx.rule.attr.deps</code> are Target objects that are the
results of applying the aspect to the ‘deps’ of the original target to which
the aspect has been applied.</p>

<p>In the example, the aspect to accesses the <code class="highlighter-rouge">FileCount</code> provider from the
target’s dependencies to accumulate the total transitive number of files.</p>

<h3 id="invoking-the-aspect-from-a-rule">Invoking the aspect from a rule</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_file_count_rule_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">deps</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">FileCount</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

<span class="n">file_count_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_file_count_rule_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'deps'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label_list</span><span class="p">(</span><span class="n">aspects</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_count_aspect</span><span class="p">]),</span>
        <span class="s">'extension'</span> <span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="s">'*'</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The rule implementation demonstrates how to access the <code class="highlighter-rouge">FileCount</code> via
the <code class="highlighter-rouge">ctx.attr.deps</code>.</p>

<p>The rule definition demonstrates how to define a parameter (<code class="highlighter-rouge">extension</code>)
and give it a default value (<code class="highlighter-rouge">*</code>). Note that having a default value that
was not one of ‘<code class="highlighter-rouge">cc</code>’, ‘<code class="highlighter-rouge">h</code>’, or ‘<code class="highlighter-rouge">*</code>’ would be an error due to the
restrictions placed on the parameter in the aspect definition.</p>

<h3 id="invoking-an-aspect-through-a-target-rule">Invoking an aspect through a target rule</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">'//file_count.bzl'</span><span class="p">,</span> <span class="s">'file_count_rule'</span><span class="p">)</span>

<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'app'</span><span class="p">,</span>
<span class="o">...</span>
<span class="p">)</span>

<span class="n">file_count_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'file_count'</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">'app'</span><span class="p">],</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="s">'h'</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This demonstrates how to pass the <code class="highlighter-rouge">extension</code> parameter into the aspect
via the rule. Since the <code class="highlighter-rouge">extension</code> parameter has a default value in the
rule implementation, <code class="highlighter-rouge">extension</code> would be considered an optional parameter.</p>

<p>When the <code class="highlighter-rouge">file_count</code> target is built, our aspect will be evaluated for
itself, and all of the targets accessible recursively via <code class="highlighter-rouge">deps</code>.</p>

        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=oohdpic4fyfp3jcnym6aqkdf3e"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2018 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

