<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configurable Build Attributes - Bazel</title>

    <link rel="canonical" href="/versions/master/configurable-attributes.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700|Source+Code+Pro:400,500,700" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Configurable Build Attributes"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="012346921571893344015:xv_nfgpzbu4">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="page-title-bar">
      <div class="container">
        <h1>Documentation</h1>
      </div>
    </div>

    <div class="container vpad">
      <div class="row">
        <div class="col-md-3">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>
          <nav class="sidebar collapse" id="sidebar-nav">
           <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/skylark/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

           <h3>Using Bazel</h3>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                 </ul>
                </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#tutorials-menu" aria-expanded="false"
                    aria-controls="tutorials-menu">
                  Tutorials<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="tutorials-menu">
                   <li><a href="/versions/master/tutorial/java.html">Building a Java Project</a></li>
                   <li><a href="/versions/master/tutorial/cpp.html">Building a C++ Project</a></li>
                   <li><a href="/versions/master/tutorial/android-app.html">Building an Android App</a></li>
                   <li><a href="/versions/master/tutorial/ios-app.html">Building an iOS App</a></li>
                   <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                   <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
              <li><a href="/versions/master/guide.html">User's Guide</a></li>
              <li><a href="/versions/master/external.html">External Dependencies</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/user-manual.html#aquery">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
              <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/remote-caching.html">Remote Caching</a></li>
             </ul>

           <h3>Rules</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/be/overview.html">Build Encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/master/bazel-and-android.html">Android Resources</a></li>
                  <li><a href="/versions/master/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/master/android-instrumentation-test.html">Android Instrumentation Tests</a></li>
                  <li><a href="/versions/master/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio Plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/master/bazel-and-apple.html">Apple Resources</a></li>
                  <li><a href="/versions/master/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/master/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/master/bazel-and-cpp.html">C++ Resources</a></li>
                  <li><a href="/versions/master/cpp-use-cases.html">C++ Use Cases</a></li>
                  <li><a href="/versions/master/crosstool-reference.html">Understanding CROSSTOOL</a></li>
                  <li><a href="/versions/master/tutorial/crosstool.html">Tutorial: CROSSTOOL</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/master/bazel-and-java.html">Java Resources</a></li>
                  <li><a href="/versions/master/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/master/generate-workspace.html">Converting Maven Dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/master/bazel-and-javascript.html">JavaScript Resources</a></li>
                  <li><a href="/versions/master/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="/versions/master/skylark/skylint.html">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-9">
          <a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a>
          <script>
            var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
            var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
            var editButton = document.getElementById('gh-edit');
            // if there is an edit button and we are not in the Build Encyclopedia
            if (editButton
                && window.location.pathname.match(versionDocsURLRegex)
                && window.location.pathname.lastIndexOf('/be/') == -1
                && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
              var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
              // some pages are not using markdown :(
              if (docFile !== 'user-manual.html'
                  && docFile !== 'build-ref.html'
                  && docFile !== 'query.html'
                  && docFile !== 'test-encyclopedia.html') {
                docFile = docFile.replace('html', 'md');
              }
              editButton.href = ghDocsBazeURL + docFile;
              editButton.style.visibility = 'visible';
            }
          </script>

          <!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
          <!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->
          

          <p>Documentation for Bazel master</p>
          <select id="touchsplashmenu" onchange="location.href=this.value">
              <option value="">Choose a Bazel version</option>
              
              <option value="/versions/master/configurable-attributes.html">master</option>
              
              <option value="/versions/0.19.2/configurable-attributes.html">0.19.2</option>
              
              <option value="/versions/0.19.1/configurable-attributes.html">0.19.1</option>
              
              <option value="/versions/0.18.1/configurable-attributes.html">0.18.1</option>
              
              <option value="/versions/0.17.2/configurable-attributes.html">0.17.2</option>
              
              <option value="/versions/0.17.1/configurable-attributes.html">0.17.1</option>
              
          </select>

          <h1 id="configurable-build-attributes">Configurable Build Attributes</h1>

<h3 id="contents">Contents</h3>
<ul>
  <li><a href="#example">Example</a></li>
  <li><a href="#configuration-conditions">Configuration Conditions</a></li>
  <li><a href="#defaults">Defaults</a></li>
  <li><a href="#custom-keys">Custom Keys</a></li>
  <li><a href="#platforms">Platforms</a></li>
  <li><a href="#short-keys">Short Keys</a></li>
  <li><a href="#multiple-selects">Multiple Selects</a></li>
  <li><a href="#or-chaining">OR Chaining</a></li>
  <li><a href="#custom-error-messages">Custom Error Messages</a></li>
  <li><a href="#rules">Rules Compatibility</a></li>
  <li><a href="#query">Bazel Query and Cquery</a></li>
  <li><a href="#faq">FAQ</a>
    <ul>
      <li><a href="#macros-select">Why doesn’t select() work in macros</a></li>
      <li><a href="#boolean-select">Why does select() always return true?</a></li>
      <li><a href="#inspectable-select">Can I read select() like a dict?</a></li>
    </ul>
  </li>
</ul>

<p> </p>

<p><strong><em>Configurable attributes</em></strong>, commonly known as <a href="be/functions.html#select"><code class="highlighter-rouge">select()</code></a>, is a Bazel feature that lets users toggle the values
of BUILD rule attributes at the command line.</p>

<p>This can be used, for example, for a multiplatform library that automatically
chooses the appropriate implementation for the architecture, or for a
feature-configurable binary that can be customized at build time.</p>

<h2 id="example">Example</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myapp/BUILD</span>

<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"mybinary"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"main.cc"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":arm_build"</span><span class="p">:</span> <span class="p">[</span><span class="s">":arm_lib"</span><span class="p">],</span>
        <span class="s">":x86_debug_build"</span><span class="p">:</span> <span class="p">[</span><span class="s">":x86_dev_lib"</span><span class="p">],</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="p">[</span><span class="s">":generic_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"arm_build"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"cpu"</span><span class="p">:</span> <span class="s">"arm"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"x86_debug_build"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"x86"</span><span class="p">,</span>
        <span class="s">"compilation_mode"</span><span class="p">:</span> <span class="s">"dbg"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This declares a <code class="highlighter-rouge">cc_binary</code> that “chooses” its deps based on the flags at the
command line. Specficially, <code class="highlighter-rouge">deps</code> becomes:</p>

<table>
  <tr style="background: #E9E9E9; font-weight: bold">
    <td>Command</td>
    <td>deps =</td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary --cpu=arm</code></td>
    <td><code>[":arm_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary --c dbg --cpu=x86</code></td>
    <td><code>[":x86_dev_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary --cpu=ppc</code></td>
    <td><code>[":generic_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary -c dbg --cpu=ppc</code></td>
    <td><code>[":generic_lib"]</code></td>
  </tr>
</table>
<p><code class="highlighter-rouge">select()</code> serves as a placeholder for a value that will be chosen based on
<em>configuration conditions</em>. These conditions are labels that refer to
<a href="be/general.html#config_setting"><code class="highlighter-rouge">config_setting</code></a> targets. By using <code class="highlighter-rouge">select()</code>
in a configurable attribute, the attribute effectively takes on different values
when different conditions hold.</p>

<p>Matches must be unambiguous: either exactly one condition must match or, if
multiple conditions match, one’s <code class="highlighter-rouge">values</code> must be a strict superset of all
others’. For example, <code class="highlighter-rouge">values = {"cpu": "x86", "compilation_mode": "dbg"}</code> is an
unambiguous specialization of <code class="highlighter-rouge">values = {"cpu": "x86"}</code>. The built-in condition
<a href="#defaults"><code class="highlighter-rouge">//conditions:default</code></a> automatically matches when nothing else
does.</p>

<p>This example uses <code class="highlighter-rouge">deps</code>. But <code class="highlighter-rouge">select()</code> works just as well on <code class="highlighter-rouge">srcs</code>,
<code class="highlighter-rouge">resources</code>, <code class="highlighter-rouge">cmd</code>, or practically any other attribute. Only a small number of
attributes are <em>non-configurable</em>, and those are clearly annotated; for
instance, <code class="highlighter-rouge">config_setting</code>’s own
<a href="be/general.html#config_setting.values"><code class="highlighter-rouge">values</code></a> attribute is non-configurable.</p>

<p>Certain attributes, like the <code class="highlighter-rouge">tools</code> of a <code class="highlighter-rouge">genrule</code>, have the effect of changing
the build parameters (such as the cpu) for all targets that transitively appear
beneath them. This will affect how conditions are matched within those targets
but not within the attribute that causes the change. That is, a <code class="highlighter-rouge">select</code> in the
<code class="highlighter-rouge">tools</code> attribute of a <code class="highlighter-rouge">genrule</code> will work the same as a <code class="highlighter-rouge">select</code> in the <code class="highlighter-rouge">srcs</code>.</p>

<h2 id="configuration-conditions">Configuration Conditions</h2>

<p>Each key in a configurable attribute is a label reference to a
<a href="be/general.html#config_setting"><code class="highlighter-rouge">config_setting</code></a> target. This is just a
collection of expected command line flag settings. By encapsulating these in a
target, it’s easy to maintain “standard” conditions that can be referenced
across targets and BUILD files.</p>

<p>The core <code class="highlighter-rouge">config_setting</code> syntax is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"meaningful_condition_name"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"flag1"</span><span class="p">:</span> <span class="s">"expected_value1"</span><span class="p">,</span>
        <span class="s">"flag2"</span><span class="p">:</span> <span class="s">"expected_value2"</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">flagN</code> is an arbitrary Bazel command line flag. <code class="highlighter-rouge">value</code> is the expected value
for that flag. A <code class="highlighter-rouge">config_setting</code> matches when <em>all</em> of its flags match (order
is irrelevant).</p>

<p><code class="highlighter-rouge">values</code> entries use the same parsing logic as at the actual command line. This
means:</p>

<ul>
  <li><code class="highlighter-rouge">values = { "compilation_mode": "opt" }</code> matches <code class="highlighter-rouge">bazel build -c opt ...</code></li>
  <li><code class="highlighter-rouge">values = { "java_header_compilation": "true" }</code> matches <code class="highlighter-rouge">bazel build
--java_header_compilation=1 ...</code></li>
  <li><code class="highlighter-rouge">values = { "java_header_compilation": "0" }</code> matches <code class="highlighter-rouge">bazel build
--nojava_header_compilation ...</code></li>
</ul>

<p><code class="highlighter-rouge">config_setting</code> only works with flags that affect build rule output. For
example, <a href="user-manual.html#flag--show_progress"><code class="highlighter-rouge">--show_progress</code></a> isn’t allowed
because this only affects how Bazel reports progress to the user.</p>

<p><code class="highlighter-rouge">config_setting</code> semantics are intentionally simple. For example, there’s no
direct support for <code class="highlighter-rouge">OR</code> chaining (although a
<a href="#or-chaining">convenience function</a> provides this).  Consider writing
macros for complicated flag logic.</p>

<h2 id="defaults">Defaults</h2>

<p>The built-in condition <code class="highlighter-rouge">//conditions:default</code> matches when no other condition
matches.</p>

<p>Because of the “exactly one match” rule, a configurable attribute with no match
and no default condition triggers a <code class="highlighter-rouge">"no matching conditions"</code> error. This can
protect against silent failures from unexpected build flags:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># foo/BUILD</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"foobar"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=bar"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":foobar"</span><span class="p">:</span> <span class="p">[</span><span class="s">"foobar_lib.cc"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //foo:my_lib <span class="nt">--define</span> <span class="nv">foo</span><span class="o">=</span>baz
ERROR: Configurable attribute <span class="s2">"srcs"</span> doesn<span class="s1">'t match this configuration (would
a default condition help?).
Conditions checked:
  //foo:foobar
</span></code></pre></div></div>

<p><code class="highlighter-rouge">select()</code> can include a <a href="#custom-error-messages"><code class="highlighter-rouge">no_match_error</code></a> for custom
failure messages.</p>

<h2 id="custom-keys">Custom Keys</h2>

<p>Since <code class="highlighter-rouge">config_setting</code> currently only supports built-in Bazel flags, the level
of custom conditioning it can support is limited. For example, there’s no Bazel
flag for <code class="highlighter-rouge">IncludeSpecialProjectFeatureX</code>.</p>

<p>Plans for <a href="https://docs.google.com/document/d/1vc8v-kXjvgZOdQdnxPTaV0rrLxtP2XwnD2tAZlYJOqw/edit?usp=sharing">truly custom flags</a>
are underway. In the meantime, <a href="user-manual.html#flag--define"><code class="highlighter-rouge">--define</code></a> is
the best approach for these purposes.
<code class="highlighter-rouge">--define</code> is a bit awkward to use and wasn’t originally designed for this
purpose. We recommend using it sparingly until true custom flags are available.
For example, don’t use <code class="highlighter-rouge">--define</code> to specify multiple variants of top-level
binary. Just use multiple targets instead.</p>

<p>To trigger an arbitrary condition with <code class="highlighter-rouge">--define</code>, write</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"bar"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=bar"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"baz"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=baz"</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>and run <code class="highlighter-rouge">$ bazel build //my:target --define foo=baz</code>.</p>

<p>The <code class="highlighter-rouge">values</code> attribute can’t contain multiple <code class="highlighter-rouge">define</code>s. This is
because each instance has the same dictionary key. To solve this, use
<code class="highlighter-rouge">define_values</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"bar_and_baz"</span><span class="p">,</span>
    <span class="n">define_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"foo"</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span>  <span class="c"># matches --define foo=bar</span>
        <span class="s">"baz"</span><span class="p">:</span> <span class="s">"bat"</span><span class="p">,</span>  <span class="c"># matches --define baz=bat</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>When <code class="highlighter-rouge">define</code>s appear in both <code class="highlighter-rouge">values</code> and <code class="highlighter-rouge">define_values</code>, all must match for
the <code class="highlighter-rouge">config_setting</code> to match.</p>

<h2 id="platforms">Platforms</h2>

<p>While the ability to specify multiple flags on the command line provides
flexibility, it can also be burdensome to individually set each one every time
you want to build a target.
   <a href="platforms.html">Platforms</a>
allow you to consolidate these into simple bundles.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myapp/BUILD</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_rocks"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":basalt"</span><span class="p">:</span> <span class="p">[</span><span class="s">"pyroxene.sh"</span><span class="p">],</span>
        <span class="s">":marble"</span><span class="p">:</span> <span class="p">[</span><span class="s">"calcite.sh"</span><span class="p">],</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="p">[</span><span class="s">"feldspar.sh"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"basalt"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":black"</span><span class="p">,</span>
        <span class="s">":igneous"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"marble"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":white"</span><span class="p">,</span>
        <span class="s">":metamorphic"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c"># constraint_setting acts as an enum type, and constraint_value as an enum value.</span>
<span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"black"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"white"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"texture"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"smooth"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"texture"</span><span class="p">)</span>
<span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"igneous"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"metamorphic"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>

<span class="n">platform</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"basalt_platform"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":black"</span><span class="p">,</span>
        <span class="s">":igneous"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">platform</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"marble_platform"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":white"</span><span class="p">,</span>
        <span class="s">":smooth"</span><span class="p">,</span>
        <span class="s">":metamorphic"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The platform can be specified on the command line. It activates the
<code class="highlighter-rouge">config_setting</code>s that contain a subset of the platform’s <code class="highlighter-rouge">constraint_values</code>,
allowing those <code class="highlighter-rouge">config_setting</code>s to match in <code class="highlighter-rouge">select()</code> expressions.</p>

<p>For example, in order to set the <code class="highlighter-rouge">srcs</code> attribute of <code class="highlighter-rouge">my_rocks</code> to <code class="highlighter-rouge">calcite.sh</code>,
we can simply run</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my_app:my_rocks <span class="nt">--platforms</span><span class="o">=</span>//myapp:marble_platform
</code></pre></div></div>

<p>Without platforms, this might look something like</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my_app:my_rocks <span class="nt">--define</span> <span class="nv">color</span><span class="o">=</span>white <span class="nt">--define</span> <span class="nv">texture</span><span class="o">=</span>smooth <span class="nt">--define</span> <span class="nb">type</span><span class="o">=</span>metamorphic
</code></pre></div></div>

<p>Platforms are still under development. See the <a href="https://docs.bazel.build/versions/master/platforms.html">documentation</a> and
<a href="https://bazel.build/roadmaps/platforms.html">roadmap</a> for details.</p>

<h2 id="short-keys">Short Keys</h2>

<p>Since configuration keys are target labels, their names can get long and
unwieldy. This can be mitigated with local variable definitions:</p>

<p>Before:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//my/project/my/team/configs:config1"</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_1.sh"</span><span class="p">],</span>
        <span class="s">"//my/project/my/team/configs:config2"</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_2.sh"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CONFIG1</span><span class="o">=</span><span class="s">"//my/project/my/team/configs:config1"</span>
<span class="n">CONFIG2</span><span class="o">=</span><span class="s">"//my/project/my/team/configs:config2"</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="n">CONFIG1</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_1.sh"</span><span class="p">],</span>
        <span class="n">CONFIG2</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_2.sh"</span><span class="p">],</span>
    <span class="p">})</span>
<span class="p">)</span>
</code></pre></div></div>

<p>For more complex expressions, you can use <a href="skylark/macros.html">macros</a>:</p>

<p>Before:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># foo/BUILD</span>

<span class="n">genrule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"my_target.out"</span><span class="p">],</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//my/project/my/team/configs/config1"</span><span class="p">:</span> <span class="s">"echo custom val: this &gt; $@"</span><span class="p">,</span>
        <span class="s">"//my/project/my/team/configs/config2"</span><span class="p">:</span> <span class="s">"echo custom val: that &gt; $@"</span><span class="p">,</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="s">"echo default output &gt; $@"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># foo/genrule_select.bzl</span>

<span class="k">def</span> <span class="nf">select_echo</span><span class="p">(</span><span class="n">input_dict</span><span class="p">):</span>
    <span class="n">echo_cmd</span> <span class="o">=</span> <span class="s">"echo </span><span class="si">%</span><span class="s">s &gt; $@"</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">"//conditions:default"</span><span class="p">:</span> <span class="n">echo_cmd</span> <span class="o">%</span> <span class="s">"default output"</span><span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">echo_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="s">"custom val: "</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s">"//my/project/my/team/configs/config"</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span>
    <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="n">out_dict</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># foo/BUILD</span>

<span class="n">load</span><span class="p">(</span><span class="s">"//foo:genrule_select.bzl"</span><span class="p">,</span> <span class="s">"select_echo"</span><span class="p">)</span>

<span class="n">genrule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"my_target.out"</span><span class="p">],</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">select_echo</span><span class="p">({</span>
        <span class="s">"1"</span><span class="p">:</span> <span class="s">"this"</span><span class="p">,</span>
        <span class="s">"2"</span><span class="p">:</span> <span class="s">"that"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="multiple-selects">Multiple Selects</h2>

<p><code class="highlighter-rouge">select</code> can appear multiple times in the same attribute:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">]</span> <span class="o">+</span>
           <span class="n">select</span><span class="p">({</span>
               <span class="s">":armeabi_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"armeabi_src.sh"</span><span class="p">],</span>
               <span class="s">":x86_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"x86_src.sh"</span><span class="p">],</span>
           <span class="p">})</span> <span class="o">+</span>
           <span class="n">select</span><span class="p">({</span>
               <span class="s">":opt_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"opt_extras.sh"</span><span class="p">],</span>
               <span class="s">":dbg_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"dbg_extras.sh"</span><span class="p">],</span>
           <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">select</code> cannot appear inside another <code class="highlighter-rouge">select</code> (i.e. <em><code class="highlighter-rouge">AND</code> chaining</em>). If you
need to <code class="highlighter-rouge">AND</code> selects together, either use an intermediate target:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":armeabi_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":armeabi_lib"</span><span class="p">],</span>
        <span class="o">...</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">sh_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"armeabi_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":opt_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"armeabi_with_opt.sh"</span><span class="p">],</span>
        <span class="o">...</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>or write a <a href="skylark/macros.html">macro</a> to do the same thing
automatically.</p>

<p>This approach doesn’t work for non-deps attributes (like
<a href="be/general.html#genrule.cmd">genrule:cmd</a>). For these, extra <code class="highlighter-rouge">config_settings</code>
may be necessary:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"armeabi_and_opt"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"armeabi"</span><span class="p">,</span>
        <span class="s">"compilation_mode"</span><span class="p">:</span> <span class="s">"opt"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="or-chaining">OR Chaining</h2>

<p>Consider the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":config1"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config2"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config3"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Most conditions evaluate to the same dep. But this syntax is verbose, hard to
maintain, and refactoring-unfriendly. It would be nice to not have to repeat
<code class="highlighter-rouge">[":standard_lib"]</code> over and over.</p>

<p>One option is to predefine the declaration as a BUILD variable:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">STANDARD_DEP</span> <span class="o">=</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">]</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":config1"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config2"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config3"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This makes it easier to manage the dependency. But it still adds unnecessary
duplication.</p>

<p><code class="highlighter-rouge">select()</code> doesn’t support native syntax for <code class="highlighter-rouge">OR</code>ed conditions. For this, use
the <a href="https://github.com/bazelbuild/bazel-skylib">Skylib</a> utility <a href="https://github.com/bazelbuild/bazel-skylib/blob/master/lib/selects.bzl"><code class="highlighter-rouge">selects</code></a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">"@bazel_skylib//:lib.bzl"</span><span class="p">,</span> <span class="s">"selects"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">selects</span><span class="o">.</span><span class="n">with_or</span><span class="p">({</span>
        <span class="p">(</span><span class="s">":config1"</span><span class="p">,</span> <span class="s">":config2"</span><span class="p">,</span> <span class="s">":config3"</span><span class="p">):</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This automatically expands the <code class="highlighter-rouge">select</code> to the original syntax above.</p>

<p>For <code class="highlighter-rouge">AND</code> chaining, see <a href="#multiple-selects">here</a>.</p>

<h2 id="custom-error-messages">Custom Error Messages</h2>

<p>By default, when no condition matches, the owning target fails with the error:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: Configurable attribute <span class="s2">"deps"</span> doesn<span class="s1">'t match this configuration (would
a default condition help?).
Conditions checked:
  //tools/cc_target_os:darwin
  //tools/cc_target_os:android
</span></code></pre></div></div>

<p>This can be customized with <a href="be/functions.html#select"><code class="highlighter-rouge">no_match_error</code></a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s">"//tools/cc_target_os:android"</span><span class="p">:</span> <span class="p">[</span><span class="s">":android_deps"</span><span class="p">],</span>
            <span class="s">"//tools/cc_target_os:windows"</span><span class="p">:</span> <span class="p">[</span><span class="s">":windows_deps"</span><span class="p">],</span>
        <span class="p">},</span>
        <span class="n">no_match_error</span> <span class="o">=</span> <span class="s">"Please build with an Android or Windows toolchain"</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //foo:my_lib
ERROR: Configurable attribute <span class="s2">"deps"</span> doesn<span class="s1">'t match this configuration: Please
build with an Android or Windows toolchain
</span></code></pre></div></div>

<h2 id="rules-compatibility"><a name="rules"></a>Rules Compatibility</h2>
<p>Rule implementations receive the <em>resolved values</em> of configurable
attributes. For example, given:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myproject/BUILD</span>

<span class="n">some_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">some_attr</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":foo_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":foo"</span><span class="p">],</span>
        <span class="s">":bar_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":bar"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject/my_target <span class="nt">--define</span> <span class="nv">mode</span><span class="o">=</span>foo
</code></pre></div></div>

<p>Rule implementation code sees <code class="highlighter-rouge">ctx.attr.some_attr</code> as <code class="highlighter-rouge">[":foo"]</code>.</p>

<p>Macros can accept <code class="highlighter-rouge">select()</code> clauses and pass them through to native
rules. But <em>they cannot directly manipulate them</em>. For example, there’s no way
for a macro to convert</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">({</span><span class="s">"foo"</span><span class="p">:</span> <span class="s">"val"</span><span class="p">},</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>to</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">({</span><span class="s">"foo"</span><span class="p">:</span> <span class="s">"val_with_suffix"</span><span class="p">},</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>This is for two reasons.</p>

<p>First, macros that need to know which path a <code class="highlighter-rouge">select</code> will choose <em>cannot work</em>
because macros are evaluated in Bazel’s <a href="user-manual.html#loading-phase">loading phase</a>,
which occurs before flag values are known.
This is a core Bazel design restriction that’s unlikely to change any time soon.</p>

<p>Second, macros that just need to iterate over <em>all</em> <code class="highlighter-rouge">select</code> paths, while
technically feasible, lack a coherent UI. Further design is necessary to change
this.</p>

<h2 id="bazel-query-and-cquery"><a name="query"></a>Bazel Query and Cquery</h2>
<p>Bazel <code class="highlighter-rouge">query</code> operates over Bazel’s <a href="user-manual.html#loading-phase">loading phase</a>. This means it doesn’t know what command line
flags will be applied to a target since those flags aren’t evaluated until later
in the build (during the <a href="user-manual.html#analysis-phase">analysis phase</a>). So
the <a href="query.html"><code class="highlighter-rouge">query</code></a> command can’t accurately determine which path a
configurable attribute will follow.</p>

<p><a href="cquery.html">Bazel <code class="highlighter-rouge">cquery</code></a> has the advantage of being able to parse build
flags and operating post-analysis phase so it correctly resolves configurable
attributes. It doesn’t have full feature parity with query but supports most
major functionality and is actively being worked on.
Querying the following build file…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myproject/BUILD</span>

<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":long"</span><span class="p">:</span> <span class="p">[</span><span class="s">":foo_dep"</span><span class="p">],</span>
        <span class="s">":short"</span><span class="p">:</span> <span class="p">[</span><span class="s">":bar_dep"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"long"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"dog=dachshund"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"short"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"dog=pug"</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>…would return the following results.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel query <span class="s1">'deps(//myproject:my_lib)'</span>
//myproject:my_lib
//myproject:foo_dep
//myproject:bar_dep

<span class="nv">$ </span>bazel cquery <span class="s1">'deps(//myproject:my_lib)'</span> <span class="nt">--define</span> <span class="nv">dog</span><span class="o">=</span>pug
//myproject:my_lib
//myproject:bar_dep
</code></pre></div></div>

<h2 id="faq">FAQ</h2>

<h2 id="why-doesnt-select-work-in-macros"><a name="macros-select"></a>Why doesn’t select() work in macros?</h2>
<p>select() <em>does</em> work in rules! See <a href="#rules">Rules compatibility</a> for
details.</p>

<p>The key issue this question usually means is that select() doesn’t work in
<em>macros</em>. These are different than <em>rules</em>. See the
documentation on <a href="skylark/rules.html">rules</a> and <a href="skylark/macros.html">macros</a>
to understand the difference.
Here’s an end-to-end example:</p>

<p>Define a rule and macro:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myproject/defs.bzl</span>

<span class="c"># Rule implementation: when an attribute is read, all select()s have already</span>
<span class="c"># been resolved. So it looks like a plain old attribute just like any other.</span>
<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span>
    <span class="n">allcaps</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">my_config_string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c"># This works fine on all values.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"My name is "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" with custom message: "</span> <span class="o">+</span> <span class="n">allcaps</span><span class="p">)</span>

<span class="c"># Rule declaration:</span>
<span class="n">my_custom_bazel_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s">"my_config_string"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">()},</span>
<span class="p">)</span>

<span class="c"># Macro declaration:</span>
<span class="k">def</span> <span class="nf">my_custom_bazel_macro</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">my_config_string</span><span class="p">):</span>
    <span class="n">allcaps</span> <span class="o">=</span> <span class="n">my_config_string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c"># This line won't work with select(s).</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"My name is "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" with custom message: "</span> <span class="o">+</span> <span class="n">allcaps</span><span class="p">)</span>
</code></pre></div></div>

<p>Instantiate the rule and macro:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myproject/BUILD</span>

<span class="n">load</span><span class="p">(</span><span class="s">"//myproject:defx.bzl"</span><span class="p">,</span> <span class="s">"my_custom_bazel_rule"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s">"//myproject:defs.bzl"</span><span class="p">,</span> <span class="s">"my_custom_bazel_macro"</span><span class="p">)</span>

<span class="n">my_custom_bazel_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"happy_rule"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//tools/target_cpu:x86"</span><span class="p">:</span> <span class="s">"first string"</span><span class="p">,</span>
        <span class="s">"//tools/target_cpu:ppc"</span><span class="p">:</span> <span class="s">"second string"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">my_custom_bazel_macro</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"happy_macro"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="s">"fixed string"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">my_custom_bazel_macro</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"sad_macro"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//tools/target_cpu:x86"</span><span class="p">:</span> <span class="s">"first string"</span><span class="p">,</span>
        <span class="s">"//tools/target_cpu:ppc"</span><span class="p">:</span> <span class="s">"other string"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Building fails because <code class="highlighter-rouge">sad_macro</code> can’t process the <code class="highlighter-rouge">select()</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject:all
ERROR: /myworkspace/myproject/BUILD:17:1: Traceback
  <span class="o">(</span>most recent call last<span class="o">)</span>:
File <span class="s2">"/myworkspace/myproject/BUILD"</span>, line 17
my_custom_bazel_macro<span class="o">(</span>name <span class="o">=</span> <span class="s2">"sad_macro"</span>, my_config_stri...<span class="s2">"}))
File "</span>/myworkspace/myproject/defs.bzl<span class="s2">", line 4, in
  my_custom_bazel_macro
my_config_string.upper()
type 'select' has no method upper().
ERROR: error loading package 'myproject': Package 'myproject' contains errors.
</span></code></pre></div></div>

<p>Building succeeds when we comment out <code class="highlighter-rouge">sad_macro</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Comment out sad_macro so it doesn't mess up the build.</span>
<span class="nv">$ </span>bazel build //myproject:all
DEBUG: /myworkspace/myproject/defs.bzl:5:3: My name is happy_macro with custom message: FIXED STRING.
DEBUG: /myworkspace/myproject/hi.bzl:15:3: My name is happy_rule with custom message: FIRST STRING.
</code></pre></div></div>

<p>This is impossible to change because <em>by definition</em> macros are evaluated before
Bazel reads the build’s command line flags. That means there isn’t enough
information to evaluate select()s.</p>

<p>Macros can, however, pass <code class="highlighter-rouge">select()</code>s as opaque blobs to rules:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># myproject/defs.bzl</span>

<span class="k">def</span> <span class="nf">my_custom_bazel_macro</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">my_config_string</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Invoking macro "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">my_custom_bazel_rule</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"_as_target"</span><span class="p">,</span>
        <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">my_config_string</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject:sad_macro_less_sad
DEBUG: /myworkspace/myproject/defs.bzl:23:3: Invoking macro sad_macro_less_sad.
DEBUG: /myworkspace/myproject/defs.bzl:15:3: My name is sad_macro_less_sad with custom message: FIRST STRING.
</code></pre></div></div>

<h2 id="why-does-select-always-return-true"><a name="boolean-select"></a>Why does select() always return true?</h2>
<p>Because <em>macros</em> (but not rules) by definition
<a href="#macros-select">can’t evaluate select(s)</a>, any attempt to do so
usually produces a an error:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: /myworkspace/myproject/BUILD:17:1: Traceback
  <span class="o">(</span>most recent call last<span class="o">)</span>:
File <span class="s2">"/myworkspace/myproject/BUILD"</span>, line 17
my_custom_bazel_macro<span class="o">(</span>name <span class="o">=</span> <span class="s2">"sad_macro"</span>, my_config_stri...<span class="s2">"}))
File "</span>/myworkspace/myproject/defs.bzl<span class="s2">", line 4, in
  my_custom_bazel_macro
my_config_string.upper()
type 'select' has no method upper().
</span></code></pre></div></div>

<p>Booleans are a special case that fail silently, so you should be particularly
vigilant with them:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def my_boolean_macro<span class="o">(</span>boolval<span class="o">)</span>:
  print<span class="o">(</span><span class="s2">"TRUE"</span> <span class="k">if </span>boolval <span class="k">else</span> <span class="s2">"FALSE"</span><span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>myproject/BUILD
load<span class="o">(</span><span class="s2">"//myproject:defx.bzl"</span>, <span class="s2">"my_boolean_macro"</span><span class="o">)</span>
my_boolean_macro<span class="o">(</span>
    boolval <span class="o">=</span> <span class="k">select</span><span class="o">({</span>
        <span class="s2">"//tools/target_cpu:x86"</span>: True,
        <span class="s2">"//tools/target_cpu:ppc"</span>: False,
    <span class="o">})</span>,
<span class="o">)</span>

<span class="nv">$ </span>bazel build //myproject:all <span class="nt">--cpu</span><span class="o">=</span>x86
DEBUG: /myworkspace/myproject/defs.bzl:4:3: TRUE.
<span class="nv">$ </span>bazel build //myproject:all <span class="nt">--cpu</span><span class="o">=</span>ppc
DEBUG: /myworkspace/myproject/defs.bzl:4:3: TRUE.
</code></pre></div></div>

<p>This happens because macros don’t understand the contents of <code class="highlighter-rouge">select()</code>.
So what they’re really evaluting is the <code class="highlighter-rouge">select()</code> object itself. According to
<a href="https://docs.python.org/release/2.5.2/lib/truth.html">Pythonic</a> design
standards, all objects aside from a very small number of exceptions
automatically return true.</p>
<h2 id="can-i-read-select-like-a-dict"><a name="inspectable-select"></a>Can I read select() like a dict?</h2>
<p>Fine. Macros <a href="#macros-select">can’t</a> evaluate select(s) because
macros are evaluated before Bazel knows what the command line flags are.</p>

<p>Can macros at least read the <code class="highlighter-rouge">select()</code>’s dictionary, say, to add an extra
suffix to each branch?</p>

<p>Conceptually this is possible. But this isn’t yet implemented and is not
currently prioritized.
What you <em>can</em> do today is prepare a straight dictionary, then feed it into a
<code class="highlighter-rouge">select()</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def selecty_genrule<span class="o">(</span>name, select_cmd<span class="o">)</span>:
  <span class="k">for </span>key <span class="k">in </span>select_cmd.keys<span class="o">()</span>:
    select_cmd[key] +<span class="o">=</span> <span class="s2">" WITH SUFFIX"</span>
  native.genrule<span class="o">(</span>
      name <span class="o">=</span> name,
      outs <span class="o">=</span> <span class="o">[</span>name + <span class="s2">".out"</span><span class="o">]</span>,
      srcs <span class="o">=</span> <span class="o">[]</span>,
      cmd <span class="o">=</span> <span class="s2">"echo "</span> + <span class="k">select</span><span class="o">(</span>select_cmd + <span class="o">{</span><span class="s2">"//conditions:default"</span>: <span class="s2">"default"</span><span class="o">})</span>
        + <span class="s2">" &gt; </span><span class="nv">$@</span><span class="s2">"</span>
  <span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>myproject/BUILD
selecty_genrule<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"selecty"</span>,
    select_cmd <span class="o">=</span> <span class="o">{</span>
        <span class="s2">"//tools/target_cpu:x86"</span>: <span class="s2">"x86 mode"</span>,
    <span class="o">}</span>,
<span class="o">)</span>

<span class="nv">$ </span>bazel build //testapp:selecty <span class="nt">--cpu</span><span class="o">=</span>x86 <span class="o">&amp;&amp;</span> <span class="nb">cat </span>bazel-genfiles/testapp/selecty.out
x86 mode WITH SUFFIX
</code></pre></div></div>

<p>If you’d like to support both <code class="highlighter-rouge">select()</code> and native types, you can do this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def selecty_genrule<span class="o">(</span>name, select_cmd<span class="o">)</span>:
    cmd_suffix <span class="o">=</span> <span class="s2">""</span>
    <span class="k">if </span><span class="nb">type</span><span class="o">(</span>select_cmd<span class="o">)</span> <span class="o">==</span> <span class="s2">"string"</span>:
        cmd_suffix <span class="o">=</span> select_cmd + <span class="s2">" WITH SUFFIX"</span>
    <span class="k">elif </span><span class="nb">type</span><span class="o">(</span>select_cmd<span class="o">)</span> <span class="o">==</span> <span class="s2">"dict"</span>:
        <span class="k">for </span>key <span class="k">in </span>select_cmd.keys<span class="o">()</span>:
            select_cmd[key] +<span class="o">=</span> <span class="s2">" WITH SUFFIX"</span>
        cmd_suffix <span class="o">=</span> <span class="k">select</span><span class="o">(</span>select_cmd + <span class="o">{</span><span class="s2">"//conditions:default"</span>: <span class="s2">"default"</span><span class="o">})</span>

    native.genrule<span class="o">(</span>
        name <span class="o">=</span> name,
        outs <span class="o">=</span> <span class="o">[</span>name + <span class="s2">".out"</span><span class="o">]</span>,
        srcs <span class="o">=</span> <span class="o">[]</span>,
        cmd <span class="o">=</span> <span class="s2">"echo "</span> + cmd_suffix + <span class="s2">"&gt; </span><span class="nv">$@</span><span class="s2">"</span>,
    <span class="o">)</span>
</code></pre></div></div>

        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=oohdpic4fyfp3jcnym6aqkdf3e"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2018 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

