<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Starlark Build Configurations - Bazel </title>

    <link rel="canonical" href="/versions/master/skylark/config.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,700|Open+Sans:400,600,700,800" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Starlark Build Configurations"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-3">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: master</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/skylark/config.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/skylark/config.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/skylark/config.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/skylark/config.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/skylark/config.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/skylark/config.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/skylark/config.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/skylark/config.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/skylark/config.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/skylark/config.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/skylark/config.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/skylark/config.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/skylark/config.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/skylark/config.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/skylark/config.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/skylark/config.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/skylark/config.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/skylark/config.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/skylark/config.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/skylark/config.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/skylark/config.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/skylark/config.html">
                    0.17.1
                </option>
                
            </select>

            <h4>Home</h4>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

            <h4>Installing and Using Bazel</h4>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
              <li class="sidebar-nav">
                <a href="/versions/master/updating-bazel.html">Updating Bazel</a>
              </li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Using Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
                  <li><a href="/versions/master/guide.html">User's Guide (Bazel commands)</a></li>
                  <li><a href="/versions/master/external.html">External Dependencies</a></li>
                  <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
                  <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
                  <li><a href="/versions/master/memory-saving-mode.html">Memory-saving Mode</a></li>
                  <li><a href="/versions/master/windows.html">Using Bazel on Windows</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/master/be/functions.html">Functions</a></li>
                  <li><a href="/versions/master/be/common-definitions.html">Common Definitions</a></li>
                  <li><a href="/versions/master/be/make-variables.html">"Make" Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                </ul>
              </li>

              
                <li><a href="/versions/master/rules.html">Rules</a></li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/aquery.html">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                         <li><a href="/versions/master/remote-execution-caching-debug.html">Debugging Remote Cache Hit Rate</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote Caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/master/remote-caching.html">Remote Caching Overview</a></li>
                     <li><a href="/versions/master/remote-caching-debug.html">Debugging Remote Cache Hit Rate for Local Execution</a></li>
                  </ul>
              </li>
              
              <li><a href="/versions/master/platforms-intro.html">Building With Platforms</a></li>
              
             </ul>

           

           <h4>Reference</h4>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h4>Extending Bazel</h4>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/config.html">Configurations</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                  <li><a href="/versions/master/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-7">
          <div class="content">
            <h1 id="starlark-build-configurations">Starlark Build Configurations</h1>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#current-status">Current Status</a></li>
  <li><a href="#user-defined-build-settings">User-defined Build Settings</a></li>
  <li><a href="#build-settings-and-select">Build Settings and Select</a></li>
  <li><a href="#user-defined-transitions">User-defined Transitions</a></li>
  <li><a href="#integration-with-platforms-and-toolchains">Integration With Platforms and Toolchains</a></li>
  <li><a href="#also-see">Also See</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>Starlark build configuration is Bazel’s API for customizing how your project
builds.</p>

<p>This makes it possible to:</p>

<ul>
  <li>define custom flags for your project, obsoleting the need for
 <a href="../configurable-attributes.html#custom-keys"><code class="highlighter-rouge">--define</code></a></li>
  <li>
    <p>write
 <a href="lib/transition.html#transition">transitions</a>     to configure deps in different configurations
than their parents (e.g. <code class="highlighter-rouge">--compilation_mode=opt</code> or <code class="highlighter-rouge">--cpu=arm</code>)</p>
  </li>
  <li>bake better defaults into rules (e.g. automatically build <code class="highlighter-rouge">//my:android_app</code>
with a specified SDK)</li>
</ul>

<p>and more, all completely from .bzl files (no Bazel release required).</p>

<!-- [TOC] -->

<h2 id="current-status">Current Status</h2>

<p>As of Q4’19, everything documented here works but
may have memory and performance consequences as we work on scaling concerns.
Related issues:</p>

<ul>
  <li><a href="https://github.com/bazelbuild/bazel/issues/5574">#5574</a> - Starlark support
for custom configuration transitions</li>
  <li><a href="https://github.com/bazelbuild/bazel/issues/5575">#5575</a> - Starlark support
for multi-arch (“fat”) binaries</li>
  <li><a href="https://github.com/bazelbuild/bazel/issues/5577">#5577</a> - Starlark support
for custom build flags</li>
  <li><a href="https://github.com/bazelbuild/bazel/issues/5578">#5578</a> - Configuration
doesn’t block native to Skylark rules migration</li>
</ul>

<h2 id="user-defined-build-settings">User-defined Build Settings</h2>
<p>A build setting is a single piece of
<a href="rules.html#configurations">configuration</a>
information. Think of a configuration as a key/value map. Setting <code class="highlighter-rouge">--cpu=ppc</code>
and <code class="highlighter-rouge">--copt="-DFoo"</code> produces a configuration that looks like
<code class="highlighter-rouge">{cpu: ppc, copt: "-DFoo"}</code>. Each entry is a build setting.</p>

<p>Traditional flags like <code class="highlighter-rouge">cpu</code> and <code class="highlighter-rouge">copt</code> are native settings i.e.
their keys are defined and their values are set inside native bazel java code.
Bazel users can only read and write them via the command line
and other APIs maintained natively. Changing native flags, and the APIs
that expose them, requires a bazel release. User-defined build
settings are defined in <code class="highlighter-rouge">.bzl</code> files (and thus, don’t need a bazel release to
register changes). They also can be set via the command line
(if they’re designated as <code class="highlighter-rouge">flags</code>, see more below), but can also be
set via <a href="#user-defined-transitions">user-defined transitions</a>.</p>

<h3 id="defining-build-settings">Defining Build Settings</h3>

<h4 id="the-build_setting-rule-parameter">The <code class="highlighter-rouge">build_setting</code> <code class="highlighter-rouge">rule()</code> Parameter</h4>

<p>Build settings are rules like any other rule and are differentiated using the
Starlark <code class="highlighter-rouge">rule()</code> function’s <code class="highlighter-rouge">build_setting</code>
<a href="lib/globals.html#rule.build_setting">attribute</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/buildsettings/build_settings.bzl
</span><span class="n">string_flag</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">build_setting</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">build_setting</code> attribute takes a function that designates the type of the
build setting. The type is limited to a set of basic Starlark types like
<code class="highlighter-rouge">bool</code> and <code class="highlighter-rouge">string</code>. See the <code class="highlighter-rouge">config</code> module
 <a href="lib/config.html">documentation</a>  for details. More complicated typing can be done in the rule’s
implementation function. More on this below.</p>

<p>The <code class="highlighter-rouge">config</code> function also takes an optional boolean parameter, <code class="highlighter-rouge">flag</code>, which is
set to false by default. if <code class="highlighter-rouge">flag</code> is set to true, the build setting can be set
on the command line by users as well as internally by rule writers via default
values and
<a href="lib/transition.html#transition">transitions</a>.
Not all settings should be settable by users. For example if you as a rule
writer have some debug mode that you’d like to turn on inside test rules,
you don’t want to give users the ability to indiscriminately turn on that
feature inside other non-test rules.</p>

<h4 id="using-ctxbuild_setting_value">Using <code class="highlighter-rouge">ctx.build_setting_value</code></h4>

<p>Like all rules, build setting rules have <a href="rules.html#implementation-function">implementation functions</a>.
The basic Starlark-type value of the build settings can be accessed via the
<code class="highlighter-rouge">ctx.build_setting_value</code> method. This method is only available to
 <a href="lib/ctx.html"><code class="highlighter-rouge">ctx</code></a> objects of build setting rules. These implementation methods can directly
forward the build settings value or do additional work on it, like type checking
or more complex struct creation. Here’s how you would implement an <code class="highlighter-rouge">enum</code>-typed
build setting:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/buildsettings/build_settings.bzl
</span><span class="n">TemperatureProvider</span> <span class="o">=</span> <span class="n">provider</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'type'</span><span class="p">])</span>

<span class="n">temperatures</span> <span class="o">=</span> <span class="p">[</span><span class="s">"HOT"</span><span class="p">,</span> <span class="s">"LUKEWARM"</span><span class="p">,</span> <span class="s">"ICED"</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">raw_temperature</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">build_setting_value</span>
    <span class="k">if</span> <span class="n">raw_temperature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temperatures</span><span class="p">:</span>
        <span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s">" build setting allowed to take values {"</span>
             <span class="o">+</span> <span class="s">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span> <span class="o">+</span> <span class="s">"} but was set to unallowed value "</span>
             <span class="o">+</span> <span class="n">raw_temperature</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TemperatureProvider</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="n">raw_temperature</span><span class="p">)</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">build_setting</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Note: if a rule depends on a build setting, it will receive whatever providers
the build setting implementation function returns, like any other dependency.
But all other references to the value of the build setting (e.g. in transitions)
will see its basic Starlark-typed value, not this post implementation function
value.</p>

<h4 id="instantiating-build-settings">Instantiating Build Settings</h4>

<p>Rules defined with the <code class="highlighter-rouge">build_setting</code> parameter have an implicit mandatory
<code class="highlighter-rouge">build_setting_default</code> attribute. This attribute takes on the same type as
declared by the <code class="highlighter-rouge">build_setting</code> param.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/buildsettings/build_settings.bzl
</span><span class="n">FlavorProvider</span> <span class="o">=</span> <span class="n">provider</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'type'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FlavorProvider</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">build_setting_value</span><span class="p">)</span>

<span class="n">flavor</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">build_setting</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/buildsettings/BUILD
</span><span class="n">load</span><span class="p">(</span><span class="s">"//example/buildsettings:build_settings.bzl"</span><span class="p">,</span> <span class="s">"flavor"</span><span class="p">)</span>
<span class="n">flavor</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"favorite_flavor"</span><span class="p">,</span>
    <span class="n">build_setting_default</span> <span class="o">=</span> <span class="s">"APPLE"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>A collection of the most common build setting rules can be found in
<a href="https://github.com/bazelbuild/bazel-skylib/blob/master/rules/common_settings.bzl">skylib</a>.</p>

<h3 id="using-build-settings">Using Build Settings</h3>

<h4 id="depending-on-build-settings">Depending on Build Settings</h4>
<p>If a target would like to read a piece of configuration information, it can
directly depend on the build setting via a regular attribute dependency.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/rules.bzl
</span><span class="n">load</span><span class="p">(</span><span class="s">"//example/buildsettings:build_settings.bzl"</span><span class="p">,</span> <span class="s">"FlavorProvider"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_rule_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">flavor</span><span class="p">[</span><span class="n">FlavorProvider</span><span class="p">]</span><span class="o">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"ORANGE"</span><span class="p">:</span>
        <span class="o">...</span>

<span class="n">drink_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_rule_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"flavor"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/BUILD
</span><span class="n">load</span><span class="p">(</span><span class="s">"//example:rules.bzl"</span><span class="p">,</span> <span class="s">"drink_rule"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s">"//example/buildsettings:build_settings.bzl"</span><span class="p">,</span> <span class="s">"flavor"</span><span class="p">)</span>
<span class="n">flavor</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"favorite_flavor"</span><span class="p">,</span>
    <span class="n">build_setting_default</span> <span class="o">=</span> <span class="s">"APPLE"</span>
<span class="p">)</span>
<span class="n">drink_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_drink"</span><span class="p">,</span>
    <span class="n">flavor</span> <span class="o">=</span> <span class="s">":favorite_flavor"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Languages may wish to create a canonical set of build settings which all rules
for that language depend on. Though the native concept of <code class="highlighter-rouge">fragments</code> no longer
exists as a hardcoded object in Starlark configuration world, one way to
translate this concept would be to use sets of common implicit attributes. For
example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># kotlin/rules.bzl
</span><span class="n">_KOTLIN_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"_compiler"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="s">"//kotlin/config:compiler-flag"</span><span class="p">),</span>
    <span class="s">"_mode"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="s">"//kotlin/config:mode-flag"</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="n">kotlin_library</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_rule_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">dicts</span><span class="o">.</span><span class="n">add</span><span class="p">({</span>
        <span class="s">"library-attr"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="p">},</span> <span class="n">_KOTLIN_CONFIG</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">kotlin_binary</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_binary_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">dicts</span><span class="o">.</span><span class="n">add</span><span class="p">({</span>
        <span class="s">"binary-attr"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
    <span class="p">},</span> <span class="n">_KOTLIN_CONFIG</span><span class="p">)</span>

</code></pre></div></div>

<h4 id="settings-build-settings-on-the-command-line">Settings Build Settings on the command line</h4>

<p>Build settings are set on the command line like any other flag. Boolean build
settings understand no-prefixes and both equals and space syntaxes are supported.
The name of build settings is their full target path:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //my/target <span class="nt">--</span>//example:favorite_flavor<span class="o">=</span><span class="s2">"PAMPLEMOUSSE"</span>
</code></pre></div></div>

<p>There are plans to implement shorthand mapping of flag labels so users don’t
need to use their entire target path each time i.e.:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //my/target <span class="nt">--cpu</span><span class="o">=</span>k8 <span class="nt">--noboolean_flag</span>
</code></pre></div></div>

<p>instead of</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //my/target <span class="nt">--</span>//third_party/bazel/src/main:cpu<span class="o">=</span>k8 <span class="nt">--no</span>//my/project:boolean_flag
</code></pre></div></div>

<h3 id="label-typed-build-settings">Label-typed Build Settings</h3>

<p>Unlike other build settings, label-typed settings cannot be defined using the
<code class="highlighter-rouge">build_setting</code> rule parameter. Instead, bazel has two built-in rules:
<code class="highlighter-rouge">label_flag</code> and <code class="highlighter-rouge">label_setting</code>. These rules forward the providers of the
actual target to which the build setting is set. <code class="highlighter-rouge">label_flag</code> and
<code class="highlighter-rouge">label_setting</code> can be read/written by transitions and <code class="highlighter-rouge">label_flag</code> can be set
by the user like other <code class="highlighter-rouge">build_setting</code> rules can. Their only difference is they
can’t customely defined.</p>

<p>Label-typed settings will eventually replace the functionality of late-bound
defaults. Late-bound default attributes are Label-typed attributes whose
final values can be affected by configuration. In Starlark, this will replace
the <a href="lib/globals.html#configuration_field"><code class="highlighter-rouge">configuration_field</code></a>
 API.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/rules.bzl
</span><span class="n">MyProvider</span> <span class="o">=</span> <span class="n">provider</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="p">[</span><span class="s">"my_field"</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_dep_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">MyProvider</span><span class="p">(</span><span class="n">my_field</span> <span class="o">=</span> <span class="s">"yeehaw"</span><span class="p">)</span>

<span class="n">dep_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_dep_impl</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_parent_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">my_field_provider</span><span class="p">[</span><span class="n">MyProvider</span><span class="p">]</span> <span class="o">==</span> <span class="s">"cowabunga"</span><span class="p">:</span>
        <span class="o">...</span>

<span class="n">parent_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_parent_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"my_field_provider"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">()</span> <span class="p">}</span>
<span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/BUILD
</span><span class="n">load</span><span class="p">(</span><span class="s">"//example:rules.bzl"</span><span class="p">,</span> <span class="s">"dep_rule"</span><span class="p">,</span> <span class="s">"parent_rule"</span><span class="p">)</span>

<span class="n">dep_rule</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dep"</span><span class="p">)</span>

<span class="n">parent_rule</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent"</span><span class="p">,</span> <span class="n">my_field_provider</span> <span class="o">=</span> <span class="s">":my_field_provider"</span><span class="p">)</span>

<span class="n">label_flag</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_field_provider"</span><span class="p">,</span>
    <span class="n">build_setting_default</span> <span class="o">=</span> <span class="s">":dep"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>TODO(bazel-team): Expand supported build setting types.</p>

<h2 id="build-settings-and-select">Build Settings and Select</h2>

<p>Users can configure attributes on build settings by using
 <a href="../be/functions.html#select"><code class="highlighter-rouge">select()</code></a>. Build setting targets can be passed to the <code class="highlighter-rouge">flag_values</code> attribute of
<code class="highlighter-rouge">config_setting</code>. The value to match to the configuration is passed as a
<code class="highlighter-rouge">String</code> then parsed to the type of the build setting for matching.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_config"</span><span class="p">,</span>
    <span class="n">flag_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"//example:favorite_flavor"</span><span class="p">:</span> <span class="s">"MANGO"</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="user-defined-transitions">User-defined Transitions</h2>

<p>A configuration
<a href="lib/transition.html#transition">transition</a>
is how we change configuration of
configured targets in the build graph.</p>

<h3 id="defining-transitions-in-starlark">Defining Transitions in Starlark</h3>

<p>Transitions define configuration changes between rules. For example, a request
like “compile my dependency for a different CPU than its parent” is handled by a
transition.</p>

<p>Formally, a transition is a function from an input configuration to one or more
output configurations. Most transitions are 1:1 e.g. “override the input
configuration with <code class="highlighter-rouge">--cpu=ppc</code>”. 1:2+ transitions can also exist but come
with special restrictions.</p>

<p>In Starlark, transitions are defined much like rules, with a defining
<code class="highlighter-rouge">transition()</code>
<a href="lib/transition.html#transition">function</a>
and an implementation function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/transitions/transitions.bzl
</span><span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="n">_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"//example:favorite_flavor"</span> <span class="p">:</span> <span class="s">"MINT"</span><span class="p">}</span>

<span class="n">hot_chocolate_transition</span> <span class="o">=</span> <span class="n">transition</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"//example:favorite_flavor"</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>
<p>The <code class="highlighter-rouge">transition()</code> function takes in an implementation function, a set of
build settings to read(<code class="highlighter-rouge">inputs</code>), and a set of build settings to write
(<code class="highlighter-rouge">outputs</code>). The implementation function has two parameters, <code class="highlighter-rouge">settings</code> and
<code class="highlighter-rouge">attr</code>. <code class="highlighter-rouge">settings</code> is a dictionary {<code class="highlighter-rouge">String</code>:<code class="highlighter-rouge">Object</code>} of all settings declared
in the <code class="highlighter-rouge">inputs</code> parameter to <code class="highlighter-rouge">transition()</code>.</p>

<p><code class="highlighter-rouge">attr</code> is a dictionary of attributes and values of the rule to which the
transition is attached. When attached as an
<a href="#outgoing-edge-transitions">outgoing edge transition</a>, the values of these
attributes are all configured i.e. post-select() resolution. When attached as
an <a href="#incoming-edge-transitions">incoming edge transition</a>, <code class="highlighter-rouge">attr</code> does not
include any attributes that use a selector to resolve their value. If an
incoming edge transition on <code class="highlighter-rouge">--foo</code> reads attribute <code class="highlighter-rouge">bar</code> and then also
selects on <code class="highlighter-rouge">--foo</code> to set attribute <code class="highlighter-rouge">bar</code>, then there’s a chance for the
incoming edge transition to read the wrong value of <code class="highlighter-rouge">bar</code> in the transition.</p>

<p>Note: since transitions are attached to rule definitions and <code class="highlighter-rouge">select()</code>s are
attached to rule instantiations (i.e. targets), errors related to <code class="highlighter-rouge">select()</code>s on
read attributes will pop up when users create targets rather than when rules are
written. It may be worth taking extra care to communicate to rule users which
attributes they should be wary of selecting on or taking other precautions.</p>

<p>The implementation function must return a dictionary (or list of
dictionaries, in the case of
transitions with multiple output configurations)
of new build settings values to apply. The returned dictionary keyset(s) must
contain exactly the set of build settings passed to the <code class="highlighter-rouge">outputs</code>
parameter of the transition function. This is true even if a build setting is
not actually changed over the course of the transition - its original value must
be explicitly passed through in the returned dictionary.</p>

<h4 id="defining-12-transitions">Defining 1:2+ Transitions</h4>
<p><a href="#outgoing-edge-transitions">Outgoing edge transition</a> can map a single input
configuration to two or more output configurations. These are defined in
Starlark by returning a list of dictionaries in the transition implementation
function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/transitions/transitions.bzl
</span><span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="n">_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span><span class="s">"//example:favorite_flavor"</span> <span class="p">:</span> <span class="s">"LATTE"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"//example:favorite_flavor"</span> <span class="p">:</span> <span class="s">"MOCHA"</span><span class="p">},</span>
    <span class="p">]</span>

<span class="n">coffee_transition</span> <span class="o">=</span> <span class="n">transition</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"//example:favorite_flavor"</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="attaching-transitions">Attaching Transitions</h3>
<p>Transitions can be attached in two places: incoming edges and outgoing edges.
Effectively this means rules can transition their own configuration (incoming
edge transition) and transition their dependencies’ configurations (outgoing
edge transition).</p>

<h4 id="incoming-edge-transitions">Incoming Edge Transitions</h4>
<p>Incoming edge transitions are activated by attaching a <code class="highlighter-rouge">transition</code> object
(created by <code class="highlighter-rouge">transition()</code>) to <code class="highlighter-rouge">rule()</code>’s <code class="highlighter-rouge">cfg</code> parameter:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/rules.bzl
</span><span class="n">load</span><span class="p">(</span><span class="s">"example/transitions:transitions.bzl"</span><span class="p">,</span> <span class="s">"hot_chocolate_transition"</span><span class="p">)</span>
<span class="n">drink_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">hot_chocolate_transition</span><span class="p">,</span>
    <span class="o">...</span>
</code></pre></div></div>

<p>Incoming edge transitions must be 1:1 transitions.</p>

<h3 id="outgoing-edge-transitions">Outgoing Edge Transitions</h3>
<p>Outgoing edge transitions are activated by attaching a <code class="highlighter-rouge">transition</code> object
(created by <code class="highlighter-rouge">transition()</code>) to an attribute’s <code class="highlighter-rouge">cfg</code> parameter:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/rules.bzl
</span><span class="n">load</span><span class="p">(</span><span class="s">"example/transitions:transitions.bzl"</span><span class="p">,</span> <span class="s">"coffee_transition"</span><span class="p">)</span>
<span class="n">drink_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"dep"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">coffee_transition</span><span class="p">)}</span>
    <span class="o">...</span>
</code></pre></div></div>
<p>Outgoing edge transitions can be 1:1 or 1:2+.</p>

<h3 id="transitions-on-native-options">Transitions on Native Options</h3>
<p>WARNING: This feature will be deprecated soon. Use at your own risk.</p>

<p>Starlark transitions can also declare reads and writes on native options via
a special prefix to the option name.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/transitions/transitions.bzl
</span><span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="n">_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"//command_line_option:cpu"</span><span class="p">:</span> <span class="s">"k8"</span><span class="p">}</span>

<span class="n">cpu_transition</span> <span class="o">=</span> <span class="n">transition</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"//command_line_option:cpu"</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="accessing-attributes-with-transitions">Accessing Attributes with Transitions</h3>
<p>When <a href="#outgoing-edge-transitions">attaching a transition to an outgoing edge</a>
(regardless of whether the transition is a 1:1 or 1:2+ transition) access to
values of that attribute in the rule implementation changes. Access through
<code class="highlighter-rouge">ctx.attr</code> is forced to be a list if it isn’t already. The order of elements in
this list is unspecified.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># example/transitions/rules.bzl
</span><span class="k">def</span> <span class="nf">_transition_impl</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"//example:favorite_flavor"</span> <span class="p">:</span> <span class="s">"LATTE"</span><span class="p">},</span>

<span class="n">coffee_transition</span> <span class="o">=</span> <span class="n">transition</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_transition_impl</span><span class="p">,</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"//example:favorite_flavor"</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_rule_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="c1"># Note: List access even though "dep" is not declared as list
</span>    <span class="n">transitioned_dep</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Note: Access doesn't change, other_deps was already a list
</span>    <span class="k">for</span> <span class="n">other</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">other_deps</span><span class="p">:</span>
      <span class="c1"># ...
</span>

<span class="n">coffee_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_rule_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"dep"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">coffee_transition</span><span class="p">)</span>
        <span class="s">"other_deps"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label_list</span><span class="p">(</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">coffee_transition</span><span class="p">)</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Access to the value of a single branch of a 1:2+
<a href="https://github.com/bazelbuild/bazel/issues/8633">has not been implemented yet</a>.</p>

<h2 id="integration-with-platforms-and-toolchains">Integration with Platforms and Toolchains</h2>
<p>Many native flags today, like <code class="highlighter-rouge">--cpu</code> and <code class="highlighter-rouge">--crosstool_top</code> are related to
toolchain resolution. In the future, explicit transitions on these types of
flags will likely be replaced by transitioning on the
<a href="../platforms.html">target platform</a></p>

<h2 id="also-see">Also See:</h2>

<ul>
  <li><a href="https://docs.google.com/document/d/1vc8v-kXjvgZOdQdnxPTaV0rrLxtP2XwnD2tAZlYJOqw/edit?usp=sharing">Starlark Build Configuration</a></li>
  <li><a href="https://bazel.build/roadmaps/configuration.html">Bazel Configurability Roadmap</a></li>
</ul>

          </div>
        </div>

        <div class="col-md-2 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Starlark Build Configurations&body=Documentation URL: https://docs.bazel.build/versions/master/skylark/config.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue for this page</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible'
                     editButtonListItem.style.visibility = 'visible'
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h2"><a href="#overview">Overview</a></li>
<li class="toc-entry toc-h2"><a href="#current-status">Current Status</a></li>
<li class="toc-entry toc-h2"><a href="#user-defined-build-settings">User-defined Build Settings</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#defining-build-settings">Defining Build Settings</a></li>
<li class="toc-entry toc-h3"><a href="#using-build-settings">Using Build Settings</a></li>
<li class="toc-entry toc-h3"><a href="#label-typed-build-settings">Label-typed Build Settings</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#build-settings-and-select">Build Settings and Select</a></li>
<li class="toc-entry toc-h2"><a href="#user-defined-transitions">User-defined Transitions</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#defining-transitions-in-starlark">Defining Transitions in Starlark</a></li>
<li class="toc-entry toc-h3"><a href="#attaching-transitions">Attaching Transitions</a></li>
<li class="toc-entry toc-h3"><a href="#outgoing-edge-transitions">Outgoing Edge Transitions</a></li>
<li class="toc-entry toc-h3"><a href="#transitions-on-native-options">Transitions on Native Options</a></li>
<li class="toc-entry toc-h3"><a href="#accessing-attributes-with-transitions">Accessing Attributes with Transitions</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#integration-with-platforms-and-toolchains">Integration with Platforms and Toolchains</a></li>
<li class="toc-entry toc-h2"><a href="#also-see">Also See:</a></li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

