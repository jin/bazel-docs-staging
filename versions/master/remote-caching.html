<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Remote Caching - Bazel </title>

    <link rel="canonical" href="/versions/master/remote-caching.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700|Source+Code+Pro:400,500,700|Open+Sans" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Remote Caching"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-2">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: master</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/remote-caching.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/remote-caching.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/remote-caching.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/remote-caching.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/remote-caching.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/remote-caching.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/remote-caching.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/remote-caching.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/remote-caching.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/remote-caching.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/remote-caching.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/remote-caching.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/remote-caching.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/remote-caching.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/remote-caching.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/remote-caching.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/remote-caching.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/remote-caching.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/remote-caching.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/remote-caching.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/remote-caching.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/remote-caching.html">
                    0.17.1
                </option>
                
            </select>

            <h4>Home</h4>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

            <h4>Installing and Using Bazel</h4>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
              <li class="sidebar-nav">
                <a href="/versions/master/updating-bazel.html">Updating Bazel</a>
              </li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Using Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
                  <li><a href="/versions/master/guide.html">User's Guide (Bazel commands)</a></li>
                  <li><a href="/versions/master/external.html">External Dependencies</a></li>
                  <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
                  <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
                  <li><a href="/versions/master/memory-saving-mode.html">Memory-saving Mode</a></li>
                  <li><a href="/versions/master/windows.html">Using Bazel on Windows</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/master/be/functions.html">Functions</a></li>
                  <li><a href="/versions/master/be/common-definitions.html">Common Definitions</a></li>
                  <li><a href="/versions/master/be/make-variables.html">"Make" Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                </ul>
              </li>

              
                <li><a href="/versions/master/rules.html">Rules</a></li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/aquery.html">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                         <li><a href="/versions/master/remote-execution-caching-debug.html">Debugging Remote Cache Hit Rate</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote Caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/master/remote-caching.html">Remote Caching Overview</a></li>
                     <li><a href="/versions/master/remote-caching-debug.html">Debugging Remote Cache Hit Rate for Local Execution</a></li>
                  </ul>
              </li>
              
              <li><a href="/versions/master/platforms-intro.html">Building With Platforms</a></li>
              
             </ul>

           

           <h4>Reference</h4>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h4>Extending Bazel</h4>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/config.html">Configurations</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                  <li><a href="/versions/master/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-7">
          <h1 id="remote-caching">Remote Caching</h1>

<p>A remote cache is used by a team of developers and/or a continuous integration
(CI) system to share build outputs. If your build is reproducible, the
outputs from one machine can be safely reused on another machine, which can
make builds significantly faster.</p>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#remote-caching-overview">Remote caching overview</a></li>
  <li><a href="#how-a-build-uses-remote-caching">How a build uses remote caching</a></li>
  <li><a href="#setting-up-a-server-as-the-caches-backend">Setting up a server as the cache’s backend</a>
    <ul>
      <li><a href="#nginx">nginx</a></li>
      <li><a href="#bazel-remote">bazel-remote</a></li>
      <li><a href="#google-cloud-storage">Google Cloud Storage</a></li>
      <li><a href="#other-servers">Other servers</a></li>
    </ul>
  </li>
  <li><a href="#authentication">Authentication</a></li>
  <li><a href="#http-caching-protocol">HTTP Caching Protocol</a></li>
  <li><a href="#run-bazel-using-the-remote-cache">Run Bazel using the remote cache</a>
    <ul>
      <li><a href="#read-from-and-write-to-the-remote-cache">Read from and write to the remote cache</a></li>
      <li><a href="#read-only-from-the-remote-cache">Read only from the remote cache</a></li>
      <li><a href="#exclude-specific-targets-from-using-the-remote-cache">Exclude specific targets from using the remote cache</a></li>
      <li><a href="#delete-content-from-the-remote-cache">Delete content from the remote cache</a></li>
    </ul>
  </li>
  <li><a href="#disk-cache">Disk cache</a></li>
  <li><a href="#known-issues">Known Issues</a></li>
  <li><a href="#external-links">External Links</a></li>
</ul>

<h2 id="remote-caching-overview">Remote caching overview</h2>

<p>Bazel breaks a build into discrete steps, which are called actions. Each action
has inputs, output names, a command line, and environment variables. Required
inputs and expected outputs are declared explicitly for each action.</p>

<p>You can set up a server to be a remote cache for build outputs, which are these
action outputs. These outputs consist of a list of output file names and the
hashes of their contents. With a remote cache, you can reuse build outputs
from another user’s build rather than building each new output locally.</p>

<p>To use remote caching:</p>

<ul>
  <li>Set up a server as the cache’s backend</li>
  <li>Configure the Bazel build to use the remote cache</li>
  <li>Use Bazel version 0.10.0 or later</li>
</ul>

<p>The remote cache stores two types of data:</p>

<ul>
  <li>The action cache, which is a map of action hashes to action result metadata.</li>
  <li>A content-addressable store (CAS) of output files.</li>
</ul>

<p>Note that the remote cache additionally stores the stdout and stderr for every
action. Inspecting the stdout/stderr of Bazel thus is not a good signal for
<a href="https://docs.bazel.build/versions/master/remote-caching-debug.html">estimating cache hits</a>.</p>

<h3 id="how-a-build-uses-remote-caching">How a build uses remote caching</h3>

<p>Once a server is set up as the remote cache, you use the cache in multiple
ways:</p>

<ul>
  <li>Read and write to the remote cache</li>
  <li>Read and/or write to the remote cache except for specific targets</li>
  <li>Only read from the remote cache</li>
  <li>Not use the remote cache at all</li>
</ul>

<p>When you run a Bazel build that can read and write to the remote cache,
the build follows these steps:</p>

<ol>
  <li>Bazel creates the graph of targets that need to be built, and then creates
a list of required actions. Each of these actions has declared inputs
and output filenames.</li>
  <li>Bazel checks your local machine for existing build outputs and reuses any
that it finds.</li>
  <li>Bazel checks the cache for existing build outputs. If the output is found,
Bazel retrieves the output. This is a cache hit.</li>
  <li>For required actions where the outputs were not found, Bazel executes the
actions locally and creates the required build outputs.</li>
  <li>New build outputs are uploaded to the remote cache.</li>
</ol>

<h2 id="setting-up-a-server-as-the-caches-backend">Setting up a server as the cache’s backend</h2>

<p>You need to set up a server to act as the cache’s backend. A HTTP/1.1
server can treat Bazel’s data as opaque bytes and so many existing servers
can be used as a remote caching backend. Bazel’s
<a href="#http-caching-protocol">HTTP Caching Protocol</a> is what supports remote
caching.</p>

<p>You are responsible for choosing, setting up, and maintaining the backend
server that will store the cached outputs. When choosing a server, consider:</p>

<ul>
  <li>Networking speed. For example, if your team is in the same office, you may
want to run your own local server.</li>
  <li>Security. The remote cache will have your binaries and so needs to be secure.</li>
  <li>Ease of management. For example, Google Cloud Storage is a fully managed service.</li>
</ul>

<p>There are many backends that can be used for a remote cache. Some options
include:</p>

<ul>
  <li><a href="#nginx">nginx</a></li>
  <li><a href="#bazel-remote">bazel-remote</a></li>
  <li><a href="#google-cloud-storage">Google Cloud Storage</a></li>
</ul>

<h3 id="nginx">nginx</h3>

<p>nginx is an open source web server. With its <a href="http://nginx.org/en/docs/http/ngx_http_dav_module.html">WebDAV module</a>, it can be
used as a remote cache for Bazel. On Debian and Ubuntu you can install the
<code class="highlighter-rouge">nginx-extras</code> package. On macOS nginx is available via Homebrew:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew tap denji/nginx
<span class="nv">$ </span>brew <span class="nb">install </span>nginx-full <span class="nt">--with-webdav</span>
</code></pre></div></div>

<p>Below is an example configuration for nginx. Note that you will need to
change <code class="highlighter-rouge">/path/to/cache/dir</code> to a valid directory where nginx has permission
to write and read. You may need to change <code class="highlighter-rouge">client_max_body_size</code> option to a
larger value if you have larger output files. The server will require other
configuration such as authentication.</p>

<p>Example configuration for <code class="highlighter-rouge">server</code> section in <code class="highlighter-rouge">nginx.conf</code>:</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="n">/cache/</span> <span class="p">{</span>
  <span class="c1"># The path to the directory where nginx should store the cache contents.</span>
  <span class="kn">root</span> <span class="n">/path/to/cache/dir</span><span class="p">;</span>
  <span class="c1"># Allow PUT</span>
  <span class="kn">dav_methods</span> <span class="s">PUT</span><span class="p">;</span>
  <span class="c1"># Allow nginx to create the /ac and /cas subdirectories.</span>
  <span class="kn">create_full_put_path</span> <span class="no">on</span><span class="p">;</span>
  <span class="c1"># The maximum size of a single file.</span>
  <span class="kn">client_max_body_size</span> <span class="mi">1G</span><span class="p">;</span>
  <span class="kn">allow</span> <span class="s">all</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="bazel-remote">bazel-remote</h3>

<p>bazel-remote is an open source remote build cache that you can use on
your infrastructure. It has been successfully used in production at
several companies since early 2018. Note that the Bazel project does
not provide technical support for bazel-remote.</p>

<p>This cache stores contents on disk and also provides garbage collection
to enforce an upper storage limit and clean unused artifacts. The cache is
available as a <a href="https://hub.docker.com/r/buchgr/bazel-remote-cache/">docker image</a> and its code is available on
<a href="https://github.com/buchgr/bazel-remote/">GitHub</a>.
Both the REST and gRPC remote cache APIs are supported.</p>

<p>Please refer to the <a href="https://github.com/buchgr/bazel-remote/">GitHub</a> page
for instructions on how to use it.</p>

<h3 id="google-cloud-storage">Google Cloud Storage</h3>

<p><a href="https://cloud.google.com/storage">Google Cloud Storage</a> is a fully managed object store which provides an
HTTP API that is compatible with Bazel’s remote caching protocol. It requires
that you have a Google Cloud account with billing enabled.</p>

<p>To use Cloud Storage as the cache:</p>

<ol>
  <li>
    <p><a href="https://cloud.google.com/storage/docs/creating-buckets">Create a storage bucket</a>.
Ensure that you select a bucket location that’s closest to you, as network bandwidth
is important for the remote cache.</p>
  </li>
  <li>
    <p>Create a service account for Bazel to authenticate to Cloud Storage. See
<a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating_a_service_account">Creating a service account</a>.</p>
  </li>
  <li>
    <p>Generate a secret JSON key and then pass it to Bazel for authentication. Store
the key securely, as anyone with the key can read and write arbitrary data
to/from your GCS bucket.</p>
  </li>
  <li>Connect to Cloud Storage by adding the following flags to your Bazel command:
    <ul>
      <li>Pass the following URL to Bazel by using the flag:
  <code class="highlighter-rouge">--remote_http_cache=https://storage.googleapis.com/bucket-name</code>
  where <code class="highlighter-rouge">bucket-name</code> is the name of your storage bucket.</li>
      <li>Pass the authentication key using the flag: <code class="highlighter-rouge">--google_credentials=/path/to/your/secret-key.json</code>, or
<code class="highlighter-rouge">--google_default_credentials</code> to use <a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a>.</li>
    </ul>
  </li>
  <li>You can configure Cloud Storage to automatically delete old files. To do so, see
<a href="https://cloud.google.com/storage/docs/managing-lifecycles">Managing Object Lifecycles</a>.</li>
</ol>

<h3 id="other-servers">Other servers</h3>

<p>You can set up any HTTP/1.1 server that supports PUT and GET as the cache’s
backend. Users have reported success with caching backends such as <a href="https://hazelcast.com">Hazelcast</a>,
<a href="http://httpd.apache.org">Apache httpd</a>, and <a href="https://aws.amazon.com/s3">AWS S3</a>.</p>

<h2 id="authentication">Authentication</h2>

<p>As of version 0.11.0 support for HTTP Basic Authentication was added to Bazel.
You can pass a username and password to Bazel via the remote cache URL. The
syntax is <code class="highlighter-rouge">https://username:password@hostname.com:port/path</code>. Please note that
HTTP Basic Authentication transmits username and password in plaintext over the
network and it’s thus critical to always use it with HTTPS.</p>

<h2 id="http-caching-protocol">HTTP Caching Protocol</h2>

<p>Bazel supports remote caching via HTTP/1.1. The protocol is conceptually simple:
Binary data (BLOB) is uploaded via PUT requests and downloaded via GET requests.
Action result metadata is stored under the path <code class="highlighter-rouge">/ac/</code> and output files are stored
under the path <code class="highlighter-rouge">/cas/</code>.</p>

<p>For example, consider a remote cache running under <code class="highlighter-rouge">http://localhost:8080/cache</code>.
A Bazel request to download action result metadata for an action with the SHA256
hash <code class="highlighter-rouge">01ba4719...</code> will look as follows:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/cache/ac/01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost:8080</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">*/*</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span>
</code></pre></div></div>

<p>A Bazel request to upload an output file with the SHA256 hash <code class="highlighter-rouge">15e2b0d3...</code> to
the CAS will look as follows:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">PUT</span> <span class="nn">/cache/cas/15e2b0d3c33891ebb0f1ef609ec419420c20e320ce94c65fbc8c3312448eb225</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost:8080</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">*/*</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">9</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span>

0x310x320x330x340x350x360x370x380x39
</code></pre></div></div>

<h2 id="run-bazel-using-the-remote-cache">Run Bazel using the remote cache</h2>

<p>Once a server is set up as the remote cache, to use the remote cache you
need to add flags to your Bazel command. See list of configurations and
their flags below.</p>

<p>You may also need configure authentication, which is specific to your
chosen server.</p>

<p>You may want to add these flags in a <code class="highlighter-rouge">.bazelrc</code> file so that you don’t
need to specify them every time you run Bazel. Depending on your project and
team dynamics, you can add flags to a <code class="highlighter-rouge">.bazelrc</code> file that is:</p>

<ul>
  <li>On your local machine</li>
  <li>In your project’s workspace, shared with the team</li>
  <li>On the CI system</li>
</ul>

<h3 id="read-from-and-write-to-the-remote-cache">Read from and write to the remote cache</h3>

<p>Take care in who has the ability to write to the remote cache. You may want
only your CI system to be able to write to the remote cache.</p>

<p>Use the following flag to read from and write to the remote cache:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build --remote_cache=http://replace-with-your.host:port
</code></pre></div></div>
<p>Besides http, the following protocols are also supported: https, grpc, grpcs.</p>

<p>Use the following flag in addition to the one above to only read from the
remote cache:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build --remote_upload_local_results=false
</code></pre></div></div>

<h3 id="exclude-specific-targets-from-using-the-remote-cache">Exclude specific targets from using the remote cache</h3>

<p>To exclude specific targets from using the remote cache, tag the target with
<code class="highlighter-rouge">no-cache</code>. For example:</p>

<pre><code class="language-starlark">java_library(
    name = "target",
    tags = ["no-cache"],
)
</code></pre>

<h3 id="delete-content-from-the-remote-cache">Delete content from the remote cache</h3>

<p>Deleting content from the remote cache is part of managing your server.
How you delete content from the remote cache depends on the server you have
set up as the cache. When deleting outputs, either delete the entire cache,
or delete old outputs.</p>

<p>The cached outputs are stored as a set of names and hashes. When deleting
content, there’s no way to distinguish which output belongs to a specific
build.</p>

<p>You may want to delete content from the cache to:</p>

<ul>
  <li>Create a clean cache after a cache was poisoned</li>
  <li>Reduce the amount of storage used by deleting old outputs</li>
</ul>

<h3 id="unix-sockets">Unix sockets</h3>

<p>The remote HTTP cache supports connecting over unix domain sockets. The behavior
is similar to curl’s <code class="highlighter-rouge">--unix-socket</code> flag. Use the following to configure unix
domain socket:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build --remote_cache=http://replace-with-your.host:port
build --remote_cache_proxy=unix:/replace/with/socket/path
</code></pre></div></div>

<p>This feature is unsupported on Windows.</p>

<h2 id="disk-cache">Disk cache</h2>

<p>Bazel can use a directory on the file system as a remote cache. This is
useful for sharing build artifacts when switching branches and/or working
on multiple workspaces of the same project, such as multiple checkouts. Since
Bazel does not garbage-collect the directory, you might want to automate a
periodic cleanup of this directory. Enable the disk cache as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build --disk_cache=/path/to/build/cache
</code></pre></div></div>

<p>You can pass a user-specific path to the <code class="highlighter-rouge">--disk_cache</code> flag using the <code class="highlighter-rouge">~</code> alias
(Bazel will substitute the current user’s home directory). This comes in handy
when enabling the disk cache for all developers of a project via the project’s
checked in <code class="highlighter-rouge">.bazelrc</code> file.</p>

<h2 id="known-issues">Known issues</h2>

<p><strong>Input file modification during a build</strong></p>

<p>When an input file is modified during a build, Bazel might upload invalid
results to the remote cache. We implemented a change detection that can be
enabled via the <code class="highlighter-rouge">--experimental_guard_against_concurrent_changes</code> flag. There
are no known issues and we expect to enable it by default in a future release.
See <a href="https://github.com/bazelbuild/bazel/issues/3360">issue #3360</a> for updates. Generally, avoid modifying source files during a
build.</p>

<p><strong>Environment variables leaking into an action</strong></p>

<p>An action definition contains environment variables. This can be a problem for
sharing remote cache hits across machines. For example, environments with
different <code class="highlighter-rouge">$PATH</code> variables won’t share cache hits. Only environment variables
explicitly whitelisted via <code class="highlighter-rouge">--action_env</code> are included in an action
definition. Bazel’s Debian/Ubuntu package used to install <code class="highlighter-rouge">/etc/bazel.bazelrc</code>
with a whitelist of environment variables including <code class="highlighter-rouge">$PATH</code>. If you are getting
fewer cache hits than expected, check that your environment doesn’t have an old
<code class="highlighter-rouge">/etc/bazel.bazelrc</code> file.</p>

<p><strong>Bazel does not track tools outside a workspace</strong></p>

<p>Bazel currently does not track tools outside a workspace. This can be a
problem if, for example, an action uses a compiler from <code class="highlighter-rouge">/usr/bin/</code>. Then,
two users with different compilers installed will wrongly share cache hits
because the outputs are different but they have the same action hash. Please
watch <a href="https://github.com/bazelbuild/bazel/issues/4558">issue #4558</a> for updates.</p>

<p><strong>Incremental in-memory state is lost when running builds inside docker containers</strong>
Bazel use server/client architecture even when running in single docker container.
On server side Bazel maintain in-memory state which speed up builds so when running
builds inside docker containers e.g. in CI, in-memory state is lost so Bazel
must rebuild it before using remote cache.</p>

<h2 id="external-links">External Links</h2>

<ul>
  <li>
    <p><strong>Your Build in a Datacenter:</strong> The Bazel team gave a <a href="https://fosdem.org/2018/schedule/event/datacenter_build/">talk</a> about remote caching and execution at FOSDEM 2018.</p>
  </li>
  <li>
    <p><strong>Faster Bazel builds with remote caching: a benchmark:</strong> Nicolò Valigi wrote a <a href="https://nicolovaligi.com/faster-bazel-remote-caching-benchmark.html">blog post</a> in which he benchmarks remote caching in Bazel.</p>
  </li>
</ul>


        </div>

        <div class="col-md-3 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Remote Caching&body=Documentation URL: https://docs.bazel.build/versions/master/remote-caching.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue for this page</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible'
                     editButtonListItem.style.visibility = 'visible'
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h2"><a href="#contents">Contents</a></li>
<li class="toc-entry toc-h2"><a href="#remote-caching-overview">Remote caching overview</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#how-a-build-uses-remote-caching">How a build uses remote caching</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#setting-up-a-server-as-the-caches-backend">Setting up a server as the cache’s backend</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#nginx">nginx</a></li>
<li class="toc-entry toc-h3"><a href="#bazel-remote">bazel-remote</a></li>
<li class="toc-entry toc-h3"><a href="#google-cloud-storage">Google Cloud Storage</a></li>
<li class="toc-entry toc-h3"><a href="#other-servers">Other servers</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#authentication">Authentication</a></li>
<li class="toc-entry toc-h2"><a href="#http-caching-protocol">HTTP Caching Protocol</a></li>
<li class="toc-entry toc-h2"><a href="#run-bazel-using-the-remote-cache">Run Bazel using the remote cache</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#read-from-and-write-to-the-remote-cache">Read from and write to the remote cache</a></li>
<li class="toc-entry toc-h3"><a href="#exclude-specific-targets-from-using-the-remote-cache">Exclude specific targets from using the remote cache</a></li>
<li class="toc-entry toc-h3"><a href="#delete-content-from-the-remote-cache">Delete content from the remote cache</a></li>
<li class="toc-entry toc-h3"><a href="#unix-sockets">Unix sockets</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#disk-cache">Disk cache</a></li>
<li class="toc-entry toc-h2"><a href="#known-issues">Known issues</a></li>
<li class="toc-entry toc-h2"><a href="#external-links">External Links</a></li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

