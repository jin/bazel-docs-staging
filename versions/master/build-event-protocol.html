<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Build Event Protocol - Bazel </title>

    <link rel="canonical" href="/versions/master/build-event-protocol.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,700|Open+Sans:400,600,700,800" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Build Event Protocol"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-2">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: master</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/build-event-protocol.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/build-event-protocol.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/build-event-protocol.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/build-event-protocol.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/build-event-protocol.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/build-event-protocol.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/build-event-protocol.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/build-event-protocol.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/build-event-protocol.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/build-event-protocol.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/build-event-protocol.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/build-event-protocol.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/build-event-protocol.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/build-event-protocol.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/build-event-protocol.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/build-event-protocol.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/build-event-protocol.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/build-event-protocol.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/build-event-protocol.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/build-event-protocol.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/build-event-protocol.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/build-event-protocol.html">
                    0.17.1
                </option>
                
            </select>

            <h4>Home</h4>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

            <h4>Installing and Using Bazel</h4>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
              <li class="sidebar-nav">
                <a href="/versions/master/updating-bazel.html">Updating Bazel</a>
              </li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Using Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
                  <li><a href="/versions/master/guide.html">User's Guide (Bazel commands)</a></li>
                  <li><a href="/versions/master/external.html">External Dependencies</a></li>
                  <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
                  <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
                  <li><a href="/versions/master/memory-saving-mode.html">Memory-saving Mode</a></li>
                  <li><a href="/versions/master/windows.html">Using Bazel on Windows</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/master/be/functions.html">Functions</a></li>
                  <li><a href="/versions/master/be/common-definitions.html">Common Definitions</a></li>
                  <li><a href="/versions/master/be/make-variables.html">"Make" Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                  <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                </ul>
              </li>

              
                <li><a href="/versions/master/rules.html">Rules</a></li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/aquery.html">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                         <li><a href="/versions/master/remote-execution-caching-debug.html">Debugging Remote Cache Hit Rate</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote Caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/master/remote-caching.html">Remote Caching Overview</a></li>
                     <li><a href="/versions/master/remote-caching-debug.html">Debugging Remote Cache Hit Rate for Local Execution</a></li>
                  </ul>
              </li>
              
              <li><a href="/versions/master/platforms-intro.html">Building With Platforms</a></li>
              
             </ul>

           

           <h4>Reference</h4>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h4>Extending Bazel</h4>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/config.html">Configurations</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                  <li><a href="/versions/master/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-8">
          <div class="content">
            <h1 id="build-event-protocol">Build Event Protocol</h1>

<p>The <a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto">Build Event
Protocol</a>
allows third party programs to gain insight into a Bazel invocation. For
example, you could use the Build Event Protocol to gather information for an IDE
plugin or a dashboard that displays build results.</p>

<p>The protocol is a set of <a href="https://developers.google.com/protocol-buffers/">protocol
buffer</a> messages with some
semantics defined on top of it. It includes information about build and test
results, build progress, the build configuration and much more. The Build Event
Protocol is intended to be consumed programmatically and makes parsing Bazel’s
command line output a thing of the past.</p>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#build-event-protocol-overview">Build Event Protocol Overview</a>
    <ul>
      <li><a href="#build-event-graph">Build Event Graph</a></li>
      <li><a href="#the-build-event-protocol-by-example">The Build Event Protocol by Example</a></li>
    </ul>
  </li>
  <li><a href="#consuming-the-build-event-protocol">Consuming the Build Event Protocol</a>
    <ul>
      <li><a href="#consume-in-a-binary-format">Consume in a Binary Format</a></li>
      <li><a href="#consume-in-text-formats">Consume in Text Formats</a></li>
    </ul>
  </li>
  <li><a href="#the-build-event-service">The Build Event Service</a>
    <ul>
      <li><a href="#build-event-service-flags">Build Event Service Flags</a></li>
      <li><a href="#authentication-and-security">Authentication and Security</a></li>
    </ul>
  </li>
</ul>

<h2 id="build-event-protocol-overview">Build Event Protocol Overview</h2>

<p>The Build Event Protocol represents information about a build as events. A
build event is a protocol buffer message consisting of a build event identifier,
a set of child event identifiers, and a payload.</p>

<ul>
  <li>
    <p><strong>Build Event Identifier:</strong> Depending on the kind of build event, it might be
an <a href="https://github.com/bazelbuild/bazel/blob/16a107d/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L91">opaque
string</a>
or <a href="https://github.com/bazelbuild/bazel/blob/16a107d/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L123">structured
information</a>
revealing more about the build event. A build event identifier is unique within
a build.</p>
  </li>
  <li>
    <p><strong>Children:</strong> A build event may announce other build events, by including
their build event identifiers in its <a href="https://github.com/bazelbuild/bazel/blob/16a107d/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L469">children
field</a>.
For example, the <code class="highlighter-rouge">PatternExpanded</code> build event announces the targets it expands
to as children. The protocol guarantees that all events, except for the first
event, are announced by a previous event.</p>
  </li>
  <li>
    <p><strong>Payload:</strong> The payload contains structured information about a build event,
encoded as a protocol buffer message specific to that event. Note, that the
payload might not be the expected type, but could be an <code class="highlighter-rouge">Aborted</code> message e.g.
if the build aborted prematurely.</p>
  </li>
</ul>

<h3 id="build-event-graph">Build Event Graph</h3>

<p>All build events form a directed acyclic graph through their parent and child
relationship. Every build event except for the initial build event has one or
more parent events. Please note that not all parent events of a child event must
necessarily be posted before it. When a build is complete (succeeded or failed)
all announced events will have been posted. In case of a Bazel crash or a failed
network transport, some announced build events may never be posted.</p>

<h2 id="the-build-event-protocol-by-example">The Build Event Protocol by Example</h2>

<p>The full specification of the Build Event Protocol can be found in its protocol
buffer definition and describing it here is beyond the scope of this document.
However, it might be helpful to build up some intuition before looking at the
specification.</p>

<p>Consider a simple Bazel workspace that consists of two empty shell scripts
<code class="highlighter-rouge">foo.sh</code> and <code class="highlighter-rouge">foo_test.sh</code> and the following BUILD file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh_binary<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"foo"</span>,
    srcs <span class="o">=</span> <span class="o">[</span><span class="s2">"foo.sh"</span><span class="o">]</span>,
<span class="o">)</span>

sh_library<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"foo_lib"</span>,
    data <span class="o">=</span> <span class="o">[</span><span class="s2">":foo"</span><span class="o">]</span>,
<span class="o">)</span>

sh_test<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"foo_test"</span>,
    srcs <span class="o">=</span> <span class="o">[</span><span class="s2">"foo_test.sh"</span><span class="o">]</span>,
    deps <span class="o">=</span> <span class="o">[</span><span class="s2">":foo_lib"</span><span class="o">]</span>,
<span class="o">)</span>
</code></pre></div></div>

<p>When running <code class="highlighter-rouge">bazel test ...</code> on this project the build graph of the generated
build events will resemble the graph below. The arrows indicate the
aforementioned parent and child relationship. Note that some build events and
most fields have been omitted for brevity.</p>

<p><img src="/assets/bep-graph.svg" alt="bep-graph" /></p>

<p>Initially, a <code class="highlighter-rouge">BuildStarted</code> event is published. The event informs us that the
build was invoked through the <code class="highlighter-rouge">bazel test</code> command and it also announces five
child events: <code class="highlighter-rouge">OptionsParsed</code>, <code class="highlighter-rouge">WorkspaceStatus</code>, <code class="highlighter-rouge">CommandLine</code>,
<code class="highlighter-rouge">PatternExpanded</code> and <code class="highlighter-rouge">Progress</code>. The first three events provide information
about how Bazel was invoked. The <code class="highlighter-rouge">PatternExpanded</code> build event provides insight
into which specific targets the <code class="highlighter-rouge">...</code> pattern expanded to: <code class="highlighter-rouge">//:foo</code>,
<code class="highlighter-rouge">//:foo_lib</code> and <code class="highlighter-rouge">//:foo_test</code>. It does so by declaring three <code class="highlighter-rouge">TargetConfigured</code>
events as children.</p>

<p>Note that the <code class="highlighter-rouge">TargetConfigured</code> event declares the <code class="highlighter-rouge">Configuration</code> event as a
child event, even though <code class="highlighter-rouge">Configuration</code> has been posted before the
<code class="highlighter-rouge">TargetConfigured</code> event.</p>

<p>Besides the parent and child relationship, events may also refer to each other
using their build event identifiers. For example, in the above graph the
<code class="highlighter-rouge">TargetComplete</code> event refers to the <code class="highlighter-rouge">NamedSetOfFiles</code> event in its <code class="highlighter-rouge">fileSets</code>
field.</p>

<p>Build events that refer to files (i.e. outputs) usually don’t embed the file
names and paths in the event. Instead, they contain the build event identifier
of a <code class="highlighter-rouge">NamedSetOfFiles</code> event, which will then contain the actual file names and
paths. The <code class="highlighter-rouge">NamedSetOfFiles</code> event allows a set of files to be reported once and
referred to by many targets. This structure is necessary because otherwise in
some cases the Build Event Protocol output size would grow quadratically with
the number of files. A <code class="highlighter-rouge">NamedSetOfFiles</code> event may also not have all its files
embedded, but instead refer to other <code class="highlighter-rouge">NamedSetOfFiles</code> events through their
build event identifiers.</p>

<p>Below is an instance of the <code class="highlighter-rouge">TargetComplete</code> event for the <code class="highlighter-rouge">//:foo_lib</code> target
from the above graph, printed in protocol buffer’s JSON representation. The
build event identifier contains the target as an opaque string and refers to the
<code class="highlighter-rouge">Configuration</code> event using its build event identifier. The event does not
announce any child events. The payload contains information about whether the
target was built successfully, the set of output files, and the kind of target
built.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"targetCompleted"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"//:foo_lib"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"544e39a7f0abdb3efdd29d675a48bc6a"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"completed"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"outputGroup"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fileSets"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
      </span><span class="p">}]</span><span class="w">
    </span><span class="p">}],</span><span class="w">
    </span><span class="nl">"targetKind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sh_library rule"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="consuming-the-build-event-protocol">Consuming the Build Event Protocol</h2>

<h3 id="consume-in-a-binary-format">Consume in a Binary Format</h3>

<p>To consume the Build Event Protocol in a binary format:</p>

<ol>
  <li>
    <p>Have Bazel serialize the protocol buffer messages to a file by specifying the
option <code class="highlighter-rouge">--build_event_binary_file=/path/to/file</code>. The file will contain
serialized protocol buffer messages with each message being length delimited.
Each message is prefixed with its length encoded as a variable length integer.
This format can be read using the protocol buffer library’s
<a href="https://developers.google.com/protocol-buffers/docs/reference/java/com/google/protobuf/AbstractParser#parseDelimitedFrom-java.io.InputStream-"><code class="highlighter-rouge">parseDelimitedFrom(InputStream)</code></a>
method.</p>
  </li>
  <li>
    <p>Then, write a program that extracts the relevant information from the
serialized protocol buffer message.</p>
  </li>
</ol>

<h3 id="consume-in-text-formats">Consume in Text Formats</h3>

<p>The following Bazel command line flags will output the Build Event Protocol in a
human-readable formats:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--build_event_text_file
--build_event_json_file
</code></pre></div></div>

<h2 id="the-build-event-service">The Build Event Service</h2>

<p>The <a href="https://github.com/googleapis/googleapis/blob/master/google/devtools/build/v1/publish_build_event.proto">Build Event
Service</a>
Protocol is a generic <a href="https://www.grpc.io">gRPC</a> service for transmitting build
events. The Build Event Service protocol is independent of the Build Event
Protocol and treats the Build Event Protocol events as opaque bytes. Bazel ships
with a gRPC client implementation of the Build Event Service protocol that
transmits Build Event Protocol events. One can specify the endpoint to send the
events to using the <code class="highlighter-rouge">--bes_backend=HOST:PORT flag</code>. Bazel’s implementation also
supports TLS which can be enabled by specifying the <code class="highlighter-rouge">--tls_enabled flag</code>.</p>

<p>There is currently an experimental open source implementation of the <a href="https://github.com/buildbarn/bb-event-service/">Build
Event Service</a> in Go as part of
the Buildbarn suite of Remote Execution tools and services.</p>

<h3 id="build-event-service-flags">Build Event Service Flags</h3>

<p>Bazel has several flags related to the Build Event Service protocol, including:</p>

<ul>
  <li><code class="highlighter-rouge">--bes_backend</code></li>
  <li><code class="highlighter-rouge">--[no]bes_best_effort</code></li>
  <li><code class="highlighter-rouge">--[no]bes_lifecycle_events</code></li>
  <li><code class="highlighter-rouge">--bes_results_url</code></li>
  <li><code class="highlighter-rouge">--bes_timeout</code></li>
  <li><code class="highlighter-rouge">--project_id</code></li>
</ul>

<p>For a description of each of these flags, see the
<a href="command-line-reference.html">Command-Line Reference</a>.</p>

<h3 id="authentication-and-security">Authentication and Security</h3>

<p>Bazel’s Build Event Service implementation also supports authentication and TLS.
These settings can be controlled using the below flags. Please note that these
flags are also used for Bazel’s Remote Execution. This implies that the Build
Event Service and Remote Execution Endpoints need to share the same
authentication and TLS infrastructure.</p>

<ul>
  <li><code class="highlighter-rouge">--[no]google_default_credentials</code></li>
  <li><code class="highlighter-rouge">--google_credentials</code></li>
  <li><code class="highlighter-rouge">--google_auth_scopes</code></li>
  <li><code class="highlighter-rouge">--tls_certificate</code></li>
  <li><code class="highlighter-rouge">--[no]tls_enabled</code></li>
</ul>

<p>For a description of each of these flags, see the
<a href="command-line-reference.html">Command-Line Reference</a>.</p>

<h3 id="build-event-service-and-remote-caching">Build Event Service and Remote Caching</h3>

<p>The BEP typically contains many references to log files (test.log, test.xml,
etc. ) stored on the machine where Bazel is running. A remote BES server
typically can’t access these files as they are on different machines. A way to
work around this issue is to use Bazel with <a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/remote/README.html">remote
caching</a>.
Bazel will upload all output files to the remote cache (including files
referenced in the BEP) and the BES server can then fetch the referenced files
from the cache.</p>

<p>See <a href="https://github.com/bazelbuild/bazel/issues/3689">GitHub issue 3689</a> for
more details.</p>

          </div>
        </div>

        <div class="col-md-2 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Build Event Protocol&body=Documentation URL: https://docs.bazel.build/versions/master/build-event-protocol.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible';
                     editButtonListItem.style.visibility = 'visible';
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h2"><a href="#contents">Contents</a></li>
<li class="toc-entry toc-h2"><a href="#build-event-protocol-overview">Build Event Protocol Overview</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#build-event-graph">Build Event Graph</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#the-build-event-protocol-by-example">The Build Event Protocol by Example</a></li>
<li class="toc-entry toc-h2"><a href="#consuming-the-build-event-protocol">Consuming the Build Event Protocol</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#consume-in-a-binary-format">Consume in a Binary Format</a></li>
<li class="toc-entry toc-h3"><a href="#consume-in-text-formats">Consume in Text Formats</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#the-build-event-service">The Build Event Service</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#build-event-service-flags">Build Event Service Flags</a></li>
<li class="toc-entry toc-h3"><a href="#authentication-and-security">Authentication and Security</a></li>
<li class="toc-entry toc-h3"><a href="#build-event-service-and-remote-caching">Build Event Service and Remote Caching</a></li>
</ul>
</li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

