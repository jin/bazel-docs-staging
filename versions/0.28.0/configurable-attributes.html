<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Configurable Build Attributes - Bazel 0.28.0</title>

    <link rel="canonical" href="/versions/0.28.0/configurable-attributes.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,700|Open+Sans:400,600,700,800" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Configurable Build Attributes"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-2">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: 0.28.0</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/configurable-attributes.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.2.0/configurable-attributes.html">
                    3.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.1.0/configurable-attributes.html">
                    3.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.0.0/configurable-attributes.html">
                    3.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.2.0/configurable-attributes.html">
                    2.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/configurable-attributes.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/configurable-attributes.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/configurable-attributes.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/configurable-attributes.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/configurable-attributes.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/configurable-attributes.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/configurable-attributes.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/configurable-attributes.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/configurable-attributes.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/configurable-attributes.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/configurable-attributes.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/configurable-attributes.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/configurable-attributes.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/configurable-attributes.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/configurable-attributes.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/configurable-attributes.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/configurable-attributes.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/configurable-attributes.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/configurable-attributes.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/configurable-attributes.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/configurable-attributes.html">
                    0.17.1
                </option>
                
            </select>

            <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/0.28.0/bazel-overview.html">Bazel overview</a></li>
              <li><a href="/versions/0.28.0/bazel-vision.html">Bazel vision</a></li>
              <li><a href="/versions/0.28.0/getting-started.html">Getting started</a></li>
              <li><a href="/versions/0.28.0/backward-compatibility.html">Backward compatibility</a></li>
            </ul>

            <h3>Installing Bazel</h3>
            <ul class="sidebar-nav">

              <li class="sidebar-nav">
                <a href="/versions/0.28.0/install.html">Installation overview</a>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installation steps<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">

                   <li><a href="/versions/0.28.0/install-ubuntu.html">Ubuntu</a></li>
                   <li><a href="/versions/0.28.0/install-redhat.html">Fedora/CentOS</a></li>
                   <li><a href="/versions/0.28.0/install-os-x.html">macOS</a></li>
                   <li><a href="/versions/0.28.0/install-windows.html">Windows</a></li>
                   <li><a href="/versions/0.28.0/install-compile-source.html">Compiling from source</a></li>
                   <li><a href="/versions/0.28.0/completion.html">Command-line completion</a></li>
                   <li><a href="/versions/0.28.0/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
            </ul>

            <h3>Tutorials</h3>
            <ul class="sidebar-nav">
                <li><a href="/versions/0.28.0/tutorial/cpp.html">C++</a></li>
                <li><a href="/versions/0.28.0/tutorial/java.html">Java</a></li>
                <li><a href="/versions/0.28.0/tutorial/android-app.html">Android</a></li>
                <li><a href="/versions/0.28.0/tutorial/ios-app.html">iOS</a></li>
            </ul>

            <h3>Using Bazel</h3>
            <ul class="sidebar-nav">
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/0.28.0/build-ref.html">Core concepts</a></li>
                  <li><a href="/versions/0.28.0/external.html">External dependencies</a></li>
                  <li><a href="/versions/0.28.0/configurable-attributes.html">Configurable attributes</a></li>
                  <li><a href="/versions/master/platforms-intro.html">Platforms and toolchains</a></li>
                  <li><a href="/versions/master/visibility.html">Visibility</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#guides-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  Guides<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="guides-menu">
                  <li><a href="/versions/0.28.0/guide.html">Running Bazel</a></li>
                  <li><a href="/versions/0.28.0/skylark/tutorial-creating-a-macro.html">Creating a macro</a></li>
                  <li><a href="/versions/0.28.0/memory-saving-mode.html">Optimizing memory</a></li>
                  <li><a href="/versions/0.28.0/windows.html">Building on Windows</a></li>
                </ul>
              </li>

              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/0.28.0/query-how-to.html">The query command</a></li>
                  <li><a href="/versions/0.28.0/cquery.html">The cquery command</a></li>
                  <li><a href="/versions/0.28.0/aquery.html">The aquery command</a></li>
                  <li><a href="/versions/0.28.0/query.html">Query language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#best-practices-menu" aria-expanded="false"
                    aria-controls="best-practices-menu">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="best-practices-menu">
                  <li><a href="/versions/0.28.0/best-practices.html">General best practices</a></li>
                  <li><a href="/versions/0.28.0/skylark/tutorial-sharing-variables.html">Sharing BUILD variables</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/0.28.0/remote-execution.html">Overview</a></li>
                   <li><a href="/versions/0.28.0/remote-execution-rules.html">Guidelines</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/0.28.0/remote-execution-sandbox.html">Troubleshooting with Bazel sandbox</a></li>
                         <li><a href="/versions/0.28.0/workspace-log.html">Non-hermetic WORKSPACE rules</a></li>
                         <li><a href="/versions/0.28.0/remote-execution-caching-debug.html">Debugging remote cache hits</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/0.28.0/remote-execution-ci.html">Remote execution and CI</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/0.28.0/remote-caching.html">Overview</a></li>
                     <li><a href="/versions/0.28.0/remote-caching-debug.html">Debugging remote cache hits with local execution</a></li>
                  </ul>
              </li>
              
             </ul>

           
           <h4>Rules</h4>
           <ul class="sidebar-nav">
             <li><a href="/versions/0.28.0/be/overview.html">Build encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/0.28.0/tutorial/android-app.html">Tutorial</a></li>
                  <li><a href="/versions/0.28.0/bazel-and-android.html">Android resources</a></li>
                  <li><a href="/versions/0.28.0/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/0.28.0/android-instrumentation-test.html">Android instrumentation tests</a></li>
                  <li><a href="/versions/0.28.0/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/0.28.0/tutorial/ios-app.html">Tutorial</a></li>
                  <li><a href="/versions/0.28.0/bazel-and-apple.html">Apple resources</a></li>
                  <li><a href="/versions/0.28.0/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/0.28.0/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/0.28.0/tutorial/cpp.html">Tutorial</a></li>
                  <li><a href="/versions/0.28.0/bazel-and-cpp.html">C++ resources</a></li>
                  <li><a href="/versions/0.28.0/cpp-use-cases.html">C++ use cases</a></li>
                  <li>
                    <a href="/versions/0.28.0/cc-toolchain-config-reference.html">
                      C++ Toolchain Configuration
                    </a>
                  </li>
                  <li>
                    <a href="/versions/0.28.0/tutorial/cc-toolchain-config.html">
                      Tutorial: Configuring C++ Toolchains
                    </a>
                  </li>
                  <li>
                    <a href="/versions/0.28.0/integrating-with-rules-cc.html">
                      Integrating with C++ rules
                    </a>
                  </li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/0.28.0/tutorial/java.html">Tutorial</a></li>
                  <li><a href="/versions/0.28.0/bazel-and-java.html">Java resources</a></li>
                  <li><a href="/versions/0.28.0/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/0.28.0/generate-workspace.html">Converting Maven dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/0.28.0/bazel-and-javascript.html">JavaScript resources</a></li>
                  <li><a href="/versions/0.28.0/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>
           

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/0.28.0/user-manual.html">Commands and options</a></li>
             <li><a href="/versions/0.28.0/glossary.html">Glossary</a></li>
             <li><a href="/versions/0.28.0/be/overview.html">Build encyclopedia</a></li>
             <li><a href="/versions/0.28.0/test-encyclopedia.html">Test encyclopedia</a></li>
             <li><a href="/versions/0.28.0/command-line-reference.html">Command line reference</a></li>

             <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/0.28.0/be/functions.html">Functions</a></li>
                  <li><a href="/versions/0.28.0/be/common-definitions.html">Common rule definitions</a></li>
                  <li><a href="/versions/0.28.0/be/make-variables.html">"Make" variables</a></li>
                  <li><a href="/versions/0.28.0/skylark/build-style.html">BUILD style guide</a></li>
                </ul>
             </li>

             <li><a href="/versions/0.28.0/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/0.28.0/output_directories.html">Output directory layout</a></li>
             <li><a href="/versions/0.28.0/platforms.html">Platforms</a></li>
             <li><a href="/versions/0.28.0/toolchains.html">Toolchains</a></li>
           </ul>

           <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/0.28.0/skylark/concepts.html">Extension overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/0.28.0/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/0.28.0/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/0.28.0/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/0.28.0/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/0.28.0/skylark/repository_rules.html">Repository rules</a></li>
                  <li><a href="/versions/0.28.0/skylark/config.html">Configurations</a></li>
                </ul>
              </li>

	            <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                   href="#starlark-practices" aria-expanded="false"
                   aria-controls="starlark-practices">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/0.28.0/skylark/bzl-style.html">.bzl style guide</a></li>
                  <li><a href="/versions/0.28.0/skylark/testing.html">Testing extensions</a></li>
                  <li><a href="https://github.com/bazelbuild/stardoc">Documenting rules with Stardoc</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linting</a></li>
                  <li><a href="/versions/0.28.0/skylark/performance.html">Optimizing performance</a></li>
                  <li><a href="/versions/0.28.0/skylark/deploying.html">Deploying rules</a></li>
                  <li><a href="/versions/0.28.0/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/0.28.0/skylark/lib/skylark-overview.html">Extensions API</a></li>
              <li><a href="/versions/0.28.0/skylark/faq.html">FAQ</a></li>
              <li><a href="/versions/0.28.0/skylark/language.html">Starlark language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-8">
          <div class="content">
            <h1 id="configurable-build-attributes">Configurable Build Attributes</h1>

<h3 id="contents">Contents</h3>
<ul>
  <li><a href="#example">Example</a></li>
  <li><a href="#configuration-conditions">Configuration Conditions</a></li>
  <li><a href="#defaults">Defaults</a></li>
  <li><a href="#custom-keys">Custom Keys</a></li>
  <li><a href="#platforms">Platforms</a></li>
  <li><a href="#short-keys">Short Keys</a></li>
  <li><a href="#multiple-selects">Multiple Selects</a></li>
  <li><a href="#or-chaining">OR Chaining</a>
    <ul>
      <li><a href="#selects-with-or">selects.with_or</a></li>
      <li><a href="#config-setting-aliasing">config_setting Aliasing</a></li>
    </ul>
  </li>
  <li><a href="#custom-error-messages">Custom Error Messages</a></li>
  <li><a href="#rules">Rules Compatibility</a></li>
  <li><a href="#query">Bazel Query and Cquery</a></li>
  <li><a href="#faq">FAQ</a>
    <ul>
      <li><a href="#macros-select">Why doesn’t select() work in macros?</a></li>
      <li><a href="#boolean-select">Why does select() always return true?</a></li>
      <li><a href="#inspectable-select">Can I read select() like a dict?</a></li>
      <li><a href="#bind-select">Why doesn’t select() work with bind()?</a></li>
    </ul>
  </li>
</ul>

<p> </p>

<p><strong><em>Configurable attributes</em></strong>, commonly known as <a href="be/functions.html#select"><code class="highlighter-rouge">select()</code></a>, is a Bazel feature that lets users toggle the values
of BUILD rule attributes at the command line.</p>

<p>This can be used, for example, for a multiplatform library that automatically
chooses the appropriate implementation for the architecture, or for a
feature-configurable binary that can be customized at build time.</p>

<h2 id="example">Example</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myapp/BUILD
</span>
<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"mybinary"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"main.cc"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":arm_build"</span><span class="p">:</span> <span class="p">[</span><span class="s">":arm_lib"</span><span class="p">],</span>
        <span class="s">":x86_debug_build"</span><span class="p">:</span> <span class="p">[</span><span class="s">":x86_dev_lib"</span><span class="p">],</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="p">[</span><span class="s">":generic_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"arm_build"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"cpu"</span><span class="p">:</span> <span class="s">"arm"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"x86_debug_build"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"x86"</span><span class="p">,</span>
        <span class="s">"compilation_mode"</span><span class="p">:</span> <span class="s">"dbg"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This declares a <code class="highlighter-rouge">cc_binary</code> that “chooses” its deps based on the flags at the
command line. Specficially, <code class="highlighter-rouge">deps</code> becomes:</p>

<table>
  <tr style="background: #E9E9E9; font-weight: bold">
    <td>Command</td>
    <td>deps =</td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary --cpu=arm</code></td>
    <td><code>[":arm_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary -c dbg --cpu=x86</code></td>
    <td><code>[":x86_dev_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary --cpu=ppc</code></td>
    <td><code>[":generic_lib"]</code></td>
  </tr>
  <tr>
    <td><code>bazel build //myapp:mybinary -c dbg --cpu=ppc</code></td>
    <td><code>[":generic_lib"]</code></td>
  </tr>
</table>
<p><code class="highlighter-rouge">select()</code> serves as a placeholder for a value that will be chosen based on
<em>configuration conditions</em>. These conditions are labels that refer to
<a href="be/general.html#config_setting"><code class="highlighter-rouge">config_setting</code></a> targets. By using <code class="highlighter-rouge">select()</code>
in a configurable attribute, the attribute effectively takes on different values
when different conditions hold.</p>

<p>Matches must be unambiguous: either exactly one condition must match or, if
multiple conditions match, one’s <code class="highlighter-rouge">values</code> must be a strict superset of all
others’. For example, <code class="highlighter-rouge">values = {"cpu": "x86", "compilation_mode": "dbg"}</code> is an
unambiguous specialization of <code class="highlighter-rouge">values = {"cpu": "x86"}</code>. The built-in condition
<a href="#defaults"><code class="highlighter-rouge">//conditions:default</code></a> automatically matches when nothing else
does.</p>

<p>This example uses <code class="highlighter-rouge">deps</code>. But <code class="highlighter-rouge">select()</code> works just as well on <code class="highlighter-rouge">srcs</code>,
<code class="highlighter-rouge">resources</code>, <code class="highlighter-rouge">cmd</code>, or practically any other attribute. Only a small number of
attributes are <em>non-configurable</em>, and those are clearly annotated; for
instance, <code class="highlighter-rouge">config_setting</code>’s own
<a href="be/general.html#config_setting.values"><code class="highlighter-rouge">values</code></a> attribute is non-configurable.</p>

<p>Certain attributes, like the <code class="highlighter-rouge">tools</code> of a <code class="highlighter-rouge">genrule</code>, have the effect of changing
the build parameters (such as the cpu) for all targets that transitively appear
beneath them. This will affect how conditions are matched within those targets
but not within the attribute that causes the change. That is, a <code class="highlighter-rouge">select</code> in the
<code class="highlighter-rouge">tools</code> attribute of a <code class="highlighter-rouge">genrule</code> will work the same as a <code class="highlighter-rouge">select</code> in the <code class="highlighter-rouge">srcs</code>.</p>

<h2 id="configuration-conditions">Configuration Conditions</h2>

<p>Each key in a configurable attribute is a label reference to a
<a href="be/general.html#config_setting"><code class="highlighter-rouge">config_setting</code></a> target. This is just a
collection of expected command line flag settings. By encapsulating these in a
target, it’s easy to maintain “standard” conditions that can be referenced
across targets and BUILD files.</p>

<p>The core <code class="highlighter-rouge">config_setting</code> syntax is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"meaningful_condition_name"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"flag1"</span><span class="p">:</span> <span class="s">"expected_value1"</span><span class="p">,</span>
        <span class="s">"flag2"</span><span class="p">:</span> <span class="s">"expected_value2"</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">flagN</code> is an arbitrary Bazel command line flag. <code class="highlighter-rouge">value</code> is the expected value
for that flag. A <code class="highlighter-rouge">config_setting</code> matches when <em>all</em> of its flags match (order
is irrelevant).</p>

<p><code class="highlighter-rouge">values</code> entries use the same parsing logic as at the actual command line. This
means:</p>

<ul>
  <li><code class="highlighter-rouge">values = { "compilation_mode": "opt" }</code> matches <code class="highlighter-rouge">bazel build -c opt ...</code></li>
  <li><code class="highlighter-rouge">values = { "java_header_compilation": "true" }</code> matches <code class="highlighter-rouge">bazel build
--java_header_compilation=1 ...</code></li>
  <li><code class="highlighter-rouge">values = { "java_header_compilation": "0" }</code> matches <code class="highlighter-rouge">bazel build
--nojava_header_compilation ...</code></li>
</ul>

<p><code class="highlighter-rouge">config_setting</code> only works with flags that affect build rule output. For
example, <a href="user-manual.html#flag--show_progress"><code class="highlighter-rouge">--show_progress</code></a> isn’t allowed
because this only affects how Bazel reports progress to the user.</p>

<p><code class="highlighter-rouge">config_setting</code> semantics are intentionally simple. For example, there’s no
direct support for <code class="highlighter-rouge">OR</code> chaining (although a
<a href="#or-chaining">convenience function</a> provides this).  Consider writing
macros for complicated flag logic.</p>

<h2 id="defaults">Defaults</h2>

<p>The built-in condition <code class="highlighter-rouge">//conditions:default</code> matches when no other condition
matches.</p>

<p>Because of the “exactly one match” rule, a configurable attribute with no match
and no default condition triggers a <code class="highlighter-rouge">"no matching conditions"</code> error. This can
protect against silent failures from unexpected build flags:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># foo/BUILD
</span>
<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"foobar"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=bar"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":foobar"</span><span class="p">:</span> <span class="p">[</span><span class="s">"foobar_lib.cc"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //foo:my_lib <span class="nt">--define</span> <span class="nv">foo</span><span class="o">=</span>baz
ERROR: Configurable attribute <span class="s2">"srcs"</span> doesn<span class="s1">'t match this configuration (would
a default condition help?).
Conditions checked:
  //foo:foobar
</span></code></pre></div></div>

<p><code class="highlighter-rouge">select()</code> can include a <a href="#custom-error-messages"><code class="highlighter-rouge">no_match_error</code></a> for custom
failure messages.</p>

<h2 id="custom-keys">Custom Keys</h2>

<p>Since <code class="highlighter-rouge">config_setting</code> currently only supports built-in Bazel flags, the level
of custom conditioning it can support is limited. For example, there’s no Bazel
flag for <code class="highlighter-rouge">IncludeSpecialProjectFeatureX</code>.</p>

<p>Plans for <a href="https://docs.google.com/document/d/1vc8v-kXjvgZOdQdnxPTaV0rrLxtP2XwnD2tAZlYJOqw/edit?usp=sharing">truly custom flags</a>
are underway. In the meantime, <a href="user-manual.html#flag--define"><code class="highlighter-rouge">--define</code></a> is
the best approach for these purposes.
<code class="highlighter-rouge">--define</code> is a bit awkward to use and wasn’t originally designed for this
purpose. We recommend using it sparingly until true custom flags are available.
For example, don’t use <code class="highlighter-rouge">--define</code> to specify multiple variants of top-level
binary. Just use multiple targets instead.</p>

<p>To trigger an arbitrary condition with <code class="highlighter-rouge">--define</code>, write</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"bar"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=bar"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"baz"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"foo=baz"</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>and run <code class="highlighter-rouge">$ bazel build //my:target --define foo=baz</code>.</p>

<p>The <code class="highlighter-rouge">values</code> attribute can’t contain multiple <code class="highlighter-rouge">define</code>s. This is
because each instance has the same dictionary key. To solve this, use
<code class="highlighter-rouge">define_values</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"bar_and_baz"</span><span class="p">,</span>
    <span class="n">define_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"foo"</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span>  <span class="c1"># matches --define foo=bar
</span>        <span class="s">"baz"</span><span class="p">:</span> <span class="s">"bat"</span><span class="p">,</span>  <span class="c1"># matches --define baz=bat
</span>    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>When <code class="highlighter-rouge">define</code>s appear in both <code class="highlighter-rouge">values</code> and <code class="highlighter-rouge">define_values</code>, all must match for
the <code class="highlighter-rouge">config_setting</code> to match.</p>

<h2 id="platforms">Platforms</h2>

<p>While the ability to specify multiple flags on the command line provides
flexibility, it can also be burdensome to individually set each one every time
you want to build a target.
   <a href="platforms.html">Platforms</a>
allow you to consolidate these into simple bundles.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myapp/BUILD
</span>
<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_rocks"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":basalt"</span><span class="p">:</span> <span class="p">[</span><span class="s">"pyroxene.sh"</span><span class="p">],</span>
        <span class="s">":marble"</span><span class="p">:</span> <span class="p">[</span><span class="s">"calcite.sh"</span><span class="p">],</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="p">[</span><span class="s">"feldspar.sh"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"basalt"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":black"</span><span class="p">,</span>
        <span class="s">":igneous"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"marble"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":white"</span><span class="p">,</span>
        <span class="s">":metamorphic"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c1"># constraint_setting acts as an enum type, and constraint_value as an enum value.
</span><span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"black"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"white"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"color"</span><span class="p">)</span>
<span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"texture"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"smooth"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"texture"</span><span class="p">)</span>
<span class="n">constraint_setting</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"igneous"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>
<span class="n">constraint_value</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"metamorphic"</span><span class="p">,</span> <span class="n">constraint_setting</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">)</span>

<span class="n">platform</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"basalt_platform"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":black"</span><span class="p">,</span>
        <span class="s">":igneous"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">platform</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"marble_platform"</span><span class="p">,</span>
    <span class="n">constraint_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">":white"</span><span class="p">,</span>
        <span class="s">":smooth"</span><span class="p">,</span>
        <span class="s">":metamorphic"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The platform can be specified on the command line. It activates the
<code class="highlighter-rouge">config_setting</code>s that contain a subset of the platform’s <code class="highlighter-rouge">constraint_values</code>,
allowing those <code class="highlighter-rouge">config_setting</code>s to match in <code class="highlighter-rouge">select()</code> expressions.</p>

<p>For example, in order to set the <code class="highlighter-rouge">srcs</code> attribute of <code class="highlighter-rouge">my_rocks</code> to <code class="highlighter-rouge">calcite.sh</code>,
we can simply run</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my_app:my_rocks <span class="nt">--platforms</span><span class="o">=</span>//myapp:marble_platform
</code></pre></div></div>

<p>Without platforms, this might look something like</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my_app:my_rocks <span class="nt">--define</span> <span class="nv">color</span><span class="o">=</span>white <span class="nt">--define</span> <span class="nv">texture</span><span class="o">=</span>smooth <span class="nt">--define</span> <span class="nb">type</span><span class="o">=</span>metamorphic
</code></pre></div></div>

<p>Platforms are still under development. See the <a href="platforms.html">documentation</a>
and <a href="https://bazel.build/roadmaps/platforms.html">roadmap</a> for details.</p>

<h2 id="short-keys">Short Keys</h2>

<p>Since configuration keys are target labels, their names can get long and
unwieldy. This can be mitigated with local variable definitions:</p>

<p>Before:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//my/project/my/team/configs:config1"</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_1.sh"</span><span class="p">],</span>
        <span class="s">"//my/project/my/team/configs:config2"</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_2.sh"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CONFIG1</span><span class="o">=</span><span class="s">"//my/project/my/team/configs:config1"</span>
<span class="n">CONFIG2</span><span class="o">=</span><span class="s">"//my/project/my/team/configs:config2"</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="n">CONFIG1</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_1.sh"</span><span class="p">],</span>
        <span class="n">CONFIG2</span><span class="p">:</span> <span class="p">[</span><span class="s">"my_target_2.sh"</span><span class="p">],</span>
    <span class="p">})</span>
<span class="p">)</span>
</code></pre></div></div>

<p>For more complex expressions, you can use <a href="skylark/macros.html">macros</a>:</p>

<p>Before:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># foo/BUILD
</span>
<span class="n">genrule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"my_target.out"</span><span class="p">],</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//my/project/my/team/configs/config1"</span><span class="p">:</span> <span class="s">"echo custom val: this &gt; $@"</span><span class="p">,</span>
        <span class="s">"//my/project/my/team/configs/config2"</span><span class="p">:</span> <span class="s">"echo custom val: that &gt; $@"</span><span class="p">,</span>
        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="s">"echo default output &gt; $@"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># foo/genrule_select.bzl
</span>
<span class="k">def</span> <span class="nf">select_echo</span><span class="p">(</span><span class="n">input_dict</span><span class="p">):</span>
    <span class="n">echo_cmd</span> <span class="o">=</span> <span class="s">"echo </span><span class="si">%</span><span class="s">s &gt; $@"</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">"//conditions:default"</span><span class="p">:</span> <span class="n">echo_cmd</span> <span class="o">%</span> <span class="s">"default output"</span><span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">echo_cmd</span> <span class="o">%</span> <span class="p">(</span><span class="s">"custom val: "</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s">"//my/project/my/team/configs/config"</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span>
    <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="n">out_dict</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># foo/BUILD
</span>
<span class="n">load</span><span class="p">(</span><span class="s">"//foo:genrule_select.bzl"</span><span class="p">,</span> <span class="s">"select_echo"</span><span class="p">)</span>

<span class="n">genrule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"my_target.out"</span><span class="p">],</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">select_echo</span><span class="p">({</span>
        <span class="s">"1"</span><span class="p">:</span> <span class="s">"this"</span><span class="p">,</span>
        <span class="s">"2"</span><span class="p">:</span> <span class="s">"that"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="multiple-selects">Multiple Selects</h2>

<p><code class="highlighter-rouge">select</code> can appear multiple times in the same attribute:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">]</span> <span class="o">+</span>
           <span class="n">select</span><span class="p">({</span>
               <span class="s">":armeabi_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"armeabi_src.sh"</span><span class="p">],</span>
               <span class="s">":x86_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"x86_src.sh"</span><span class="p">],</span>
           <span class="p">})</span> <span class="o">+</span>
           <span class="n">select</span><span class="p">({</span>
               <span class="s">":opt_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"opt_extras.sh"</span><span class="p">],</span>
               <span class="s">":dbg_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"dbg_extras.sh"</span><span class="p">],</span>
           <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">select</code> cannot appear inside another <code class="highlighter-rouge">select</code> (i.e. <em><code class="highlighter-rouge">AND</code> chaining</em>). If you
need to <code class="highlighter-rouge">AND</code> selects together, either use an intermediate target:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":armeabi_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":armeabi_lib"</span><span class="p">],</span>
        <span class="o">...</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">sh_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"armeabi_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":opt_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">"armeabi_with_opt.sh"</span><span class="p">],</span>
        <span class="o">...</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>or write a <a href="skylark/macros.html">macro</a> to do the same thing
automatically.</p>

<p>This approach doesn’t work for non-deps attributes (like
<a href="be/general.html#genrule.cmd">genrule:cmd</a>). For these, extra <code class="highlighter-rouge">config_settings</code>
may be necessary:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"armeabi_and_opt"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"armeabi"</span><span class="p">,</span>
        <span class="s">"compilation_mode"</span><span class="p">:</span> <span class="s">"opt"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="or-chaining">OR Chaining</h2>

<p>Consider the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":config1"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config2"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config3"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Most conditions evaluate to the same dep. But this syntax is verbose, hard to
maintain, and refactoring-unfriendly. It would be nice to not have to repeat
<code class="highlighter-rouge">[":standard_lib"]</code> over and over.</p>

<p>One option is to predefine the declaration as a BUILD variable:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">STANDARD_DEP</span> <span class="o">=</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">]</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":config1"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config2"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config3"</span><span class="p">:</span> <span class="n">STANDARD_DEP</span><span class="p">,</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This makes it easier to manage the dependency. But it still adds unnecessary
duplication.</p>

<p><code class="highlighter-rouge">select()</code> doesn’t support native syntax for <code class="highlighter-rouge">OR</code>ed conditions. For this, use
one of the following:</p>

<h3 id="selectswith_or"><a name="selects-with-or"></a><code class="highlighter-rouge">selects.with_or</code></h3>

<p>The <a href="https://github.com/bazelbuild/bazel-skylib">Skylib</a> utility
<a href="https://github.com/bazelbuild/bazel-skylib/blob/master/lib/selects.bzl"><code class="highlighter-rouge">selects</code></a>
defines a Starlark macro that emulates <code class="highlighter-rouge">OR</code> behavior:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">"@bazel_skylib//:lib.bzl"</span><span class="p">,</span> <span class="s">"selects"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">selects</span><span class="o">.</span><span class="n">with_or</span><span class="p">({</span>
        <span class="p">(</span><span class="s">":config1"</span><span class="p">,</span> <span class="s">":config2"</span><span class="p">,</span> <span class="s">":config3"</span><span class="p">):</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This automatically expands the <code class="highlighter-rouge">select</code> to the original syntax above.</p>

<h3 id="config_setting-aliasing"><a name="config-setting-aliasing"></a><code class="highlighter-rouge">config_setting</code> Aliasing</h3>

<p>If you’d like to <code class="highlighter-rouge">OR</code> conditions under a proper <code class="highlighter-rouge">config_setting</code> that any rule
can reference, you can use a <code class="highlighter-rouge">select</code>able <a href="be/general.html#alias">alias</a> that
matches any of the desired conditions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alias</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"config1_or_2_or_3"</span><span class="p">,</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="c1"># When the build matches :config1, this alias *becomes* :config1.
</span>        <span class="c1"># So it too matches by definition. The same applies for :config2
</span>        <span class="c1"># and :config3.
</span>        <span class="s">":config1"</span><span class="p">:</span> <span class="s">":config1"</span><span class="p">,</span>
        <span class="s">":config2"</span><span class="p">:</span> <span class="s">":config2"</span><span class="p">,</span>
        <span class="s">":config3"</span><span class="p">:</span> <span class="s">":config3"</span><span class="p">,</span>
        <span class="c1"># The default condition represents this alias "not matching" (i.e.
</span>        <span class="c1"># none of the conditions that we care about above match). In this
</span>        <span class="c1"># case, bind the alias to any of those conditions. By definition
</span>        <span class="c1"># it won't match.
</span>        <span class="s">"//conditions:default"</span><span class="p">:</span> <span class="s">":config2"</span><span class="p">,</span> <span class="c1"># Arbitrarily chosen from above.
</span>    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">sh_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"always_include.sh"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":config1_or_2_or_3"</span><span class="p">:</span> <span class="p">[</span><span class="s">":standard_lib"</span><span class="p">],</span>
        <span class="s">":config4"</span><span class="p">:</span> <span class="p">[</span><span class="s">":special_lib"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Unlike <code class="highlighter-rouge">selects.with_or</code>, different rules can <code class="highlighter-rouge">select</code> on <code class="highlighter-rouge">:config1_or_2_or_3</code>
with different values.</p>

<p>Note that it’s an error for multiple conditions to match unless one is a
“specialization” of the other. See <a href="be/functions.html#select">select()</a>
documentation for details.</p>

<p>For <code class="highlighter-rouge">AND</code> chaining, see <a href="#multiple-selects">here</a>.</p>

<h2 id="custom-error-messages">Custom Error Messages</h2>

<p>By default, when no condition matches, the owning target fails with the error:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: Configurable attribute <span class="s2">"deps"</span> doesn<span class="s1">'t match this configuration (would
a default condition help?).
Conditions checked:
  //tools/cc_target_os:darwin
  //tools/cc_target_os:android
</span></code></pre></div></div>

<p>This can be customized with <a href="be/functions.html#select"><code class="highlighter-rouge">no_match_error</code></a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s">"//tools/cc_target_os:android"</span><span class="p">:</span> <span class="p">[</span><span class="s">":android_deps"</span><span class="p">],</span>
            <span class="s">"//tools/cc_target_os:windows"</span><span class="p">:</span> <span class="p">[</span><span class="s">":windows_deps"</span><span class="p">],</span>
        <span class="p">},</span>
        <span class="n">no_match_error</span> <span class="o">=</span> <span class="s">"Please build with an Android or Windows toolchain"</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //foo:my_lib
ERROR: Configurable attribute <span class="s2">"deps"</span> doesn<span class="s1">'t match this configuration: Please
build with an Android or Windows toolchain
</span></code></pre></div></div>

<h2 id="rules-compatibility"><a name="rules"></a>Rules Compatibility</h2>
<p>Rule implementations receive the <em>resolved values</em> of configurable
attributes. For example, given:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myproject/BUILD
</span>
<span class="n">some_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_target"</span><span class="p">,</span>
    <span class="n">some_attr</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":foo_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":foo"</span><span class="p">],</span>
        <span class="s">":bar_mode"</span><span class="p">:</span> <span class="p">[</span><span class="s">":bar"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject/my_target <span class="nt">--define</span> <span class="nv">mode</span><span class="o">=</span>foo
</code></pre></div></div>

<p>Rule implementation code sees <code class="highlighter-rouge">ctx.attr.some_attr</code> as <code class="highlighter-rouge">[":foo"]</code>.</p>

<p>Macros can accept <code class="highlighter-rouge">select()</code> clauses and pass them through to native
rules. But <em>they cannot directly manipulate them</em>. For example, there’s no way
for a macro to convert</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">({</span><span class="s">"foo"</span><span class="p">:</span> <span class="s">"val"</span><span class="p">},</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>to</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">({</span><span class="s">"foo"</span><span class="p">:</span> <span class="s">"val_with_suffix"</span><span class="p">},</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>This is for two reasons.</p>

<p>First, macros that need to know which path a <code class="highlighter-rouge">select</code> will choose <em>cannot work</em>
because macros are evaluated in Bazel’s <a href="user-manual.html#loading-phase">loading phase</a>,
which occurs before flag values are known.
This is a core Bazel design restriction that’s unlikely to change any time soon.</p>

<p>Second, macros that just need to iterate over <em>all</em> <code class="highlighter-rouge">select</code> paths, while
technically feasible, lack a coherent UI. Further design is necessary to change
this.</p>

<h2 id="bazel-query-and-cquery"><a name="query"></a>Bazel Query and Cquery</h2>
<p>Bazel <code class="highlighter-rouge">query</code> operates over Bazel’s <a href="user-manual.html#loading-phase">loading phase</a>. This means it doesn’t know what command line
flags will be applied to a target since those flags aren’t evaluated until later
in the build (during the <a href="user-manual.html#analysis-phase">analysis phase</a>). So
the <a href="query.html"><code class="highlighter-rouge">query</code></a> command can’t accurately determine which path a
configurable attribute will follow.</p>

<p><a href="cquery.html">Bazel <code class="highlighter-rouge">cquery</code></a> has the advantage of being able to parse build
flags and operating post-analysis phase so it correctly resolves configurable
attributes. It doesn’t have full feature parity with query but supports most
major functionality and is actively being worked on.
Querying the following build file…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myproject/BUILD
</span>
<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"my_lib"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">":long"</span><span class="p">:</span> <span class="p">[</span><span class="s">":foo_dep"</span><span class="p">],</span>
        <span class="s">":short"</span><span class="p">:</span> <span class="p">[</span><span class="s">":bar_dep"</span><span class="p">],</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"long"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"dog=dachshund"</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"short"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s">"define"</span><span class="p">:</span> <span class="s">"dog=pug"</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>…would return the following results.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel query <span class="s1">'deps(//myproject:my_lib)'</span>
//myproject:my_lib
//myproject:foo_dep
//myproject:bar_dep

<span class="nv">$ </span>bazel cquery <span class="s1">'deps(//myproject:my_lib)'</span> <span class="nt">--define</span> <span class="nv">dog</span><span class="o">=</span>pug
//myproject:my_lib
//myproject:bar_dep
</code></pre></div></div>

<h2 id="faq">FAQ</h2>

<h2 id="why-doesnt-select-work-in-macros"><a name="macros-select"></a>Why doesn’t select() work in macros?</h2>
<p>select() <em>does</em> work in rules! See <a href="#rules">Rules compatibility</a> for
details.</p>

<p>The key issue this question usually means is that select() doesn’t work in
<em>macros</em>. These are different than <em>rules</em>. See the
documentation on <a href="skylark/rules.html">rules</a> and <a href="skylark/macros.html">macros</a>
to understand the difference.
Here’s an end-to-end example:</p>

<p>Define a rule and macro:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myproject/defs.bzl
</span>
<span class="c1"># Rule implementation: when an attribute is read, all select()s have already
# been resolved. So it looks like a plain old attribute just like any other.
</span><span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span>
    <span class="n">allcaps</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">my_config_string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># This works fine on all values.
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"My name is "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" with custom message: "</span> <span class="o">+</span> <span class="n">allcaps</span><span class="p">)</span>

<span class="c1"># Rule declaration:
</span><span class="n">my_custom_bazel_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s">"my_config_string"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">string</span><span class="p">()},</span>
<span class="p">)</span>

<span class="c1"># Macro declaration:
</span><span class="k">def</span> <span class="nf">my_custom_bazel_macro</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">my_config_string</span><span class="p">):</span>
    <span class="n">allcaps</span> <span class="o">=</span> <span class="n">my_config_string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># This line won't work with select(s).
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"My name is "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" with custom message: "</span> <span class="o">+</span> <span class="n">allcaps</span><span class="p">)</span>
</code></pre></div></div>

<p>Instantiate the rule and macro:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myproject/BUILD
</span>
<span class="n">load</span><span class="p">(</span><span class="s">"//myproject:defs.bzl"</span><span class="p">,</span> <span class="s">"my_custom_bazel_rule"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s">"//myproject:defs.bzl"</span><span class="p">,</span> <span class="s">"my_custom_bazel_macro"</span><span class="p">)</span>

<span class="n">my_custom_bazel_rule</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"happy_rule"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//tools/target_cpu:x86"</span><span class="p">:</span> <span class="s">"first string"</span><span class="p">,</span>
        <span class="s">"//tools/target_cpu:ppc"</span><span class="p">:</span> <span class="s">"second string"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>

<span class="n">my_custom_bazel_macro</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"happy_macro"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="s">"fixed string"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">my_custom_bazel_macro</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"sad_macro"</span><span class="p">,</span>
    <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">select</span><span class="p">({</span>
        <span class="s">"//tools/target_cpu:x86"</span><span class="p">:</span> <span class="s">"first string"</span><span class="p">,</span>
        <span class="s">"//tools/target_cpu:ppc"</span><span class="p">:</span> <span class="s">"other string"</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Building fails because <code class="highlighter-rouge">sad_macro</code> can’t process the <code class="highlighter-rouge">select()</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject:all
ERROR: /myworkspace/myproject/BUILD:17:1: Traceback
  <span class="o">(</span>most recent call last<span class="o">)</span>:
File <span class="s2">"/myworkspace/myproject/BUILD"</span>, line 17
my_custom_bazel_macro<span class="o">(</span>name <span class="o">=</span> <span class="s2">"sad_macro"</span>, my_config_stri...<span class="s2">"}))
File "</span>/myworkspace/myproject/defs.bzl<span class="s2">", line 4, in
  my_custom_bazel_macro
my_config_string.upper()
type 'select' has no method upper().
ERROR: error loading package 'myproject': Package 'myproject' contains errors.
</span></code></pre></div></div>

<p>Building succeeds when we comment out <code class="highlighter-rouge">sad_macro</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Comment out sad_macro so it doesn't mess up the build.</span>
<span class="nv">$ </span>bazel build //myproject:all
DEBUG: /myworkspace/myproject/defs.bzl:5:3: My name is happy_macro with custom message: FIXED STRING.
DEBUG: /myworkspace/myproject/hi.bzl:15:3: My name is happy_rule with custom message: FIRST STRING.
</code></pre></div></div>

<p>This is impossible to change because <em>by definition</em> macros are evaluated before
Bazel reads the build’s command line flags. That means there isn’t enough
information to evaluate select()s.</p>

<p>Macros can, however, pass <code class="highlighter-rouge">select()</code>s as opaque blobs to rules:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myproject/defs.bzl
</span>
<span class="k">def</span> <span class="nf">my_custom_bazel_macro</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">my_config_string</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Invoking macro "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">my_custom_bazel_rule</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"_as_target"</span><span class="p">,</span>
        <span class="n">my_config_string</span> <span class="o">=</span> <span class="n">my_config_string</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bazel build //myproject:sad_macro_less_sad
DEBUG: /myworkspace/myproject/defs.bzl:23:3: Invoking macro sad_macro_less_sad.
DEBUG: /myworkspace/myproject/defs.bzl:15:3: My name is sad_macro_less_sad with custom message: FIRST STRING.
</code></pre></div></div>

<h2 id="why-does-select-always-return-true"><a name="boolean-select"></a>Why does select() always return true?</h2>
<p>Because <em>macros</em> (but not rules) by definition
<a href="#macros-select">can’t evaluate select(s)</a>, any attempt to do so
usually produces a an error:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: /myworkspace/myproject/BUILD:17:1: Traceback
  <span class="o">(</span>most recent call last<span class="o">)</span>:
File <span class="s2">"/myworkspace/myproject/BUILD"</span>, line 17
my_custom_bazel_macro<span class="o">(</span>name <span class="o">=</span> <span class="s2">"sad_macro"</span>, my_config_stri...<span class="s2">"}))
File "</span>/myworkspace/myproject/defs.bzl<span class="s2">", line 4, in
  my_custom_bazel_macro
my_config_string.upper()
type 'select' has no method upper().
</span></code></pre></div></div>

<p>Booleans are a special case that fail silently, so you should be particularly
vigilant with them:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def my_boolean_macro<span class="o">(</span>boolval<span class="o">)</span>:
  print<span class="o">(</span><span class="s2">"TRUE"</span> <span class="k">if </span>boolval <span class="k">else</span> <span class="s2">"FALSE"</span><span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>myproject/BUILD
load<span class="o">(</span><span class="s2">"//myproject:defs.bzl"</span>, <span class="s2">"my_boolean_macro"</span><span class="o">)</span>
my_boolean_macro<span class="o">(</span>
    boolval <span class="o">=</span> <span class="k">select</span><span class="o">({</span>
        <span class="s2">"//tools/target_cpu:x86"</span>: True,
        <span class="s2">"//tools/target_cpu:ppc"</span>: False,
    <span class="o">})</span>,
<span class="o">)</span>

<span class="nv">$ </span>bazel build //myproject:all <span class="nt">--cpu</span><span class="o">=</span>x86
DEBUG: /myworkspace/myproject/defs.bzl:4:3: TRUE.
<span class="nv">$ </span>bazel build //myproject:all <span class="nt">--cpu</span><span class="o">=</span>ppc
DEBUG: /myworkspace/myproject/defs.bzl:4:3: TRUE.
</code></pre></div></div>

<p>This happens because macros don’t understand the contents of <code class="highlighter-rouge">select()</code>.
So what they’re really evaluting is the <code class="highlighter-rouge">select()</code> object itself. According to
<a href="https://docs.python.org/release/2.5.2/lib/truth.html">Pythonic</a> design
standards, all objects aside from a very small number of exceptions
automatically return true.</p>
<h2 id="can-i-read-select-like-a-dict"><a name="inspectable-select"></a>Can I read select() like a dict?</h2>
<p>Fine. Macros <a href="#macros-select">can’t</a> evaluate select(s) because
macros are evaluated before Bazel knows what the command line flags are.</p>

<p>Can macros at least read the <code class="highlighter-rouge">select()</code>’s dictionary, say, to add an extra
suffix to each branch?</p>

<p>Conceptually this is possible. But this isn’t yet implemented and is not
currently prioritized.
What you <em>can</em> do today is prepare a straight dictionary, then feed it into a
<code class="highlighter-rouge">select()</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def selecty_genrule<span class="o">(</span>name, select_cmd<span class="o">)</span>:
  <span class="k">for </span>key <span class="k">in </span>select_cmd.keys<span class="o">()</span>:
    select_cmd[key] +<span class="o">=</span> <span class="s2">" WITH SUFFIX"</span>
  native.genrule<span class="o">(</span>
      name <span class="o">=</span> name,
      outs <span class="o">=</span> <span class="o">[</span>name + <span class="s2">".out"</span><span class="o">]</span>,
      srcs <span class="o">=</span> <span class="o">[]</span>,
      cmd <span class="o">=</span> <span class="s2">"echo "</span> + <span class="k">select</span><span class="o">(</span>select_cmd + <span class="o">{</span><span class="s2">"//conditions:default"</span>: <span class="s2">"default"</span><span class="o">})</span>
        + <span class="s2">" &gt; </span><span class="nv">$@</span><span class="s2">"</span>
  <span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>myproject/BUILD
selecty_genrule<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"selecty"</span>,
    select_cmd <span class="o">=</span> <span class="o">{</span>
        <span class="s2">"//tools/target_cpu:x86"</span>: <span class="s2">"x86 mode"</span>,
    <span class="o">}</span>,
<span class="o">)</span>

<span class="nv">$ </span>bazel build //testapp:selecty <span class="nt">--cpu</span><span class="o">=</span>x86 <span class="o">&amp;&amp;</span> <span class="nb">cat </span>bazel-genfiles/testapp/selecty.out
x86 mode WITH SUFFIX
</code></pre></div></div>

<p>If you’d like to support both <code class="highlighter-rouge">select()</code> and native types, you can do this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>myproject/defs.bzl
def selecty_genrule<span class="o">(</span>name, select_cmd<span class="o">)</span>:
    cmd_suffix <span class="o">=</span> <span class="s2">""</span>
    <span class="k">if </span><span class="nb">type</span><span class="o">(</span>select_cmd<span class="o">)</span> <span class="o">==</span> <span class="s2">"string"</span>:
        cmd_suffix <span class="o">=</span> select_cmd + <span class="s2">" WITH SUFFIX"</span>
    <span class="k">elif </span><span class="nb">type</span><span class="o">(</span>select_cmd<span class="o">)</span> <span class="o">==</span> <span class="s2">"dict"</span>:
        <span class="k">for </span>key <span class="k">in </span>select_cmd.keys<span class="o">()</span>:
            select_cmd[key] +<span class="o">=</span> <span class="s2">" WITH SUFFIX"</span>
        cmd_suffix <span class="o">=</span> <span class="k">select</span><span class="o">(</span>select_cmd + <span class="o">{</span><span class="s2">"//conditions:default"</span>: <span class="s2">"default"</span><span class="o">})</span>

    native.genrule<span class="o">(</span>
        name <span class="o">=</span> name,
        outs <span class="o">=</span> <span class="o">[</span>name + <span class="s2">".out"</span><span class="o">]</span>,
        srcs <span class="o">=</span> <span class="o">[]</span>,
        cmd <span class="o">=</span> <span class="s2">"echo "</span> + cmd_suffix + <span class="s2">"&gt; </span><span class="nv">$@</span><span class="s2">"</span>,
    <span class="o">)</span>
</code></pre></div></div>

<h2 id="why-doesnt-select-work-with-bind"><a name="bind-select"></a>Why doesn’t select() work with bind()?</h2>

<p>Because <a href="be/workspace.html#bind"><code class="highlighter-rouge">bind()</code></a> is a WORKSPACE rule, not a BUILD rule.</p>

<p>Workspace rules do not have a specific configuration, and aren’t evaluated in
the same way as BUILD rules. Therefore, a <code class="highlighter-rouge">select()</code> in a <code class="highlighter-rouge">bind()</code> can’t
actually evaluate to any specific branch.</p>

<p>Instead, you should use <a href="be/general.html#alias"><code class="highlighter-rouge">alias()</code></a>, with a <code class="highlighter-rouge">select()</code> in
the <code class="highlighter-rouge">actual</code> attribute, to perform this type of run-time determination. This
works correctly, since <code class="highlighter-rouge">alias()</code> is a BUILD rule, and is evaluated with a
specific configuration.</p>

<p>You can even have a <code class="highlighter-rouge">bind()</code> target point to an <code class="highlighter-rouge">alias()</code>, if needed.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>WORKSPACE
workspace<span class="o">(</span>name <span class="o">=</span> <span class="s2">"myproject"</span><span class="o">)</span>
<span class="nb">bind</span><span class="o">(</span>name <span class="o">=</span> <span class="s2">"openssl"</span>, actual <span class="o">=</span> <span class="s2">"//:ssl"</span><span class="o">)</span>
http_archive<span class="o">(</span>name <span class="o">=</span> <span class="s2">"alternative"</span>, ...<span class="o">)</span>
http_archive<span class="o">(</span>name <span class="o">=</span> <span class="s2">"boringssl"</span>, ...<span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>BUILD
config_setting<span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"alt_ssl"</span>,
    define_values <span class="o">=</span> <span class="o">{</span>
        <span class="s2">"ssl_library"</span>: <span class="s2">"alternative"</span>,
    <span class="o">}</span>,
<span class="o">)</span>

<span class="nb">alias</span><span class="o">(</span>
    name <span class="o">=</span> <span class="s2">"ssl"</span>,
    actual <span class="o">=</span> <span class="k">select</span><span class="o">({</span>
        <span class="s2">"//:alt_ssl"</span>: <span class="s2">"@alternative//:ssl"</span>,
        <span class="s2">"//conditions:default"</span>: <span class="s2">"@boringssl//:ssl"</span>,
    <span class="o">})</span>,
<span class="o">)</span>
</code></pre></div></div>

<p>With this setup, you can pass <code class="highlighter-rouge">--define ssl_library=alternative</code>, and any target
that depends on either <code class="highlighter-rouge">//:ssl</code> or <code class="highlighter-rouge">//external:ssl</code> will see the alternative
located at <code class="highlighter-rouge">@alternative//:ssl</code>.</p>

          </div>
        </div>

        <div class="col-md-2 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Configurable Build Attributes&body=Documentation URL: https://docs.bazel.build/versions/0.28.0/configurable-attributes.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1
                     && window.location.pathname.lastIndexOf('/command-line-reference.html') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible';
                     editButtonListItem.style.visibility = 'visible';
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h3"><a href="#contents">Contents</a></li>
<li class="toc-entry toc-h2"><a href="#example">Example</a></li>
<li class="toc-entry toc-h2"><a href="#configuration-conditions">Configuration Conditions</a></li>
<li class="toc-entry toc-h2"><a href="#defaults">Defaults</a></li>
<li class="toc-entry toc-h2"><a href="#custom-keys">Custom Keys</a></li>
<li class="toc-entry toc-h2"><a href="#platforms">Platforms</a></li>
<li class="toc-entry toc-h2"><a href="#short-keys">Short Keys</a></li>
<li class="toc-entry toc-h2"><a href="#multiple-selects">Multiple Selects</a></li>
<li class="toc-entry toc-h2"><a href="#or-chaining">OR Chaining</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#selectswith_or">selects.with_or</a></li>
<li class="toc-entry toc-h3"><a href="#config_setting-aliasing">config_setting Aliasing</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#custom-error-messages">Custom Error Messages</a></li>
<li class="toc-entry toc-h2"><a href="#rules-compatibility">Rules Compatibility</a></li>
<li class="toc-entry toc-h2"><a href="#bazel-query-and-cquery">Bazel Query and Cquery</a></li>
<li class="toc-entry toc-h2"><a href="#faq">FAQ</a></li>
<li class="toc-entry toc-h2"><a href="#why-doesnt-select-work-in-macros">Why doesn’t select() work in macros?</a></li>
<li class="toc-entry toc-h2"><a href="#why-does-select-always-return-true">Why does select() always return true?</a></li>
<li class="toc-entry toc-h2"><a href="#can-i-read-select-like-a-dict">Can I read select() like a dict?</a></li>
<li class="toc-entry toc-h2"><a href="#why-doesnt-select-work-with-bind">Why doesn’t select() work with bind()?</a></li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
        <li><a href="//sitemap.xml">Sitemap</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
        <li><a href="https://slack.bazel.build">Slack</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

