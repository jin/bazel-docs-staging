<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Deploying Rules - Bazel 2.0.0</title>

    <link rel="canonical" href="/versions/2.0.0/skylark/deploying.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,700|Open+Sans:400,600,700,800" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Deploying Rules"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-2">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: 2.0.0</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/skylark/deploying.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.2.0/skylark/deploying.html">
                    3.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.1.0/skylark/deploying.html">
                    3.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.0.0/skylark/deploying.html">
                    3.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.2.0/skylark/deploying.html">
                    2.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/skylark/deploying.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/skylark/deploying.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/skylark/deploying.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/skylark/deploying.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/skylark/deploying.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/skylark/deploying.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/skylark/deploying.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/skylark/deploying.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/skylark/deploying.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/skylark/deploying.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/skylark/deploying.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/skylark/deploying.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/skylark/deploying.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/skylark/deploying.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/skylark/deploying.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/skylark/deploying.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/skylark/deploying.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/skylark/deploying.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/skylark/deploying.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/skylark/deploying.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/skylark/deploying.html">
                    0.17.1
                </option>
                
            </select>

            <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/2.0.0/bazel-overview.html">Bazel overview</a></li>
              <li><a href="/versions/2.0.0/bazel-vision.html">Bazel vision</a></li>
              <li><a href="/versions/2.0.0/getting-started.html">Getting started</a></li>
              <li><a href="/versions/2.0.0/backward-compatibility.html">Backward compatibility</a></li>
            </ul>

            <h3>Installing Bazel</h3>
            <ul class="sidebar-nav">

              <li class="sidebar-nav">
                <a href="/versions/2.0.0/install.html">Installation overview</a>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installation steps<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">

                   <li><a href="/versions/2.0.0/install-ubuntu.html">Ubuntu</a></li>
                   <li><a href="/versions/2.0.0/install-redhat.html">Fedora/CentOS</a></li>
                   <li><a href="/versions/2.0.0/install-os-x.html">macOS</a></li>
                   <li><a href="/versions/2.0.0/install-windows.html">Windows</a></li>
                   <li><a href="/versions/2.0.0/install-compile-source.html">Compiling from source</a></li>
                   <li><a href="/versions/2.0.0/completion.html">Command-line completion</a></li>
                   <li><a href="/versions/2.0.0/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
              <li class="sidebar-nav">
                <a href="/versions/2.0.0/updating-bazel.html">Updating Bazel</a>
              </li>
              
            </ul>

            <h3>Tutorials</h3>
            <ul class="sidebar-nav">
                <li><a href="/versions/2.0.0/tutorial/cpp.html">C++</a></li>
                <li><a href="/versions/2.0.0/tutorial/java.html">Java</a></li>
                <li><a href="/versions/2.0.0/tutorial/android-app.html">Android</a></li>
                <li><a href="/versions/2.0.0/tutorial/ios-app.html">iOS</a></li>
            </ul>

            <h3>Using Bazel</h3>
            <ul class="sidebar-nav">
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/2.0.0/build-ref.html">Core concepts</a></li>
                  <li><a href="/versions/2.0.0/external.html">External dependencies</a></li>
                  <li><a href="/versions/2.0.0/configurable-attributes.html">Configurable attributes</a></li>
                  <li><a href="/versions/master/platforms-intro.html">Platforms and toolchains</a></li>
                  <li><a href="/versions/master/visibility.html">Visibility</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#guides-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  Guides<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="guides-menu">
                  <li><a href="/versions/2.0.0/guide.html">Running Bazel</a></li>
                  <li><a href="/versions/2.0.0/skylark/tutorial-creating-a-macro.html">Creating a macro</a></li>
                  <li><a href="/versions/2.0.0/memory-saving-mode.html">Optimizing memory</a></li>
                  <li><a href="/versions/2.0.0/windows.html">Building on Windows</a></li>
                </ul>
              </li>

              
                <li><a href="/versions/2.0.0/rules.html">Rules</a></li>
              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/2.0.0/query-how-to.html">The query command</a></li>
                  <li><a href="/versions/2.0.0/cquery.html">The cquery command</a></li>
                  <li><a href="/versions/2.0.0/aquery.html">The aquery command</a></li>
                  <li><a href="/versions/2.0.0/query.html">Query language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#best-practices-menu" aria-expanded="false"
                    aria-controls="best-practices-menu">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="best-practices-menu">
                  <li><a href="/versions/2.0.0/best-practices.html">General best practices</a></li>
                  <li><a href="/versions/2.0.0/skylark/tutorial-sharing-variables.html">Sharing BUILD variables</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/2.0.0/remote-execution.html">Overview</a></li>
                   <li><a href="/versions/2.0.0/remote-execution-rules.html">Guidelines</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/2.0.0/remote-execution-sandbox.html">Troubleshooting with Bazel sandbox</a></li>
                         <li><a href="/versions/2.0.0/workspace-log.html">Non-hermetic WORKSPACE rules</a></li>
                         <li><a href="/versions/2.0.0/remote-execution-caching-debug.html">Debugging remote cache hits</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/2.0.0/remote-execution-ci.html">Remote execution and CI</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/2.0.0/remote-caching.html">Overview</a></li>
                     <li><a href="/versions/2.0.0/remote-caching-debug.html">Debugging remote cache hits with local execution</a></li>
                  </ul>
              </li>
              
             </ul>

           

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/2.0.0/user-manual.html">Commands and options</a></li>
             <li><a href="/versions/2.0.0/glossary.html">Glossary</a></li>
             <li><a href="/versions/2.0.0/be/overview.html">Build encyclopedia</a></li>
             <li><a href="/versions/2.0.0/test-encyclopedia.html">Test encyclopedia</a></li>
             <li><a href="/versions/2.0.0/command-line-reference.html">Command line reference</a></li>

             <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/2.0.0/be/functions.html">Functions</a></li>
                  <li><a href="/versions/2.0.0/be/common-definitions.html">Common rule definitions</a></li>
                  <li><a href="/versions/2.0.0/be/make-variables.html">"Make" variables</a></li>
                  <li><a href="/versions/2.0.0/skylark/build-style.html">BUILD style guide</a></li>
                </ul>
             </li>

             <li><a href="/versions/2.0.0/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/2.0.0/output_directories.html">Output directory layout</a></li>
             <li><a href="/versions/2.0.0/platforms.html">Platforms</a></li>
             <li><a href="/versions/2.0.0/toolchains.html">Toolchains</a></li>
           </ul>

           <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/2.0.0/skylark/concepts.html">Extension overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/2.0.0/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/2.0.0/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/2.0.0/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/2.0.0/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/2.0.0/skylark/repository_rules.html">Repository rules</a></li>
                  <li><a href="/versions/2.0.0/skylark/config.html">Configurations</a></li>
                </ul>
              </li>

	            <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                   href="#starlark-practices" aria-expanded="false"
                   aria-controls="starlark-practices">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/2.0.0/skylark/bzl-style.html">.bzl style guide</a></li>
                  <li><a href="/versions/2.0.0/skylark/testing.html">Testing extensions</a></li>
                  <li><a href="https://github.com/bazelbuild/stardoc">Documenting rules with Stardoc</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linting</a></li>
                  <li><a href="/versions/2.0.0/skylark/performance.html">Optimizing performance</a></li>
                  <li><a href="/versions/2.0.0/skylark/deploying.html">Deploying rules</a></li>
                  <li><a href="/versions/2.0.0/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/2.0.0/skylark/lib/skylark-overview.html">Extensions API</a></li>
              <li><a href="/versions/2.0.0/skylark/faq.html">FAQ</a></li>
              <li><a href="/versions/2.0.0/skylark/language.html">Starlark language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-8">
          <div class="content">
            <h1 id="deploying-rules">Deploying Rules</h1>

<p>This documentation is for rule writers who are planning to make their
rules available to others.</p>

<h2 id="hosting-and-naming-rules">Hosting and naming rules</h2>

<p>New rules should go into their own GitHub repository under your organization.
Contact the <a href="https://groups.google.com/forum/#!forum/bazel-dev">bazel-dev mailing list</a>
if you feel like your rules belong in the <a href="https://github.com/bazelbuild">bazelbuild</a>
organization.</p>

<p>Repository names for Bazel rules are standardized on the following format:
<code class="highlighter-rouge">$ORGANIZATION/rules_$NAME</code>.
See <a href="https://github.com/search?q=rules+bazel&amp;type=Repositories">examples on GitHub</a>.
For consistency, you must follow this same format when publishing your Bazel rules.</p>

<p>Make sure to use a descriptive GitHub repository description and <code class="highlighter-rouge">README.html</code>
title, example:</p>

<ul>
  <li>Repository name: <code class="highlighter-rouge">bazelbuild/rules_go</code></li>
  <li>Repository description: <em>Go rules for Bazel</em></li>
  <li>Repository tags: <code class="highlighter-rouge">golang</code>, <code class="highlighter-rouge">bazel</code></li>
  <li><code class="highlighter-rouge">README.html</code> header: <em>Go rules for <a href="https://bazel.build">Bazel</a></em>
(note the link to https://bazel.build which will guide users who are unfamiliar
with Bazel to the right place)</li>
</ul>

<p>Rules can be grouped either by language (e.g., Scala) or some notion of platform
(e.g., Android).</p>

<h2 id="repository-content">Repository content</h2>

<p>Every rule repository should have a certain layout so that users can quickly
understand new rules.</p>

<p>For example, suppose we are writing new rules for the (make-believe)
<code class="highlighter-rouge">mockascript</code> language. We would have the following structure:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/
  LICENSE
  README
  WORKSPACE
  mockascript/
    constraints/
      BUILD
    runfiles/
      BUILD
      runfiles.mocs
    BUILD
    defs.bzl
  tests/
    BUILD
    some_test.sh
    another_test.py
  examples/
    BUILD
    bin.mocs
    lib.mocs
    test.mocs
</code></pre></div></div>

<h3 id="workspace">WORKSPACE</h3>

<p>In the project’s <code class="highlighter-rouge">WORKSPACE</code>, you should define the name that users will use
to reference you rules. If your rules belong to the
<a href="https://github.com/bazelbuild">bazelbuild</a> organization, you must use
<code class="highlighter-rouge">rules_&lt;lang&gt;</code> (e.g. <code class="highlighter-rouge">rules_mockascript</code>). Otherwise, you should name your
repository <code class="highlighter-rouge">&lt;org&gt;_rules_&lt;lang&gt;</code> (e.g. <code class="highlighter-rouge">build_stack_rules_proto</code>). Please contact
<a href="https://groups.google.com/forum/#!forum/bazel-dev">bazel-dev mailing list</a>
if you feel like your rules should follow the convention for rules in the
<a href="https://github.com/bazelbuild">bazelbuild</a> organization.</p>

<p>In the following sections, we will assume the repository belongs to the
<a href="https://github.com/bazelbuild">bazelbuild</a> organization.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>workspace(name = "rules_mockascript")
</code></pre></div></div>

<h3 id="readme">README</h3>

<p>At the top level, there should be a <code class="highlighter-rouge">README</code> that contains (at least) what
users will need to copy-paste into their WORKSPACE file to use your rule.
In general, this will be a <code class="highlighter-rouge">http_archive</code> pointing to your GitHub release and
a macro call that downloads/configures any tools your rule needs. For example,
for the <a href="https://github.com/bazelbuild/rules_go#setup">Go
rules</a>, this
looks like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")
http_archive(
    name = "rules_go",
    urls = ["https://github.com/bazelbuild/rules_go/releases/download/0.18.5/rules_go-0.18.5.tar.gz"],
    sha256 = "a82a352bffae6bee4e95f68a8d80a70e87f42c4741e6a448bec11998fcc82329",
)
load("@rules_go//go:deps.bzl", "go_rules_dependencies", "go_register_toolchains")
go_rules_dependencies()
go_register_toolchains()
</code></pre></div></div>

<p>If your rules depend on another repository’s rules, specify that in the
rules documentation (for example, see the
<a href="https://skydoc.bazel.build/docs/getting_started_stardoc.html">Skydoc rules</a>,
which depend on the Sass rules), and provide a WORKSPACE
macro that will download all dependencies (see <code class="highlighter-rouge">rules_go</code> above).</p>

<h3 id="rules">Rules</h3>

<p>Often times there will be multiple rules provided by your repository. Create a
directory named by the language and provide an entry point - <code class="highlighter-rouge">defs.bzl</code> file
exporting all rules (also include a <code class="highlighter-rouge">BUILD</code> file so the directory is a package).
For <code class="highlighter-rouge">rules_mockascript</code> that means there will be a directory named
<code class="highlighter-rouge">mockascript</code>, and a <code class="highlighter-rouge">BUILD</code> file and a <code class="highlighter-rouge">defs.bzl</code> file inside:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/
  mockascript/
    BUILD
    defs.bzl
</code></pre></div></div>

<h3 id="constraints">Constraints</h3>

<p>If your rule defines
<a href="https://docs.bazel.build/versions/master/toolchains.html">toolchain</a> rules,
it’s possible that you’ll need to define custom <code class="highlighter-rouge">constraint_setting</code>s and/or
<code class="highlighter-rouge">constraint_value</code>s. Put these into a <code class="highlighter-rouge">//&lt;LANG&gt;/constraints</code> package. Your
directory structure will look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/
  mockascript/
    constraints/
      BUILD
    BUILD
    defs.bzl
</code></pre></div></div>

<p>Please read
<a href="https://github.com/bazelbuild/platforms">github.com/bazelbuild/platforms</a>
for best practices, and to see what constraints are already present, and
consider contributing your constraints there if they are language independent.
Be mindful of introducing custom constraints, all users of your rules will
use them to perform platform specific logic in their BUILD files (for example,
using <a href="https://docs.bazel.build/versions/master/be/functions.html#select">selects</a>).
With custom constraints, you define a language that the whole Bazel ecosystem
will speak.</p>

<h3 id="runfiles-library">Runfiles library</h3>

<p>If your rule provides a standard library for accessing runfiles, it should be
in the form of a library target located at <code class="highlighter-rouge">//&lt;LANG&gt;/runfiles</code> (an abbreviation
of <code class="highlighter-rouge">//&lt;LANG&gt;/runfiles:runfiles</code>). User targets that need to access their data
dependencies will typically add this target to their <code class="highlighter-rouge">deps</code> attribute.</p>

<h3 id="repository-rules">Repository Rules</h3>

<h4 id="dependencies">Dependencies</h4>

<p>Your rules might have external dependencies. To make depending on your rules
simpler, please provide a WORKSPACE macro that will declare dependencies on
those external dependencies. Do not declare dependencies of tests there, only
dependencies that rules require to work. Put development dependencies into the
WORKSPACE file.</p>

<p>Create a file named <code class="highlighter-rouge">&lt;LANG&gt;/repositories.bzl</code> and provide a single entry point
macro named <code class="highlighter-rouge">rules_&lt;LANG&gt;_dependencies</code>. Our directory will look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/
  mockascript/
    constraints/
      BUILD
    BUILD
    defs.bzl
    repositories.bzl
</code></pre></div></div>

<h4 id="registering-toolchains">Registering Toolchains</h4>

<p>Your rules might also register toolchains. Please provide a separate WORKSPACE
macro that registers these toolchains. This way users can decide to omit the
previous macro and control dependencies manually, while still being allowed to
register toolchains.</p>

<p>Therefore add a WORKSPACE macro named <code class="highlighter-rouge">rules_&lt;LANG&gt;_toolchains</code> into
<code class="highlighter-rouge">&lt;LANG&gt;/repositories.bzl</code> file.</p>

<p>Note that in order to resolve toolchains in the analysis phase Bazel needs to
analyze all <code class="highlighter-rouge">toolchain</code> targets that are registered. Bazel will not need to
analyze all targets referenced by <code class="highlighter-rouge">toolchain.toolchain</code> attribute. If in order
to register toolchains you need to perform complex computation in the
repository, consider splitting the repository with <code class="highlighter-rouge">toolchain</code> targets from the
repository with <code class="highlighter-rouge">&lt;LANG&gt;_toolchain</code> targets. Former will be always fetched, and
the latter will only be fetched when user actually needs to build <code class="highlighter-rouge">&lt;LANG&gt;</code> code.</p>

<h4 id="release-snippet">Release snippet</h4>

<p>In your release announcement provide a snippet that your users can copy-paste
into their WORKSPACE file. This snippet in general will look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")
http_archive(
    name = "rules_&lt;LANG&gt;",
    urls = ["&lt;url_to_the_release.zip"],
    sha256 = "4242424242",
)
load("@rules_&lt;LANG&gt;//&lt;LANG&gt;:repositories.bzl", "rules_&lt;LANG&gt;_dependencies", "rules_&lt;LANG&gt;_toolchains")
rules_&lt;LANG&gt;_dependencies()
rules_&lt;LANG&gt;_toolchains()
</code></pre></div></div>

<h3 id="tests">Tests</h3>

<p>There should be tests that verify that the rules are working as expected. This
can either be in the standard location for the language the rules are for or a
<code class="highlighter-rouge">tests/</code> directory at the top level.</p>

<h3 id="optional-examples">Optional: Examples</h3>

<p>It is useful to users to have an <code class="highlighter-rouge">examples/</code> directory that shows users a couple
of basic ways that the rules can be used.</p>

<h2 id="testing">Testing</h2>

<p>Set up Travis as described in their <a href="https://docs.travis-ci.com/user/getting-started/">getting started
docs</a>. Then add a
<code class="highlighter-rouge">.travis.yml</code> file to your repository with the following content:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dist: xenial  # Ubuntu 16.04

# On trusty (or later) images, the Bazel apt repository can be used.
addons:
  apt:
    sources:
    - sourceline: 'deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8'
      key_url: 'https://bazel.build/bazel-release.pub.gpg'
    packages:
    - bazel

script:
  - bazel build //...
  - bazel test //...
</code></pre></div></div>

<p>If your repository is under the <a href="https://github.com/bazelbuild">bazelbuild organization</a>,
you can <a href="https://github.com/bazelbuild/continuous-integration/issues/new?template=adding-your-project-to-bazel-ci.html&amp;title=Request+to+add+new+project+%5BPROJECT_NAME%5D&amp;labels=new-project">ask to add</a>
it to <a href="http://ci.bazel.build">ci.bazel.build</a>.</p>

<h2 id="documentation">Documentation</h2>

<p>See the <a href="https://github.com/bazelbuild/skydoc">Skydoc documentation</a> for
instructions on how to comment your rules so that documentation can be generated
automatically.</p>

<h2 id="faqs">FAQs</h2>

<h3 id="why-cant-we-add-our-rule-to-the-main-bazel-github-repository">Why can’t we add our rule to the main Bazel GitHub repository?</h3>

<p>We want to decouple rules from Bazel releases as much as possible. It’s clearer
who owns individual rules, reducing the load on Bazel developers. For our users,
decoupling makes it easier to modify, upgrade, downgrade, and replace rules.
Contributing to rules can be lighter weight than contributing to Bazel -
depending on the rules -, including full submit access to the corresponding
GitHub repository. Getting submit access to Bazel itself is a much more involved
process.</p>

<p>The downside is a more complicated one-time installation process for our users:
they have to copy-paste a rule into their <code class="highlighter-rouge">WORKSPACE</code> file, as shown in the
<code class="highlighter-rouge">README.html</code> section above.</p>

<p>We used to have all of the rules in the Bazel repository (under
<code class="highlighter-rouge">//tools/build_rules</code> or <code class="highlighter-rouge">//tools/build_defs</code>). We still have a couple rules
there, but we are working on moving the remaining rules out.</p>

          </div>
        </div>

        <div class="col-md-2 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Deploying Rules&body=Documentation URL: https://docs.bazel.build/versions/2.0.0/skylark/deploying.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1
                     && window.location.pathname.lastIndexOf('/command-line-reference.html') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible';
                     editButtonListItem.style.visibility = 'visible';
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h2"><a href="#hosting-and-naming-rules">Hosting and naming rules</a></li>
<li class="toc-entry toc-h2"><a href="#repository-content">Repository content</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#workspace">WORKSPACE</a></li>
<li class="toc-entry toc-h3"><a href="#readme">README</a></li>
<li class="toc-entry toc-h3"><a href="#rules">Rules</a></li>
<li class="toc-entry toc-h3"><a href="#constraints">Constraints</a></li>
<li class="toc-entry toc-h3"><a href="#runfiles-library">Runfiles library</a></li>
<li class="toc-entry toc-h3"><a href="#repository-rules">Repository Rules</a></li>
<li class="toc-entry toc-h3"><a href="#tests">Tests</a></li>
<li class="toc-entry toc-h3"><a href="#optional-examples">Optional: Examples</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#testing">Testing</a></li>
<li class="toc-entry toc-h2"><a href="#documentation">Documentation</a></li>
<li class="toc-entry toc-h2"><a href="#faqs">FAQs</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#why-cant-we-add-our-rule-to-the-main-bazel-github-repository">Why can’t we add our rule to the main Bazel GitHub repository?</a></li>
</ul>
</li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
        <li><a href="//sitemap.xml">Sitemap</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
        <li><a href="https://slack.bazel.build">Slack</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

