<!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
<!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->





<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Only show Bazel version in title if it's a release -->
    <title>Configuring Bazel CI for Testing Rules Against Remote Execution - Bazel 0.27.0</title>

    <link rel="canonical" href="/versions/0.27.0/remote-execution-ci.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,700|Open+Sans:400,600,700,800" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Configuring Bazel CI for Testing Rules Against Remote Execution"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="009927877080525621790:2pxlpaexqpc">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" id="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="container vpad">
      <div class="row">
        <div class="col-md-2">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>

          <nav class="sidebar collapse" id="sidebar-nav">
            <select onchange="location.href=this.value">
                <option value="" selected disabled hidden>Version: 0.27.0</option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/master/remote-execution-ci.html">
                    master
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.2.0/remote-execution-ci.html">
                    3.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.1.0/remote-execution-ci.html">
                    3.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/3.0.0/remote-execution-ci.html">
                    3.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.2.0/remote-execution-ci.html">
                    2.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.1.0/remote-execution-ci.html">
                    2.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/2.0.0/remote-execution-ci.html">
                    2.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.2.0/remote-execution-ci.html">
                    1.2.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.1.0/remote-execution-ci.html">
                    1.1.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/1.0.0/remote-execution-ci.html">
                    1.0.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.1/remote-execution-ci.html">
                    0.29.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.29.0/remote-execution-ci.html">
                    0.29.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.28.0/remote-execution-ci.html">
                    0.28.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.27.0/remote-execution-ci.html">
                    0.27.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.26.0/remote-execution-ci.html">
                    0.26.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.25.0/remote-execution-ci.html">
                    0.25.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.24.0/remote-execution-ci.html">
                    0.24.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.23.0/remote-execution-ci.html">
                    0.23.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.22.0/remote-execution-ci.html">
                    0.22.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.21.0/remote-execution-ci.html">
                    0.21.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.20.0/remote-execution-ci.html">
                    0.20.0
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.2/remote-execution-ci.html">
                    0.19.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.19.1/remote-execution-ci.html">
                    0.19.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.18.1/remote-execution-ci.html">
                    0.18.1
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.2/remote-execution-ci.html">
                    0.17.2
                </option>
                
                <!-- reconstruct absolute url for the current page for each doc version -->
                <option value="/versions/0.17.1/remote-execution-ci.html">
                    0.17.1
                </option>
                
            </select>

            <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/0.27.0/bazel-overview.html">Bazel overview</a></li>
              <li><a href="/versions/0.27.0/bazel-vision.html">Bazel vision</a></li>
              <li><a href="/versions/0.27.0/getting-started.html">Getting started</a></li>
              <li><a href="/versions/0.27.0/backward-compatibility.html">Backward compatibility</a></li>
            </ul>

            <h3>Installing Bazel</h3>
            <ul class="sidebar-nav">

              <li class="sidebar-nav">
                <a href="/versions/0.27.0/install.html">Installation overview</a>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installation steps<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">

                   <li><a href="/versions/0.27.0/install-ubuntu.html">Ubuntu</a></li>
                   <li><a href="/versions/0.27.0/install-redhat.html">Fedora/CentOS</a></li>
                   <li><a href="/versions/0.27.0/install-os-x.html">macOS</a></li>
                   <li><a href="/versions/0.27.0/install-windows.html">Windows</a></li>
                   <li><a href="/versions/0.27.0/install-compile-source.html">Compiling from source</a></li>
                   <li><a href="/versions/0.27.0/completion.html">Command-line completion</a></li>
                   <li><a href="/versions/0.27.0/ide.html">Integrating with IDEs</a></li>
                </ul>
              </li>

              
            </ul>

            <h3>Tutorials</h3>
            <ul class="sidebar-nav">
                <li><a href="/versions/0.27.0/tutorial/cpp.html">C++</a></li>
                <li><a href="/versions/0.27.0/tutorial/java.html">Java</a></li>
                <li><a href="/versions/0.27.0/tutorial/android-app.html">Android</a></li>
                <li><a href="/versions/0.27.0/tutorial/ios-app.html">iOS</a></li>
            </ul>

            <h3>Using Bazel</h3>
            <ul class="sidebar-nav">
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#using-menu" aria-expanded="false"
                    aria-controls="using-menu">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="using-menu">
                  <li><a href="/versions/0.27.0/build-ref.html">Core concepts</a></li>
                  <li><a href="/versions/0.27.0/external.html">External dependencies</a></li>
                  <li><a href="/versions/0.27.0/configurable-attributes.html">Configurable attributes</a></li>
                  <li><a href="/versions/master/platforms-intro.html">Platforms and toolchains</a></li>
                  <li><a href="/versions/master/visibility.html">Visibility</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#guides-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  Guides<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="guides-menu">
                  <li><a href="/versions/0.27.0/guide.html">Running Bazel</a></li>
                  <li><a href="/versions/0.27.0/skylark/tutorial-creating-a-macro.html">Creating a macro</a></li>
                  <li><a href="/versions/0.27.0/memory-saving-mode.html">Optimizing memory</a></li>
                  <li><a href="/versions/0.27.0/windows.html">Building on Windows</a></li>
                </ul>
              </li>

              

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/0.27.0/query-how-to.html">The query command</a></li>
                  <li><a href="/versions/0.27.0/cquery.html">The cquery command</a></li>
                  <li><a href="/versions/0.27.0/aquery.html">The aquery command</a></li>
                  <li><a href="/versions/0.27.0/query.html">Query language</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#best-practices-menu" aria-expanded="false"
                    aria-controls="best-practices-menu">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="best-practices-menu">
                  <li><a href="/versions/0.27.0/best-practices.html">General best practices</a></li>
                  <li><a href="/versions/0.27.0/skylark/tutorial-sharing-variables.html">Sharing BUILD variables</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/0.27.0/remote-execution.html">Overview</a></li>
                   <li><a href="/versions/0.27.0/remote-execution-rules.html">Guidelines</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/0.27.0/remote-execution-sandbox.html">Troubleshooting with Bazel sandbox</a></li>
                         <li><a href="/versions/0.27.0/workspace-log.html">Non-hermetic WORKSPACE rules</a></li>
                         <li><a href="/versions/0.27.0/remote-execution-caching-debug.html">Debugging remote cache hits</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/0.27.0/remote-execution-ci.html">Remote execution and CI</a></li>
                 </ul>
              </li>

              <li>
                  <a class="sidebar-nav-heading" data-toggle="collapse"
                      href="#remote-caching-menu" aria-expanded="false"
                      aria-controls="remote-caching-menu">
                    Remote caching<span class="caret"></span>
                  </a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="remote-caching-menu">
                     <li><a href="/versions/0.27.0/remote-caching.html">Overview</a></li>
                     <li><a href="/versions/0.27.0/remote-caching-debug.html">Debugging remote cache hits with local execution</a></li>
                  </ul>
              </li>
              
             </ul>

           
           <h4>Rules</h4>
           <ul class="sidebar-nav">
             <li><a href="/versions/0.27.0/be/overview.html">Build encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/0.27.0/tutorial/android-app.html">Tutorial</a></li>
                  <li><a href="/versions/0.27.0/bazel-and-android.html">Android resources</a></li>
                  <li><a href="/versions/0.27.0/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/0.27.0/android-instrumentation-test.html">Android instrumentation tests</a></li>
                  <li><a href="/versions/0.27.0/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/0.27.0/tutorial/ios-app.html">Tutorial</a></li>
                  <li><a href="/versions/0.27.0/bazel-and-apple.html">Apple resources</a></li>
                  <li><a href="/versions/0.27.0/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/0.27.0/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/0.27.0/tutorial/cpp.html">Tutorial</a></li>
                  <li><a href="/versions/0.27.0/bazel-and-cpp.html">C++ resources</a></li>
                  <li><a href="/versions/0.27.0/cpp-use-cases.html">C++ use cases</a></li>
                  <li>
                    <a href="/versions/0.27.0/cc-toolchain-config-reference.html">
                      C++ Toolchain Configuration
                    </a>
                  </li>
                  <li>
                    <a href="/versions/0.27.0/tutorial/cc-toolchain-config.html">
                      Tutorial: Configuring C++ Toolchains
                    </a>
                  </li>
                  <li>
                    <a href="/versions/0.27.0/integrating-with-rules-cc.html">
                      Integrating with C++ rules
                    </a>
                  </li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/0.27.0/tutorial/java.html">Tutorial</a></li>
                  <li><a href="/versions/0.27.0/bazel-and-java.html">Java resources</a></li>
                  <li><a href="/versions/0.27.0/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/0.27.0/generate-workspace.html">Converting Maven dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/0.27.0/bazel-and-javascript.html">JavaScript resources</a></li>
                  <li><a href="/versions/0.27.0/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>
           

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/0.27.0/user-manual.html">Commands and options</a></li>
             <li><a href="/versions/0.27.0/glossary.html">Glossary</a></li>
             <li><a href="/versions/0.27.0/be/overview.html">Build encyclopedia</a></li>
             <li><a href="/versions/0.27.0/test-encyclopedia.html">Test encyclopedia</a></li>
             <li><a href="/versions/0.27.0/command-line-reference.html">Command line reference</a></li>

             <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#build-files-menu" aria-expanded="false"
                    aria-controls="build-files-menu">
                  BUILD files<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="build-files-menu">
                  <li><a href="/versions/0.27.0/be/functions.html">Functions</a></li>
                  <li><a href="/versions/0.27.0/be/common-definitions.html">Common rule definitions</a></li>
                  <li><a href="/versions/0.27.0/be/make-variables.html">"Make" variables</a></li>
                  <li><a href="/versions/0.27.0/skylark/build-style.html">BUILD style guide</a></li>
                </ul>
             </li>

             <li><a href="/versions/0.27.0/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/0.27.0/output_directories.html">Output directory layout</a></li>
             <li><a href="/versions/0.27.0/platforms.html">Platforms</a></li>
             <li><a href="/versions/0.27.0/toolchains.html">Toolchains</a></li>
           </ul>

           <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/0.27.0/skylark/concepts.html">Extension overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/0.27.0/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/0.27.0/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/0.27.0/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/0.27.0/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/0.27.0/skylark/repository_rules.html">Repository rules</a></li>
                  <li><a href="/versions/0.27.0/skylark/config.html">Configurations</a></li>
                </ul>
              </li>

	            <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                   href="#starlark-practices" aria-expanded="false"
                   aria-controls="starlark-practices">
                  Best practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/0.27.0/skylark/bzl-style.html">.bzl style guide</a></li>
                  <li><a href="/versions/0.27.0/skylark/testing.html">Testing extensions</a></li>
                  <li><a href="https://github.com/bazelbuild/stardoc">Documenting rules with Stardoc</a></li>
                  <li><a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">Linting</a></li>
                  <li><a href="/versions/0.27.0/skylark/performance.html">Optimizing performance</a></li>
                  <li><a href="/versions/0.27.0/skylark/deploying.html">Deploying rules</a></li>
                  <li><a href="/versions/0.27.0/skylark/windows_tips.html">Writing rules on Windows</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/0.27.0/skylark/lib/skylark-overview.html">Extensions API</a></li>
              <li><a href="/versions/0.27.0/skylark/faq.html">FAQ</a></li>
              <li><a href="/versions/0.27.0/skylark/language.html">Starlark language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-8">
          <div class="content">
            <h1 id="configuring-bazel-ci-to-test-bazel-rules-for-remote-execution">Configuring Bazel CI to Test Bazel Rules for Remote Execution</h1>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#setting-up-the-bazel-ci-for-testing">Setting up the Bazel CI for testing</a></li>
  <li><a href="#troubleshooting-failed-builds-and-tests">Troubleshooting failed builds and tests</a></li>
  <li><a href="#using-a-custom-container-in-the-rbe_ubuntu1604-ci-config">Using a custom container in the <code class="highlighter-rouge">rbe_ubuntu1604</code> CI config</a>
    <ul>
      <li><a href="#pulling-the-rbe-ubuntu16-04-from-container-registry">Pulling the <code class="highlighter-rouge">rbe-ubuntu16-04</code> from Container Registry</a></li>
      <li><a href="#building-the-rbe-ubuntu16-04-container-from-source">Building the <code class="highlighter-rouge">rbe-ubuntu16-04</code> container from source</a></li>
      <li><a href="#running-the-custom-container">Running the custom container</a></li>
      <li><a href="#adding-resources-to-the-custom-container">Adding resources to the custom container</a></li>
      <li><a href="#specifying-the-build-platform-definition">Specifying the build platform definition</a></li>
      <li><a href="#configuring-buildkite">Configuring Buildkite</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>This document is for owners and maintainers of Bazel rule repositories. It
describes how to configure the Bazel Continuous Integration (CI) system for your
repository to test your rules for compatibility against a remote execution
scenario. The instructions in this document apply to projects stored in GitHub
repositories.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before completing the steps in this document, ensure the following:</p>

<ul>
  <li>Your GitHub repository is part of the
<a href="https://github.com/bazelbuild">Bazel GitHub organization</a>.</li>
  <li>You have configured Buildkite for your repository as described in
<a href="https://github.com/bazelbuild/continuous-integration/tree/master/buildkite">Bazel Continuous Integration</a>.</li>
</ul>

<h2 id="setting-up-the-bazel-ci-for-testing">Setting up the Bazel CI for testing</h2>

<ol>
  <li>
    <p>In your <code class="highlighter-rouge">.bazelci/presubmit.yml</code> file, do the following:</p>

    <p>a.  Add a config named <code class="highlighter-rouge">rbe_ubuntu1604</code>.</p>

    <p>b.  In the <code class="highlighter-rouge">rbe_ubuntu1604</code> config, add the build and test targets you want to test against remote execution.</p>
  </li>
  <li>
    <p>Add the<a href="https://github.com/bazelbuild/bazel-toolchains"><code class="highlighter-rouge">bazel-toolchains</code></a>
GitHub repository to your <code class="highlighter-rouge">WORKSPACE</code> file, pinned to the
<a href="https://releases.bazel.build/bazel-toolchains.html">latest release</a>.</p>
  </li>
  <li>
    <p>Send a pull request with your changes to the <code class="highlighter-rouge">presubmit.yml</code> file. (See
<a href="https://github.com/bazelbuild/rules_rust/commit/db141526d89d00748404856524cedd7db8939c35">example pull request</a>.)</p>
  </li>
  <li>
    <p>To view build results, click <strong>Details</strong> for the RBE (Ubuntu
16.04) pull request check in GItHub, as shown in the figure below. This link
becomes available after the pull request has been merged and the CI tests
have run. (See
<a href="https://source.cloud.google.com/results/invocations/375e325c-0a05-47af-87bd-fed1363e0333">example results</a>.)</p>

    <p><img src="images/rbe-ci-1.png" alt="alt_text" title="Details" /></p>
  </li>
  <li>
    <p>(Optional) Set the <strong>bazel test (RBE (Ubuntu 16.04))</strong> check as a test
required to pass before merging in your branch protection rule. The setting
is located in GitHub in <strong>Settings &gt; Branches &gt; Branch protection rules</strong>,
as shown in the following figure.</p>

    <p><img src="images/rbe-ci-2.png" alt="alt_text" title="Branch protection rules" /></p>
  </li>
</ol>

<h2 id="troubleshooting-failed-builds-and-tests">Troubleshooting failed builds and tests</h2>

<p>If your build or tests fail, itâ€™s likely due to the following:</p>

<ul>
  <li>
    <p><strong>Required build or test tools are not installed in the default container.</strong>
Builds using the <code class="highlighter-rouge">rbe_ubuntu1604</code> config run by default inside an
<a href="https://pantheon.corp.google.com/marketplace/details/google/rbe-ubuntu16-04"><code class="highlighter-rouge">rbe-ubuntu16-04</code></a>
container, which includes tools common to many Bazel builds. However, if
your rules require tools not present in the default container, you must
create a custom container based on the
<a href="https://pantheon.corp.google.com/marketplace/details/google/rbe-ubuntu16-04"><code class="highlighter-rouge">rbe-ubuntu16-04</code></a>
container and include those tools as described later in this document.</p>
  </li>
  <li>
    <p><strong>Build or test targets are using rules that are incompatible with remote
execution.</strong> See
<a href="remote-execution-rules.html">Adapting Bazel Rules for Remote Execution</a> for
details about compatibility with remote execution.</p>
  </li>
</ul>

<h2 id="using-a-custom-container-in-the-rbe_ubuntu1604-ci-config">Using a custom container in the <code class="highlighter-rouge">rbe_ubuntu1604</code> CI config</h2>

<p>The <code class="highlighter-rouge">rbe-ubuntu16-04</code> container is publicly available at the following URL:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://gcr.io/cloud-marketplace/google/rbe-ubuntu16-04
</code></pre></div></div>

<p>You can pull it directly from Container Registry or build it from source. The
next sections describe both options.</p>

<p>Before you begin, make sure you have installed <code class="highlighter-rouge">gcloud</code>, <code class="highlighter-rouge">docker</code>, and <code class="highlighter-rouge">git</code>.
If you are building the container from source, you must also install the latest
version of Bazel.</p>

<h3 id="pulling-the-rbe-ubuntu16-04-from-container-registry">Pulling the <code class="highlighter-rouge">rbe-ubuntu16-04</code> from Container Registry</h3>

<p>To pull the <span style="color:#212121;">Pull the <code class="highlighter-rouge">rbe-ubuntu16-04</code> container
  from Container Registry, run the following command:</span></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcloud docker -- pull gcr.io/cloud-marketplace/google/rbe-ubuntu16-04@sha256:&lt;sha256-checksum&gt;
</code></pre></div></div>

<p>Replace <code class="highlighter-rouge">&lt;sha256-checksum&gt;</code> with the SHA256 checksum value for
<a href="https://pantheon.corp.google.com/gcr/images/cloud-marketplace/GLOBAL/google/rbe-ubuntu16-04">the latest container</a>.</p>

<h3 id="building-the-rbe-ubuntu16-04-container-from-source">Building the <code class="highlighter-rouge">rbe-ubuntu16-04</code> container from source</h3>

<p>To build the <code class="highlighter-rouge">rbe-ubuntu16-04</code> container from source, do the following:</p>

<ol>
  <li>
    <p>Clone the <code class="highlighter-rouge">bazel-toolchains</code> repository:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/bazelbuild/bazel-toolchains
</code></pre></div>    </div>
  </li>
  <li>
    <p>Set up toolchain container targets and build the container as explained in
<a href="https://github.com/bazelbuild/bazel-toolchains/tree/master/container">Toolchain Containers</a>.</p>
  </li>
  <li>
    <p>Pull the freshly built container:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcloud docker -- pull gcr.io/&lt;project-id&gt;/&lt;custom-container-name&gt;@sha256:&lt;sha256-checksum&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="running-the-custom-container">Running the custom container</h3>

<p>To run the custom container, do one of the following:</p>

<ul>
  <li>
    <p>If you pulled the container from Container Registry, run the following
command:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it gcr.io/cloud-marketplace/google/rbe-ubuntu16-04@sha256:&lt;sha256-checksum&gt; /bin/bash
</code></pre></div>    </div>

    <p>Replace <code class="highlighter-rouge">sha256-checksum</code> with the SHA256 checksum value for the
<a href="https://pantheon.corp.google.com/gcr/images/cloud-marketplace/GLOBAL/google/rbe-ubuntu16-04">latest container</a>.</p>
  </li>
  <li>
    <p>If you built the container from source, run the following command:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it gcr.io/&lt;project-id&gt;/&lt;custom-container-name&gt;@sha256:&lt;sha256sum&gt; /bin/bash
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="adding-resources-to-the-custom-container">Adding resources to the custom container</h3>

<p>Use a <a href="https://docs.docker.com/engine/reference/builder/"><code class="highlighter-rouge">Dockerfile</code></a> or
<a href="https://github.com/bazelbuild/rules_docker"><code class="highlighter-rouge">rules_docker</code></a> to add resources or
alternate versions of the original resources to the <code class="highlighter-rouge">rbe-ubuntu16-04</code> container.
If you are new to Docker, read the following:</p>

<ul>
  <li><a href="https://github.com/docker/labs/tree/master/beginner">Docker for beginners</a></li>
  <li><a href="https://docs.docker.com/samples/">Docker Samples</a></li>
</ul>

<p>For example, the following <code class="highlighter-rouge">Dockerfile</code> snippet installs <code class="highlighter-rouge">&lt;my_tool_package&gt;</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM gcr.io/cloud-marketplace/google/rbe-ubuntu16-04@sha256:&lt;sha256-checksum&gt;
RUN apt-get update &amp;&amp; yes | apt-get install -y &lt;my_tool_package&gt;
</code></pre></div></div>

<h3 id="pushing-the-custom-container-to-container-registry">Pushing the custom container to Container Registry</h3>

<p>Once you have customized the container, build the container image and push it to
Container Registry as follows:</p>

<ol>
  <li>
    <p>Build the container image:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker build -t &lt;custom-container-name&gt; .docker tag &lt;custom-container-name&gt; gcr.io/&lt;project-id&gt;/&lt;custom-container-name&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Push the container image to Container Registry:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcloud docker -- push gcr.io/&lt;project-id&gt;/&lt;custom-container-name&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Navigate to the following URL to verify the container has been pushed:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://console.cloud.google.com/gcr/images/&lt;project-id&gt;/GLOBAL/&lt;custom-container-name&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Take note of the SHA256 checksum of your custom container. You will need to
provide it in your build platform definition later in this document.</p>
  </li>
  <li>
    <p>Configure the container for public access as described in  publicly
accessible as explained in
<a href="https://cloud.google.com/container-registry/docs/access-control#serving_images_publicly">Serving images publicly</a>.</p>

    <p>For more information, see
<a href="https://cloud.google.com/container-registry/docs/pushing-and-pulling">Pushing and Pulling Images</a>.</p>
  </li>
</ol>

<h3 id="specifying-the-build-platform-definition">Specifying the build platform definition</h3>

<p>You must include a <a href="platforms.html">Bazel platform</a> configuration in your
custom toolchain configuration, which allows Bazel to select a toolchain
appropriate to the desired hardware/software platform. See this
<a href="https://github.com/tensorflow/tensorflow/blob/master/third_party/toolchains/BUILD">example platform configuration</a>
for the TensorFlow <code class="highlighter-rouge">ubuntu16-04</code> container.</p>

<p>Create a similar configuration (that is, using the same constraints) but replace
the value of the <code class="highlighter-rouge">container-image</code> property with the name of your custom
container, as well as your GCR project ID and container image checksum. For
example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker://gcr.io/&lt;project-id&gt;/&lt;custom-container-name&gt; @sha256:&lt;sha256sum&gt;
</code></pre></div></div>

<p>Once you have created a <code class="highlighter-rouge">BUILD</code> file with the platform rule, place it within
your project tree. For example, <code class="highlighter-rouge">/platforms/BUILD</code>.</p>

<h3 id="configuring-buildkite">Configuring Buildkite</h3>

<p>Add the appropriate <code class="highlighter-rouge">build_flag</code> and <code class="highlighter-rouge">test_flag</code> entries to the
<code class="highlighter-rouge">.bazelci/presubmit.yml</code> file in your <code class="highlighter-rouge">rbe_ubuntu1604 </code>config to switch your
builds to using your custom container.
See <a href="https://github.com/bazelbuild/rules_docker/pull/484">example</a>.</p>

<p><strong>Note:</strong> The example linked above uses a platform definition from the
<code class="highlighter-rouge">@bazel_toolchains</code> repo. If your platform rule is in <code class="highlighter-rouge">/platforms/BUILD</code>, the
entries would look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"--extra_execution_platforms=//platforms:&lt;your_platform_target&gt;"
"--host_platform=//platforms:&lt;your_platform_target&gt;"
"--platforms=//platforms:&lt;your_platform_target&gt;"
</code></pre></div></div>

          </div>
        </div>

        <div class="col-md-2 sticky-sidebar">
            <div class="right-sidebar">
                <ul class="gh-links">
                    <li><a href="https://github.com/bazelbuild/bazel/issues/new?title=Documentation issue: Configuring Bazel CI for Testing Rules Against Remote Execution&body=Documentation URL: https://docs.bazel.build/versions/0.27.0/remote-execution-ci.html&labels=type: documentation"><i class="fa fa-github"></i> Create issue</a></li>
                    <li id="gh-edit-list-item" class="default-hidden" aria-hidden="true"><a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit this page</a></li>
                </ul>
                <script>
                 var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
                 var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
                 var editButton = document.getElementById('gh-edit');
                 var editButtonListItem = document.getElementById('gh-edit-list-item');
                 // if there is an edit button and we are not in the Build Encyclopedia
                 // or other generated files.
                 if (editButton
                     && window.location.pathname.match(versionDocsURLRegex)
                     && window.location.pathname.lastIndexOf('/be/') == -1
                     && window.location.pathname.lastIndexOf('/repo/') == -1
                     && window.location.pathname.lastIndexOf('/skylark/lib/') == -1
                     && window.location.pathname.lastIndexOf('/command-line-reference.html') == -1) {
                     var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
                     // some pages are not using markdown :(
                     if (docFile !== 'user-manual.html'
                         && docFile !== 'build-ref.html'
                         && docFile !== 'query.html'
                         && docFile !== 'test-encyclopedia.html') {
                         docFile = docFile.replace('html', 'md');
                     }
                     editButton.href = ghDocsBazeURL + docFile;
                     editButton.style.visibility = 'visible';
                     editButtonListItem.style.visibility = 'visible';
                 }
                </script>

                <ul class="page-toc">
<li class="toc-entry toc-h2"><a href="#overview">Overview</a></li>
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#setting-up-the-bazel-ci-for-testing">Setting up the Bazel CI for testing</a></li>
<li class="toc-entry toc-h2"><a href="#troubleshooting-failed-builds-and-tests">Troubleshooting failed builds and tests</a></li>
<li class="toc-entry toc-h2"><a href="#using-a-custom-container-in-the-rbe_ubuntu1604-ci-config">Using a custom container in the rbe_ubuntu1604 CI config</a>
<ul class="page-toc-sublist">
<li class="toc-entry toc-h3"><a href="#pulling-the-rbe-ubuntu16-04-from-container-registry">Pulling the rbe-ubuntu16-04 from Container Registry</a></li>
<li class="toc-entry toc-h3"><a href="#building-the-rbe-ubuntu16-04-container-from-source">Building the rbe-ubuntu16-04 container from source</a></li>
<li class="toc-entry toc-h3"><a href="#running-the-custom-container">Running the custom container</a></li>
<li class="toc-entry toc-h3"><a href="#adding-resources-to-the-custom-container">Adding resources to the custom container</a></li>
<li class="toc-entry toc-h3"><a href="#pushing-the-custom-container-to-container-registry">Pushing the custom container to Container Registry</a></li>
<li class="toc-entry toc-h3"><a href="#specifying-the-build-platform-definition">Specifying the build platform definition</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-buildkite">Configuring Buildkite</a></li>
</ul>
</li>
</ul>
            </div>
        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//www.google.com/insights/consumersurveys/async_survey?site=hihwpyy5e5kllsq62elzjrcgn4"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
        <li><a href="//sitemap.xml">Sitemap</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
        <li><a href="https://slack.bazel.build">Slack</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2020 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

