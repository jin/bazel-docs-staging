<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Backward Compatibility - Bazel</title>

    <link rel="canonical" href="/versions/0.19.1/skylark/backward-compatibility.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700|Source+Code+Pro:400,500,700" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Backward Compatibility"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="012346921571893344015:xv_nfgpzbu4">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="page-title-bar">
      <div class="container">
        <h1>Documentation</h1>
      </div>
    </div>

    <div class="container vpad">
      <div class="row">
        <div class="col-md-3">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>
          <nav class="sidebar collapse" id="sidebar-nav">
           <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/skylark/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

           <h3>Using Bazel</h3>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                 </ul>
                </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#tutorials-menu" aria-expanded="false"
                    aria-controls="tutorials-menu">
                  Tutorials<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="tutorials-menu">
                   <li><a href="/versions/master/tutorial/java.html">Building a Java Project</a></li>
                   <li><a href="/versions/master/tutorial/cpp.html">Building a C++ Project</a></li>
                   <li><a href="/versions/master/tutorial/android-app.html">Building an Android App</a></li>
                   <li><a href="/versions/master/tutorial/ios-app.html">Building an iOS App</a></li>
                   <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                   <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
              <li><a href="/versions/master/guide.html">User's Guide</a></li>
              <li><a href="/versions/master/external.html">External Dependencies</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/user-manual.html#aquery">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
              <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/remote-caching.html">Remote Caching</a></li>
             </ul>

           <h3>Rules</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/be/overview.html">Build Encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/master/bazel-and-android.html">Android Resources</a></li>
                  <li><a href="/versions/master/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/master/android-instrumentation-test.html">Android Instrumentation Tests</a></li>
                  <li><a href="/versions/master/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio Plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/master/bazel-and-apple.html">Apple Resources</a></li>
                  <li><a href="/versions/master/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/master/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/master/bazel-and-cpp.html">C++ Resources</a></li>
                  <li><a href="/versions/master/cpp-use-cases.html">C++ Use Cases</a></li>
                  <li><a href="/versions/master/crosstool-reference.html">Understanding CROSSTOOL</a></li>
                  <li><a href="/versions/master/tutorial/crosstool.html">Tutorial: CROSSTOOL</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/master/bazel-and-java.html">Java Resources</a></li>
                  <li><a href="/versions/master/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/master/generate-workspace.html">Converting Maven Dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/master/bazel-and-javascript.html">JavaScript Resources</a></li>
                  <li><a href="/versions/master/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="/versions/master/skylark/skylint.html">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-9">
          <a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a>
          <script>
            var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
            var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
            var editButton = document.getElementById('gh-edit');
            // if there is an edit button and we are not in the Build Encyclopedia
            if (editButton
                && window.location.pathname.match(versionDocsURLRegex)
                && window.location.pathname.lastIndexOf('/be/') == -1
                && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
              var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
              // some pages are not using markdown :(
              if (docFile !== 'user-manual.html'
                  && docFile !== 'build-ref.html'
                  && docFile !== 'query.html'
                  && docFile !== 'test-encyclopedia.html') {
                docFile = docFile.replace('html', 'md');
              }
              editButton.href = ghDocsBazeURL + docFile;
              editButton.style.visibility = 'visible';
            }
          </script>

          <!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
          <!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->
          

          <p>Documentation for Bazel 0.19.1</p>
          <select id="touchsplashmenu" onchange="location.href=this.value">
              <option value="">Choose a Bazel version</option>
              
              <option value="/versions/master/skylark/backward-compatibility.html">master</option>
              
              <option value="/versions/0.19.1/skylark/backward-compatibility.html">0.19.1</option>
              
              <option value="/versions/0.17.1/skylark/backward-compatibility.html">0.17.1</option>
              
          </select>

          <h1 id="backward-compatibility">Backward Compatibility</h1>

<p>Bazel is still in Beta and new releases may include backward incompatible
changes. As we make changes and polish the extension mechanism, old features
may be removed and new features that are not backward compatible may be added.</p>

<p>Backward incompatible changes are introduced gradually:</p>

<ol>
  <li>The backward incompatible change is introduced behind a flag with its
default value set to <code class="highlighter-rouge">false</code>.</li>
  <li>In a later release, the flag’s default value will be set to <code class="highlighter-rouge">true</code>. You
can still use the flag to disable the change.</li>
  <li>Then in a later release, the flag will be removed and you will no longer be
able to disable the change.</li>
</ol>

<p>To check if your code will be compatible with future releases you can:</p>

<ul>
  <li>Build your code with the flag <code class="highlighter-rouge">--all_incompatible_changes</code>. This flag
enables all backward incompatible changes, and so you can ensure your code
is compatible with upcoming changes.</li>
  <li>Use boolean flags to enable/disable specific backward incompatible changes.</li>
</ul>

<h2 id="current-backward-incompatible-changes">Current backward incompatible changes</h2>

<p>The following are the backward incompatible changes that are implemented and
guarded behind flags in the current release:</p>

<ul>
  <li><a href="#dictionary-concatenation">Dictionary concatenation</a></li>
  <li><a href="#load-must-appear-at-top-of-file">Load must appear at top of file</a></li>
  <li><a href="#depset-is-no-longer-iterable">Depset is no longer iterable</a></li>
  <li><a href="#depset-union">Depset union</a></li>
  <li><a href="#string-is-no-longer-iterable">String is no longer iterable</a></li>
  <li><a href="#integer-division-operator-is">Integer division operator is //</a></li>
  <li><a href="#package-name-is-a-function">Package name is a function</a></li>
  <li><a href="#filetype-is-deprecated">FileType is deprecated</a></li>
  <li><a href="#new-actions-api">New actions API</a></li>
  <li><a href="#new-args-api">New args API</a></li>
  <li><a href="#disable-objc-provider-resources">Disable objc provider resources</a></li>
  <li><a href="#remove-native-git-repository">Remove native git repository</a></li>
  <li><a href="#remove-native-http-archive">Remove native http archive</a></li>
  <li><a href="#new-style-java_info">New-style JavaInfo constructor</a></li>
  <li><a href="#disallow-tools-in-action-inputs">Disallow tools in action inputs</a></li>
  <li><a href="#expand-directories-in-args">Expand directories in Args</a></li>
  <li><a href="#static-name-resolution">Static Name Resolution</a></li>
  <li><a href="#disable-inmemory-tools-defaults-package">Disable InMemory Tools Defaults Package</a></li>
  <li><a href="#disable-late-bound-option-defaults">Disable late bound option defaults</a></li>
  <li><a href="#disable-depsets-in-c-toolchain-api-in-user-flags">Disable depsets in C++ toolchain API in user
flags</a></li>
  <li><a href="#disallow-using-crosstool-to-select-the-cc_toolchain-label">Disallow using CROSSTOOL to select the cc_toolchain label</a></li>
  <li><a href="#disallow-using-c-specific-make-variables-from-the-configuration">Disallow using C++ Specific Make Variables from the configuration</a></li>
  <li><a href="#disable-legacy-c-configuration-api">Disable legacy C++ configuration API</a></li>
  <li><a href="#disable-legacy-c-toolchain-api">Disable legacy C++ toolchain API</a></li>
</ul>

<h3 id="dictionary-concatenation">Dictionary concatenation</h3>

<p>We are removing the <code class="highlighter-rouge">+</code> operator on dictionaries. This includes the <code class="highlighter-rouge">+=</code> form
where the left-hand side is a dictionary. This is done to improve compatibility
with Python. A possible workaround is to use the <code class="highlighter-rouge">.update</code> method instead.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disallow_dict_plus</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="load-must-appear-at-top-of-file">Load must appear at top of file</h3>

<p>Previously, the <code class="highlighter-rouge">load</code> statement could appear anywhere in a <code class="highlighter-rouge">.bzl</code> file so long
as it was at the top level. With this change, for <code class="highlighter-rouge">.bzl</code> files, <code class="highlighter-rouge">load</code> must
appear at the beginning of the file, i.e. before any other non-<code class="highlighter-rouge">load</code> statement.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_bzl_disallow_load_after_statement</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="depset-is-no-longer-iterable">Depset is no longer iterable</h3>

<p>When the flag is set to true, <code class="highlighter-rouge">depset</code> objects are not treated as iterable. This
prohibits directly iterating over depsets in <code class="highlighter-rouge">for</code> loops, taking its size via
<code class="highlighter-rouge">len()</code>, and passing it to many functions such as <code class="highlighter-rouge">list</code>, <code class="highlighter-rouge">tuple</code>, <code class="highlighter-rouge">min</code>, <code class="highlighter-rouge">max</code>,
<code class="highlighter-rouge">sorted</code>, <code class="highlighter-rouge">all</code>, and <code class="highlighter-rouge">any</code>. It does not prohibit checking for emptiness by
converting the depset to a boolean.</p>

<p>The goal of this change is to avoid accidental iteration on <code class="highlighter-rouge">depset</code>, which can
be <a href="performance.html#avoid-calling-depsetto-list">expensive</a>. If you really need
to iterate over a depset, you can call the <code class="highlighter-rouge">.to_list()</code> method to obtain a
flattened list of its contents.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">deps</span> <span class="o">=</span> <span class="n">depset</span><span class="p">()</span>
<span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">]</span>  <span class="c"># deprecated</span>
<span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">deps</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>  <span class="c"># recommended</span>

<span class="nb">sorted</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>  <span class="c"># deprecated</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">deps</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>  <span class="c"># recommended</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_depset_is_not_iterable</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="depset-union">Depset union</h3>

<p>To merge two sets, the following examples used to be supported, but are now
deprecated:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">depset1</span> <span class="o">+</span> <span class="n">depset2</span>  <span class="c"># deprecated</span>
<span class="n">depset1</span> <span class="o">|</span> <span class="n">depset2</span>  <span class="c"># deprecated</span>
<span class="n">depset1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">depset2</span><span class="p">)</span>  <span class="c"># deprecated</span>
</code></pre></div></div>

<p>The recommended solution is to use the <code class="highlighter-rouge">depset</code> constructor:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">depset</span><span class="p">(</span><span class="n">transtive</span><span class="o">=</span><span class="p">[</span><span class="n">depset1</span><span class="p">,</span> <span class="n">depset2</span><span class="p">])</span>
</code></pre></div></div>

<p>See the <a href="depsets.html"><code class="highlighter-rouge">depset documentation</code></a> for more information.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_depset_union</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="string-is-no-longer-iterable">String is no longer iterable</h3>

<p>When the flag is set to true, <code class="highlighter-rouge">string</code> objects are not treated as iterable. This
affects <code class="highlighter-rouge">for</code> loops and many functions, e.g. <code class="highlighter-rouge">list</code>, <code class="highlighter-rouge">tuple</code>, <code class="highlighter-rouge">min</code>, <code class="highlighter-rouge">max</code>,
<code class="highlighter-rouge">sorted</code>, <code class="highlighter-rouge">all</code>, and <code class="highlighter-rouge">any</code>. String iteration has been a source of errors and
confusion, such as this error:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_macro</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">srcs</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">srcs</span><span class="p">:</span>
    <span class="c"># do something with src</span>

<span class="c"># equivalent to: my_macro("hello", ["f", "o", "o", ".", "c", "c"])</span>
<span class="n">my_macro</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s">"hello"</span><span class="p">,</span>
  <span class="n">srcs</span> <span class="o">=</span> <span class="s">"foo.cc"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>String indexing and <code class="highlighter-rouge">len</code> are still allowed. If you need to iterate over a
string, you may explicitly use:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_string</span> <span class="o">=</span> <span class="s">"hello world"</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_string</span><span class="p">)):</span>
  <span class="n">char</span> <span class="o">=</span> <span class="n">my_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="c"># do something with char</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_string_is_not_iterable</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="integer-division-operator-is-">Integer division operator is <code class="highlighter-rouge">//</code></h3>

<p>Integer division operator is now <code class="highlighter-rouge">//</code> instead of <code class="highlighter-rouge">/</code>. This aligns with
Python 3 and it highlights the fact it is a floor division.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c"># deprecated</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c"># x is 3</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disallow_slash_operator</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="package-name-is-a-function">Package name is a function</h3>

<p>The current package name should be retrieved by calling <code class="highlighter-rouge">package_name()</code> in
BUILD files or <code class="highlighter-rouge">native.package_name()</code> in .bzl files. The old way of referring
to the magic <code class="highlighter-rouge">PACKAGE_NAME</code> variable bends the language since it is neither a
parameter, local variable, nor global variable.</p>

<p>Likewise, the magic <code class="highlighter-rouge">REPOSITORY_NAME</code> variable is replaced by
<code class="highlighter-rouge">repository_name()</code> and <code class="highlighter-rouge">native.repository_name()</code>. Both deprecations use the
same flag.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_package_name_is_a_function</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="filetype-is-deprecated">FileType is deprecated</h3>

<p>The <a href="lib/FileType.html">FileType</a> function is going away. The main use-case was
as an argument to the <a href="lib/globals.html#rule">rule function</a>. It’s no longer
needed, you can simply pass a list of strings to restrict the file types the
rule accepts.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disallow_filetype</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="new-actions-api">New actions API</h3>

<p>This change removes the old methods for registering actions within rules, and
requires that you use the new methods instead. The deprecated methods and their
replacements are as follows.</p>

<ul>
  <li><code class="highlighter-rouge">ctx.new_file(...)</code> –&gt; <code class="highlighter-rouge">ctx.actions.declare_file(...)</code></li>
  <li><code class="highlighter-rouge">ctx.experimental_new_directory(...)</code> –&gt;
<code class="highlighter-rouge">ctx.actions.declare_directory(...)</code></li>
  <li><code class="highlighter-rouge">ctx.action(...)</code> –&gt; either <code class="highlighter-rouge">ctx.actions.run(...)</code> or
<code class="highlighter-rouge">ctx.actions.run_shell(...)</code></li>
  <li><code class="highlighter-rouge">ctx.file_action(...)</code> –&gt; <code class="highlighter-rouge">ctx.actions.write(...)</code></li>
  <li><code class="highlighter-rouge">ctx.empty_action(...)</code> –&gt; <code class="highlighter-rouge">ctx.actions.do_nothing(...)</code></li>
  <li><code class="highlighter-rouge">ctx.template_action(...)</code> –&gt; <code class="highlighter-rouge">ctx.actions.expand_template(...)</code></li>
</ul>

<!-- filler comment, needed by Markdown to separate the lists -->

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_new_actions_api</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="new-args-api">New args API</h3>

<p>The <a href="lib/Args.html">Args</a> object returned by <code class="highlighter-rouge">ctx.actions.args()</code> has dedicated
methods for appending the contents of a list or depset to the command line.
Previously these use cases were lumped into its <a href="lib/Args.html#add"><code class="highlighter-rouge">add()</code></a>
method, resulting in a more cluttered API.</p>

<p>With this flag, <code class="highlighter-rouge">add()</code> only works for scalar values, and its deprecated
parameters are disabled. To add many arguments at once you must use <code class="highlighter-rouge">add_all()</code>
or <code class="highlighter-rouge">add_joined()</code> instead.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disallow_old_style_args_add</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="python-3-range-behavior">Python 3 range behavior.</h3>
<p>When set, the result of <code class="highlighter-rouge">range(...)</code> function is a lazy <code class="highlighter-rouge">range</code> type instead of
a <code class="highlighter-rouge">list</code>. Because of this repetitions using <code class="highlighter-rouge">*</code> operator are no longer
supported and <code class="highlighter-rouge">range</code> slices are also lazy <code class="highlighter-rouge">range</code> instances.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_range_type</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="disable-objc-provider-resources">Disable objc provider resources</h3>

<p>This flag disables certain deprecated resource fields on
<a href="lib/ObjcProvider.html">ObjcProvider</a>.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_objc_provider_resources</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="remove-native-git-repository">Remove native git repository</h3>

<p>When set, the native <code class="highlighter-rouge">git_repository</code> and <code class="highlighter-rouge">new_git_repository</code> rules are
disabled. The Starlark versions</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">"@bazel_tools//tools/build_defs/repo:git.bzl"</span><span class="p">,</span>
     <span class="s">"git_repository"</span><span class="p">,</span> <span class="s">"new_git_repository"</span><span class="p">)</span>
</code></pre></div></div>

<p>should be used instead. These are drop-in replacements of the corresponding
native rules, however with the additional requirement that all label arguments
be provided as a fully qualified label (usually starting with <code class="highlighter-rouge">@//</code>),
for example: <code class="highlighter-rouge">build_file = "@//third_party:repo.BUILD"</code>.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_remove_native_git_repository</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="remove-native-http-archive">Remove native http archive</h3>

<p>When set, the native <code class="highlighter-rouge">http_archive</code> and all related rules are disabled.
The Starlark version</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span><span class="p">,</span> <span class="s">"http_archive"</span><span class="p">)</span>
</code></pre></div></div>

<p>should be used instead. This is a drop-in replacement, however with the
additional requirement that all label arguments be provided as
fully qualified labels (usually starting with <code class="highlighter-rouge">@//</code>). The Starlark <code class="highlighter-rouge">http_archive</code>
is also a drop-in replacement for the native <code class="highlighter-rouge">new_http_archive</code> (with
the same proviso). <code class="highlighter-rouge">http.bzl</code> also
provides <code class="highlighter-rouge">http_jar</code> and <code class="highlighter-rouge">http_file</code> (the latter only supports the <code class="highlighter-rouge">urls</code>
parameter, not <code class="highlighter-rouge">url</code>).</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_remove_native_http_archive</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="new-style-javainfo-constructor">New-style JavaInfo constructor</h3>

<p>When set, <code class="highlighter-rouge">java_common.create_provider</code> and certain arguments to <code class="highlighter-rouge">JavaInfo</code> are deprecated. The
deprecated arguments are: <code class="highlighter-rouge">actions</code>, <code class="highlighter-rouge">sources</code>, <code class="highlighter-rouge">source_jars</code>, <code class="highlighter-rouge">use_ijar</code>, <code class="highlighter-rouge">java_toolchain</code>,
and <code class="highlighter-rouge">host_javabase</code>.</p>

<p>Example migration from <code class="highlighter-rouge">create_provider</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">java_common</span><span class="o">.</span><span class="n">create_provider</span><span class="p">(</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
    <span class="n">compile_time_jars</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_jar</span><span class="p">],</span>
    <span class="n">use_ijar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">java_toolchain</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_java_toolchain</span><span class="p">,</span>
    <span class="n">transitive_compile_time_jars</span> <span class="o">=</span> <span class="n">transitive_compile_time</span><span class="p">,</span>
    <span class="n">transitive_runtime_jars</span> <span class="o">=</span> <span class="n">transitive_runtime_jars</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">compile_jar</span> <span class="o">=</span> <span class="n">java_common</span><span class="o">.</span><span class="n">run_ijar</span><span class="p">(</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
    <span class="n">jar</span> <span class="o">=</span> <span class="n">output_jar</span><span class="p">,</span>
    <span class="n">target_label</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">java_toolchain</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_java_toolchain</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">JavaInfo</span><span class="p">(</span>
    <span class="n">output_jar</span> <span class="o">=</span> <span class="n">output_jar</span><span class="p">,</span>
    <span class="n">compile_jar</span> <span class="o">=</span> <span class="n">compile_jar</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">deps</span><span class="p">,</span>
    <span class="n">runtime_deps</span> <span class="o">=</span> <span class="n">runtime_deps</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Example migration from deprecated <code class="highlighter-rouge">JavaInfo</code> arguments:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">JavaInfo</span><span class="p">(</span>
  <span class="n">output_jar</span> <span class="o">=</span> <span class="n">my_jar</span><span class="p">,</span>
  <span class="n">use_ijar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
  <span class="n">sources</span> <span class="o">=</span> <span class="n">my_sources</span><span class="p">,</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="n">my_compile_deps</span><span class="p">,</span>
  <span class="n">runtime_deps</span> <span class="o">=</span> <span class="n">my_runtime_deps</span><span class="p">,</span>
  <span class="n">actions</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
  <span class="n">java_toolchain</span> <span class="o">=</span> <span class="n">my_java_toolchain</span><span class="p">,</span>
  <span class="n">host_javabase</span> <span class="o">=</span> <span class="n">my_host_javabase</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">my_ijar</span> <span class="o">=</span> <span class="n">java_common</span><span class="o">.</span><span class="n">run_ijar</span><span class="p">(</span>
  <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
  <span class="n">jar</span> <span class="o">=</span> <span class="n">my_jar</span><span class="p">,</span>
  <span class="n">target_label</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
  <span class="n">java_toolchain</span><span class="p">,</span> <span class="n">my_java_toolchain</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">my_source_jar</span> <span class="o">=</span> <span class="n">java_common</span><span class="o">.</span><span class="n">pack_sources</span><span class="p">(</span>
  <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
  <span class="n">sources</span> <span class="o">=</span> <span class="n">my_sources</span><span class="p">,</span>
  <span class="n">java_toolchain</span> <span class="o">=</span> <span class="n">my_java_toolchain</span><span class="p">,</span>
  <span class="n">host_javabase</span> <span class="o">=</span> <span class="n">my_host_javabase</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">JavaInfo</span><span class="p">(</span>
  <span class="n">output_jar</span> <span class="o">=</span> <span class="n">my_jar</span><span class="p">,</span>
  <span class="n">compile_jar</span> <span class="o">=</span> <span class="n">my_ijar</span><span class="p">,</span>
  <span class="n">source_jar</span> <span class="o">=</span> <span class="n">my_source_jar</span><span class="p">,</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="n">my_compile_deps</span><span class="p">,</span>
  <span class="n">runtime_deps</span> <span class="o">=</span> <span class="n">my_runtime_deps</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="disallow-tools-in-action-inputs">Disallow tools in action inputs</h3>

<p>A tool is an input coming from an attribute of type <code class="highlighter-rouge">label</code>
where the attribute has been marked <code class="highlighter-rouge">executable = True</code>. In order for an action
to run a tool, it needs access to its runfiles.</p>

<p>Under the old API, tools are passed to <code class="highlighter-rouge">ctx.actions.run()</code> and
<code class="highlighter-rouge">ctx.actions.run_shell()</code> via their <code class="highlighter-rouge">inputs</code> parameter. Bazel scans this
argument (which may be a large depset) to find all the inputs that are tools,
and adds their runfiles automatically.</p>

<p>In the new API, tools are instead passed to a dedicated <code class="highlighter-rouge">tools</code> parameter. The
<code class="highlighter-rouge">inputs</code> are not scanned. If a tool is accidentally put in <code class="highlighter-rouge">inputs</code> instead of
<code class="highlighter-rouge">tools</code>, the action will fail during the execution phase with an error due to
missing runfiles. This may be somewhat cryptic.</p>

<p>To support a gradual transition, all actions with a <code class="highlighter-rouge">tools</code> argument are opted
into the new API, while all actions without a <code class="highlighter-rouge">tools</code> argument still follow the
old one. In the future (when this flag is removed), all actions will use the new
API unconditionally.</p>

<p>This flag turns on a safety check that is useful for migrating existing code.
The safety check applies to all actions that do not have a <code class="highlighter-rouge">tools</code> argument. It
scans the <code class="highlighter-rouge">inputs</code> looking for tools, and if it finds any, it raises an error
during the analysis phase that clearly identifies the offending tools.</p>

<p>In the rare case that your action requires a tool as input, but does not
actually run the tool and therefore does not need its runfiles, the safety check
will fail even though the action would have succeeded. In this case, you can
bypass the check by adding a (possibly empty) <code class="highlighter-rouge">tools</code> argument to your action.
Note that once an action has been modified to take a <code class="highlighter-rouge">tools</code> argument, you will
no longer get helpful analysis-time errors for any remaining tools that should
have been migrated from <code class="highlighter-rouge">inputs</code>.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_no_support_tools_in_action_inputs</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="expand-directories-in-args">Expand directories in Args</h3>

<p>Previously, directories created by
<a href="lib/actions.html#declare_directory"><code class="highlighter-rouge">ctx.actions.declare_directory</code></a> expanded
to the path of the directory when added to an <a href="lib/Args.html"><code class="highlighter-rouge">Args</code></a> object.</p>

<p>With this flag enabled, directories are instead replaced by the full file
contents of that directory when passed to <code class="highlighter-rouge">args.add_all()</code> or
<code class="highlighter-rouge">args.add_joined()</code>. (Directories may not be passed to <code class="highlighter-rouge">args.add()</code>.)</p>

<p>If you want the old behavior on a case-by-case basis (perhaps your tool can
handle directories on the command line), you can pass <code class="highlighter-rouge">expand_directories=False</code>
to the <code class="highlighter-rouge">args.add_all()</code> or <code class="highlighter-rouge">args.add_joined()</code> call.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>d = ctx.action.declare_directory(“dir”)
# ... Some action runs and produces [“dir/file1”, “dir/file2”] ...
f = ctx.action.declare_file(“file”)
args = ctx.action.args()
args.add_all([d, f])
  -&gt; Used to expand to ["dir", "file"]
     Now expands to [“dir/file1”, “dir/file2”, “file”]
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_expand_directories</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="static-name-resolution">Static Name Resolution</h3>

<p>When the flag is set, use a saner way to resolve variables. The previous
behavior was buggy in a number of subtle ways. See <a href="https://github.com/bazelbuild/proposals/blob/master/docs/2018-06-18-name-resolution.html">the
proposal</a>
for background and examples.</p>

<p>The proposal is not fully implemented yet.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_static_name_resolution</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h3 id="disallow-transitive-loads">Disallow transitive loads</h3>

<p>When the flag is set, <code class="highlighter-rouge">load</code> can only import symbols that were explicitly
defined in the target file, using either <code class="highlighter-rouge">=</code> or <code class="highlighter-rouge">def</code>.</p>

<p>When the flag is unset (legacy behavior), <code class="highlighter-rouge">load</code> may also import symbols that
come from other <code class="highlighter-rouge">load</code> statements.</p>

<p>In other words, the <code class="highlighter-rouge">x</code> below is exported only if the flag is unset:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s">":file.bzl"</span><span class="p">,</span> <span class="s">"x"</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_no_transitive_loads</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.19.0</code></li>
  <li>Tracking issue: https://github.com/bazelbuild/bazel/issues/5636</li>
</ul>

<h3 id="disable-inmemory-tools-defaults-package">Disable InMemory Tools Defaults Package</h3>

<p>If false, Bazel constructs an in-memory <code class="highlighter-rouge">//tools/defaults</code> package based on the
command line options. If true, <code class="highlighter-rouge">//tools/defaults:*</code> is resolved from file system
as a regular package.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_tools_defaults_package</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
</ul>

<h4 id="motivation">Motivation:</h4>

<p><code class="highlighter-rouge">//tools/default</code> was initially created as virtual in-memory package. It
generates content dynamically based on current configuration. There is no need
of having <code class="highlighter-rouge">//tools/defaults</code> any more as LateBoundAlias can do dynamic
configuration-based label resolving.  Also, having <code class="highlighter-rouge">//tools/default</code> makes
negative impact on performance, and introduces unnecessary code complexity.</p>

<p>All references to <code class="highlighter-rouge">//tools/defaults:*</code> targets should be removed or replaced
to corresponding target in <code class="highlighter-rouge">@bazel_tools//tools/jdk:</code> and
<code class="highlighter-rouge">@bazel_tools//tools/cpp:</code> packages.</p>

<h4 id="scope-of-changes-and-impact">Scope of changes and impact:</h4>

<p>Targets in <code class="highlighter-rouge">//tools/default</code> will not exist any more. If you have any references
inside your BUILD or *.bzl files to any of its, then bazel will fail to resolve.</p>

<h4 id="migration-plan">Migration plan:</h4>

<p>Please replace all occurrences:</p>

<ul>
  <li><code class="highlighter-rouge">//tools/defaults:jdk</code>
    <ul>
      <li>by <code class="highlighter-rouge">@bazel_tools//tools/jdk:current_java_runtime</code></li>
      <li>or/and <code class="highlighter-rouge">@bazel_tools//tools/jdk:current_host_java_runtime</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">//tools/defaults:java_toolchain</code>
    <ul>
      <li>by <code class="highlighter-rouge">@bazel_tools//tools/jdk:current_java_toolchain</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">//tools/defaults:crosstool</code>
    <ul>
      <li>by <code class="highlighter-rouge">@bazel_tools//tools/cpp:current_cc_toolchain</code></li>
      <li>or/and <code class="highlighter-rouge">@bazel_tools//tools/cpp:current_cc_host_toolchain</code></li>
      <li>if you need reference to <code class="highlighter-rouge">libc_top</code>, then <code class="highlighter-rouge">@bazel_tools//tools/cpp:current_libc_top</code></li>
    </ul>
  </li>
</ul>

<p>These targets will not be supported any more:</p>

<ul>
  <li><code class="highlighter-rouge">//tools/defaults:coverage_report_generator</code></li>
  <li><code class="highlighter-rouge">//tools/defaults:coverage_support</code></li>
</ul>

<h3 id="disable-late-bound-option-defaults">Disable late bound option defaults</h3>

<p>If true, Bazel will stop retrieving the value of <code class="highlighter-rouge">compiler</code> from the cpp configuration when
<code class="highlighter-rouge">--compiler</code> is not specified. This will cause a <code class="highlighter-rouge">config_setting</code> that have
<code class="highlighter-rouge">values = {"compiler": "x"}</code> to not work properly when <code class="highlighter-rouge">--compiler</code> is not specified at command
line.</p>

<p>The former behavior can be achieved by changing the <code class="highlighter-rouge">config_setting</code> to use
<code class="highlighter-rouge">flag_values = {"@bazel_tools/tools/cpp:compiler": "x"}</code> instead:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"cpu_x_compiler_y"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"x"</span><span class="p">,</span>
        <span class="s">"compiler"</span><span class="p">:</span> <span class="s">"y"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">config_setting</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"cpu_x_compiler_y"</span><span class="p">,</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"cpu"</span><span class="p">:</span> <span class="s">"x"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">flag_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"@bazel_tools/tools/cpp:compiler"</span><span class="p">:</span> <span class="s">"y"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_late_bound_option_defaults</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.18.0</code></li>
</ul>

<h3 id="disable-depsets-in-c-toolchain-api-in-user-flags">Disable depsets in C++ toolchain API in user flags</h3>

<p>If true, Bazel will no longer accept depsets in <code class="highlighter-rouge">user_compile_flags</code> for
<a href="https://docs.bazel.build/versions/master/skylark/lib/cc_common.html#create_compile_variables">create_compile_variables</a>,
and in <code class="highlighter-rouge">user_link_flags</code> for
<a href="https://docs.bazel.build/versions/master/skylark/lib/cc_common.html#create_link_variables">create_link_variables</a>.
Use plain lists instead.</p>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_depset_in_cc_user_flags</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.18.0</code></li>
</ul>

<h3 id="disallow-using-crosstool-to-select-the-cc_toolchain-label">Disallow using CROSSTOOL to select the cc_toolchain label</h3>

<p>Currently Bazel selects the <code class="highlighter-rouge">cc_toolchain</code> to use from the <code class="highlighter-rouge">toolchains</code>
dictionary attribute of <code class="highlighter-rouge">cc_toolchain_suite</code>. The key it uses is constructed
the following way:</p>

<ul>
  <li>If <code class="highlighter-rouge">--compiler</code> option is specified, the key is <code class="highlighter-rouge">--cpu|--compiler</code>. Bazel
 errors out if the entry doesn’t exist.</li>
  <li>If <code class="highlighter-rouge">--compiler</code> option was not specified on command line, Bazel checks if
 an entry with the key <code class="highlighter-rouge">--cpu</code> exists, and uses it if it does. If such an
 entry doesn’t exist, it loops through the <code class="highlighter-rouge">default_toolchain</code> list in the
 CROSSTOOL file, selects the first one that matches the <code class="highlighter-rouge">--cpu</code> option,
 finds the <code class="highlighter-rouge">CToolchain</code> whose identifier matches the
 <code class="highlighter-rouge">default_toolchain.toolchain_identifier</code> field, and then uses the key
 <code class="highlighter-rouge">CToolchain.targetCpu|Ctoolchain.compiler</code>. It errors out if the entry
 doesn’t exist.</li>
</ul>

<p>We’re making selection of the <code class="highlighter-rouge">cc_toolchain</code> label independent of the
CROSSTOOL file: when the flag is set to True, Bazel will no longer loop
through the <code class="highlighter-rouge">default_toolchain</code> list in order to construct a key for selecting
a <code class="highlighter-rouge">cc_toolchain</code> label from <code class="highlighter-rouge">cc_toolchain_suite.toolchains</code>, but throw an error
instead.</p>

<p>In order to not be affected by this change, one should add entries in the
<code class="highlighter-rouge">cc_toolchain_suite.toolchains</code> for the potential values of <code class="highlighter-rouge">--cpu</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="n">cc_toolchain_suite</span><span class="p">(</span>
    <span class="n">toolchains</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cpu1|compiler1'</span> <span class="p">:</span> <span class="s">':cc_toolchain_label1'</span><span class="p">,</span>
        <span class="s">'cpu2|compiler2'</span> <span class="p">:</span> <span class="s">':cc_tolchain_label2'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">cc_toolchain_suite</span><span class="p">(</span>
    <span class="n">toolchains</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cpu1|compiler1'</span> <span class="p">:</span> <span class="s">':cc_toolchain_label1'</span><span class="p">,</span>
        <span class="s">'cpu2|compiler2'</span> <span class="p">:</span> <span class="s">':cc_toolchain_label2'</span><span class="p">,</span>
        <span class="s">'cpu1'</span> <span class="p">:</span> <span class="s">':cc_toolchain_label3'</span><span class="p">,</span>
        <span class="s">'cpu2'</span> <span class="p">:</span> <span class="s">':cc_tolchain_label4'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_cc_toolchain_label_from_crosstool_proto</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.18.0</code></li>
</ul>

<h3 id="disallow-using-c-specific-make-variables-from-the-configuration">Disallow using C++ Specific Make Variables from the configuration</h3>

<p>Currently Bazel allows rule authors to access certain Make variables that are
implicitly provided to every rule by the CppConfiguration. This causes every
target to implicitly depend on CppConfiguration, which creates an undesirable
number of extra, unused, dependencies.</p>

<p>We are removing the implicit provision of these Make variables, and requiring
rules and targets that use these Make variables to explicitly depend on a
C++ toolchain in order to access them.</p>

<p>The list of Make variables is:</p>

<ul>
  <li>CC</li>
  <li>AR</li>
  <li>NM</li>
  <li>LD</li>
  <li>OBJCOPY</li>
  <li>STRIP</li>
  <li>GCOVTOOL</li>
  <li>GLIBC_VERSION</li>
  <li>C_COMPILER</li>
  <li>CROSSTOOLTOP</li>
  <li>ABI_GLIBC_VERSION</li>
  <li>ABI</li>
</ul>

<p>In order to not be affected by this change, one should add a
C++ toolchain to the <code class="highlighter-rouge">toolchains</code> attribute for targets, or to the
<code class="highlighter-rouge">_toolchains</code> attribute for Starlark rules. The best choice for this value is
the alias target <code class="highlighter-rouge">@bazel_tools//tools/cpp:current_cc_toolchain</code>, which will
always resolve to the currently selected C++ toolchain.</p>

<p>For genrules and other targets using C++ Make Variables:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="n">genrule</span><span class="p">(</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="s">'$(STRIP) file-to-be-stripped.o'</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">genrule</span><span class="p">(</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="s">'$(STRIP) file-to-be-stripped.o'</span><span class="p">,</span>
  <span class="n">toolchains</span> <span class="o">=</span> <span class="p">[</span><span class="s">'@bazel_tools//tools/cpp:current_cc_toolchain'</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p>For Starlark rules using C++ Make Variables:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
  <span class="n">strip</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="nb">vars</span><span class="p">[</span><span class="s">'STRIP'</span><span class="p">]</span>
  <span class="o">...</span>

<span class="n">my_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
  <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
  <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">},</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
  <span class="n">strip</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="nb">vars</span><span class="p">[</span><span class="s">'STRIP'</span><span class="p">]</span>
  <span class="o">...</span>

<span class="n">my_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
  <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
  <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'_toolchains'</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label_list</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="p">[</span><span class="n">Label</span><span class="p">(</span><span class="s">'@bazel_tools//tools/cpp:current_cc_toolchain'</span><span class="p">)]),</span>
  <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>
<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_cc_configuration_make_variables</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.18.0</code></li>
</ul>

<h3 id="disable-legacy-c-configuration-api">Disable legacy C++ configuration API</h3>

<p>This turns off legacy Starlark access to cc toolchain information via the
<code class="highlighter-rouge">ctx.fragments.cpp</code> fragment. Instead of declaring dependency on the <code class="highlighter-rouge">ctx.fragments.cpp</code> using the
<code class="highlighter-rouge">fragments</code> attribute declare a dependency on the <code class="highlighter-rouge">@bazel_tools//tools/cpp:current_cc_toolchain</code>
via implicit attribute named <code class="highlighter-rouge">_cc_toolchain</code> (see example below). Use <code class="highlighter-rouge">find_cpp_toolchain</code> from
<code class="highlighter-rouge">@bazel_tools//tools/cpp:toolchain_utils.bzl</code> to get the current C++ toolchain in the rule
  implementation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">ctx</span><span class="o">.</span><span class="n">fragments</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">compiler_options</span><span class="p">()</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">fragments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"cpp"</span><span class="p">],</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="c"># After</span>
<span class="n">load</span><span class="p">(</span><span class="s">"@bazel_tools//tools/cpp:toolchain_utils.bzl"</span><span class="p">,</span> <span class="s">"find_cpp_toolchain"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">find_cpp_toolchain</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
  <span class="n">cc_toolchain</span><span class="o">.</span><span class="n">compiler_options</span><span class="p">()</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span>
    <span class="n">implementation</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">,</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"_cc_toolchain"</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">Label</span><span class="p">(</span><span class="s">"@bazel_tools//tools/cpp:current_cc_toolchain"</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<p>List of all legacy fields and their corresponding <code class="highlighter-rouge">cc_toolchain</code> alternative:</p>

<table>
  <thead>
    <tr>
      <th><code class="highlighter-rouge">ctx.fragments.cpp</code></th>
      <th><code class="highlighter-rouge">cc_toolchain</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">ar_executable</code></td>
      <td><code class="highlighter-rouge">ar_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">built_in_include_directories</code></td>
      <td><code class="highlighter-rouge">built_in_include_directories</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">c_options</code></td>
      <td><code class="highlighter-rouge">c_options()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">compiler</code></td>
      <td><code class="highlighter-rouge">compiler</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">compiler_executable</code></td>
      <td><code class="highlighter-rouge">compiler_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">compiler_options(unused_arg)</code></td>
      <td><code class="highlighter-rouge">compiler_options()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cpu</code></td>
      <td><code class="highlighter-rouge">cpu</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cxx_options(unused_arg)</code></td>
      <td><code class="highlighter-rouge">cxx_options()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">dynamic_link_options(unused_arg, bool)</code></td>
      <td><code class="highlighter-rouge">dynamic_link_options(bool)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">fully_static_link_options(unused_arg, True)</code></td>
      <td><code class="highlighter-rouge">fully_static_link_options(True)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ld_executable</code></td>
      <td><code class="highlighter-rouge">ld_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">link_options</code></td>
      <td><code class="highlighter-rouge">link_options_do_not_use</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">mostly_static_link_options(unused_arg, bool)</code></td>
      <td><code class="highlighter-rouge">mostly_static_link_options(bool)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nm_executable</code></td>
      <td><code class="highlighter-rouge">nm_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">objcopy_executable</code></td>
      <td><code class="highlighter-rouge">objcopy_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">objdump_executable</code></td>
      <td><code class="highlighter-rouge">objdump_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">preprocessor_executable</code></td>
      <td><code class="highlighter-rouge">preprocessor_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">strip_executable</code></td>
      <td><code class="highlighter-rouge">strip_executable()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">sysroot</code></td>
      <td><code class="highlighter-rouge">sysroot</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">target_gnu_system_name</code></td>
      <td><code class="highlighter-rouge">target_gnu_system_name</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">unfiltered_compiler_options(unused_arg)</code></td>
      <td><code class="highlighter-rouge">unfiltered_compiler_options(unused_arg)</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_legacy_cpp_toolchain_skylark_api</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.18.0</code></li>
</ul>

<h3 id="disable-legacy-c-toolchain-api">Disable legacy C++ toolchain API</h3>

<p>We have deprecated the <code class="highlighter-rouge">cc_toolchain</code> Starlark API returning legacy CROSSTOOL fields:</p>

<ul>
  <li>ar_executable</li>
  <li>c_options</li>
  <li>compiler_executable</li>
  <li>compiler_options</li>
  <li>cxx_options</li>
  <li>dynamic_link_options</li>
  <li>fully_static_link_options</li>
  <li>ld_executable</li>
  <li>link_options</li>
  <li>mostly_static_link_options</li>
  <li>nm_executable</li>
  <li>objcopy_executable</li>
  <li>objdump_executable</li>
  <li>preprocessor_executable</li>
  <li>strip_executable</li>
  <li>unfiltered_compiler_options</li>
</ul>

<p>Use the new API from <a href="https://docs.bazel.build/versions/master/skylark/lib/cc_common.html">cc_common</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before:</span>
<span class="n">load</span><span class="p">(</span><span class="s">"@bazel_tools//tools/cpp:toolchain_utils.bzl"</span><span class="p">,</span> <span class="s">"find_cpp_toolchain"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">find_cc_toolchain</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">compiler_options</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cc_toolchain</span><span class="o">.</span><span class="n">compiler_options</span><span class="p">()</span> <span class="o">+</span>
        <span class="n">cc_toolchain</span><span class="o">.</span><span class="n">unfiltered_compiler_options</span><span class="p">([])</span> <span class="o">+</span>
        <span class="p">[</span><span class="s">"-w"</span><span class="p">,</span> <span class="s">"-Wno-error"</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">link_options</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="s">"-shared"</span><span class="p">,</span> <span class="s">"-static-libgcc"</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">cc_toolchain</span><span class="o">.</span><span class="n">mostly_static_link_options</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">[</span><span class="s">"-Wl,-whole-archive"</span><span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="s">"-Wl,-no-whole-archive"</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">cc_toolchain</span><span class="o">.</span><span class="n">link_options_do_not_use</span>
    <span class="p">)</span>

<span class="c"># After</span>
<span class="n">load</span><span class="p">(</span><span class="s">"@bazel_tools//tools/cpp:toolchain_utils.bzl"</span><span class="p">,</span> <span class="s">"find_cpp_toolchain"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span>
    <span class="s">"@bazel_tools//tools/build_defs/cc:action_names.bzl"</span><span class="p">,</span>
    <span class="s">"CPP_LINK_DYNAMIC_LIBRARY_ACTION_NAME"</span><span class="p">,</span>
    <span class="s">"C_COMPILE_ACTION_NAME"</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_impl</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">find_cc_toolchain</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">feature_configuration</span> <span class="o">=</span> <span class="n">cc_common</span><span class="o">.</span><span class="n">configure_features</span><span class="p">(</span>
        <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">cc_toolchain</span><span class="p">,</span>
        <span class="n">requested_features</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
        <span class="n">unsupported_features</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">disabled_features</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">compile_variables</span> <span class="o">=</span> <span class="n">cc_common</span><span class="o">.</span><span class="n">create_compile_variables</span><span class="p">(</span>
        <span class="n">feature_configuration</span> <span class="o">=</span> <span class="n">feature_configuration</span><span class="p">,</span>
        <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">cc_toolchain</span><span class="p">,</span>
        <span class="n">user_compile_flags</span> <span class="o">=</span> <span class="n">depset</span><span class="p">([</span><span class="s">"-w"</span><span class="p">,</span> <span class="s">"-Wno-error"</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">compiler_options</span> <span class="o">=</span> <span class="n">cc_common</span><span class="o">.</span><span class="n">get_memory_inefficient_command_line</span><span class="p">(</span>
        <span class="n">feature_configuration</span> <span class="o">=</span> <span class="n">feature_configuration</span><span class="p">,</span>
        <span class="n">action_name</span> <span class="o">=</span> <span class="n">C_COMPILE_ACTION_NAME</span><span class="p">,</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">compile_variables</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">link_variables</span> <span class="o">=</span> <span class="n">cc_common</span><span class="o">.</span><span class="n">create_link_variables</span><span class="p">(</span>
        <span class="n">feature_configuration</span> <span class="o">=</span> <span class="n">feature_configuration</span><span class="p">,</span>
        <span class="n">cc_toolchain</span> <span class="o">=</span> <span class="n">cc_toolchain</span><span class="p">,</span>
        <span class="n">is_linking_dynamic_library</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">user_link_flags</span> <span class="o">=</span>
            <span class="p">[</span><span class="s">"-static-libgcc"</span><span class="p">]</span> <span class="o">+</span>
            <span class="p">[</span><span class="s">"-Wl,-whole-archive"</span><span class="p">]</span> <span class="o">+</span>
            <span class="p">[</span><span class="n">lib</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">]</span> <span class="o">+</span>
            <span class="p">[</span><span class="s">"-Wl,-no-whole-archive"</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">link_flags</span> <span class="o">=</span> <span class="n">cc_common</span><span class="o">.</span><span class="n">get_memory_inefficient_command_line</span><span class="p">(</span>
        <span class="n">feature_configuration</span> <span class="o">=</span> <span class="n">feature_configuration</span><span class="p">,</span>
        <span class="n">action_name</span> <span class="o">=</span> <span class="n">CPP_LINK_DYNAMIC_LIBRARY_ACTION_NAME</span><span class="p">,</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">link_variables</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Flag: <code class="highlighter-rouge">--incompatible_disable_legacy_flags_cc_toolchain_api</code></li>
  <li>Default: <code class="highlighter-rouge">false</code></li>
  <li>Introduced in: <code class="highlighter-rouge">0.19.0</code></li>
</ul>

<!-- Add new options here -->

        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=oohdpic4fyfp3jcnym6aqkdf3e"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2018 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

