<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Using the Android Native Development Kit with Bazel - Bazel</title>

    <link rel="canonical" href="/versions/0.19.1/android-ndk.html">

    <!-- Webfont -->
    <link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700|Source+Code+Pro:400,500,700" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/images/favicon.ico">

    <!-- Bootstrap -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <!-- metadata -->
    <meta name="og:title" content="Using the Android Native Development Kit with Bazel"/>
    <meta name="og:image" content="/images/bazel-og-image.png"/>

    <!-- google search console verification -->
    <meta name="google-site-verification" content="ftWLOiP2hnDW4Cw3LUGEaXU83RVIpiyxwaXFFhoakzs" />
  </head>

  <body>
        <nav id="common-nav" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.bazel.build/">
            <img class="navbar-logo" src="/images/bazel-navbar.svg">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
          </ul>
          <form class="navbar-form navbar-right" action="/search.html" id="cse-search-box">
            <div class="form-group">
              <input type="hidden" name="cx" value="012346921571893344015:xv_nfgpzbu4">
              <input type="hidden" name="cof" value="FORID:10">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="search" name="q" class="form-control input-sm" placeholder="Search">
            </div>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/">Documentation</a>
            </li>
            <li>
              <a href="https://www.bazel.build/contributing.html">Contribute</a>
            </li>
            <li>
              <a href="https://blog.bazel.build">Blog</a>
            </li>
            <li><a href="https://twitter.com/bazelbuild" class="nav-icon"><i class="fa fa-twitter"></i></a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/bazel" class="nav-icon"><i class="fa fa-stack-overflow"></i></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="page-title-bar">
      <div class="container">
        <h1>Documentation</h1>
      </div>
    </div>

    <div class="container vpad">
      <div class="row">
        <div class="col-md-3">
          <a class="btn btn-default btn-lg btn-block sidebar-toggle"
              data-toggle="collapse" href="#sidebar-nav" aria-expanded="false"
              aria-controls="sidebar-nav">
            <i class="glyphicon glyphicon-menu-hamburger"></i> Navigation
          </a>
          <nav class="sidebar collapse" id="sidebar-nav">
           <h3>Home</h3>
            <ul class="sidebar-nav">
              <li><a href="/versions/master/bazel-overview.html">Bazel Overview</a></li>
              <li><a href="/versions/master/bazel-vision.html">Bazel Vision</a></li>
              <li><a href="/versions/master/getting-started.html">Getting Started</a></li>
              <li><a href="/versions/master/skylark/backward-compatibility.html">Backward Compatibility</a></li>
            </ul>

           <h3>Using Bazel</h3>
            <ul class="sidebar-nav">

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#installing-menu" aria-expanded="false"
                    aria-controls="installing-menu">
                  Installing Bazel<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="installing-menu">
                   <li><a href="/versions/master/install.html">Installation Overview</a></li>
                   <li><a href="/versions/master/install-ubuntu.html">Installing on Ubuntu</a></li>
                   <li><a href="/versions/master/install-redhat.html">Installing on Fedora/CentOS</a></li>
                   <li><a href="/versions/master/install-os-x.html">Installing on macOS</a></li>
                   <li><a href="/versions/master/install-windows.html">Installing on Windows</a></li>
                   <li><a href="/versions/master/install-compile-source.html">Compiling from Source</a></li>
                   <li><a href="/versions/master/completion.html">Command-Line Completion</a></li>
                   <li><a href="/versions/master/ide.html">Integrating with IDEs</a></li>
                 </ul>
                </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#tutorials-menu" aria-expanded="false"
                    aria-controls="tutorials-menu">
                  Tutorials<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="tutorials-menu">
                   <li><a href="/versions/master/tutorial/java.html">Building a Java Project</a></li>
                   <li><a href="/versions/master/tutorial/cpp.html">Building a C++ Project</a></li>
                   <li><a href="/versions/master/tutorial/android-app.html">Building an Android App</a></li>
                   <li><a href="/versions/master/tutorial/ios-app.html">Building an iOS App</a></li>
                   <li><a href="/versions/master/skylark/tutorial-sharing-variables.html">Sharing Variables</a></li>
                   <li><a href="/versions/master/skylark/tutorial-creating-a-macro.html">Creating a Macro</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/build-ref.html">Bazel Concepts</a></li>
              <li><a href="/versions/master/guide.html">User's Guide</a></li>
              <li><a href="/versions/master/external.html">External Dependencies</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#query-menu" aria-expanded="false"
                    aria-controls="query-menu">
                  Queries<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="query-menu">
                  <li><a href="/versions/master/query-how-to.html">Bazel query</a></li>
                  <li><a href="/versions/master/cquery.html">Bazel cquery</a></li>
                  <li><a href="/versions/master/user-manual.html#aquery">Bazel aquery</a></li>
                  <li><a href="/versions/master/query.html">Query Language</a></li>
                </ul>
              </li>

              <li><a href="/versions/master/configurable-attributes.html">Configurable Attributes</a></li>
              <li><a href="/versions/master/best-practices.html">Best Practices</a></li>
              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#remote-execution-menu" aria-expanded="false"
                    aria-controls="remote-execution-menu">
                  Remote Execution<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="remote-execution-menu">
                   <li><a href="/versions/master/remote-execution.html">Remote Execution Overview</a></li>
                   <li><a href="/versions/master/remote-execution-rules.html">Guidelines for Remote Execution</a></li>
                   <li>
                      <a class="sidebar-nav-heading" data-toggle="collapse"
                          href="#troubleshoot-remote-execution-menu" aria-expanded="false"
                          aria-controls="troubleshoot-remote-execution-menu">
                        Troubleshooting Remote Execution<span class="caret"></span>
                      </a>
                      <ul class="collapse sidebar-nav sidebar-submenu" id="troubleshoot-remote-execution-menu">
                         <li><a href="/versions/master/remote-execution-sandbox.html">Troubleshooting Remote Execution with Bazel Sandbox</a></li>
                         <li><a href="/versions/master/workspace-log.html">Finding non-hermetic behavior in WORKSPACE rules</a></li>
                      </ul>
                  </li>
                   <li><a href="/versions/master/remote-execution-ci.html">Configuring Bazel CI for Remote Execution Rule Testing</a></li>
                 </ul>
              </li>

              <li><a href="/versions/master/remote-caching.html">Remote Caching</a></li>
             </ul>

           <h3>Rules</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/be/overview.html">Build Encyclopedia</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#android-menu" aria-expanded="false"
                    aria-controls="android-menu">
                  Android<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="android-menu">
                  <li><a href="/versions/master/bazel-and-android.html">Android Resources</a></li>
                  <li><a href="/versions/master/mobile-install.html">Using mobile-install</a></li>
                  <li><a href="/versions/master/android-instrumentation-test.html">Android Instrumentation Tests</a></li>
                  <li><a href="/versions/master/android-ndk.html">Android NDK</a></li>
                  <li><a href="https://plugins.jetbrains.com/plugin/9185-bazel">Android Studio Plugin</a></li>
                </ul>
              </li>

               <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#apple-menu" aria-expanded="false"
                    aria-controls="apple-menu">
                  Apple<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="apple-menu">
                  <li><a href="/versions/master/bazel-and-apple.html">Apple Resources</a></li>
                  <li><a href="/versions/master/migrate-xcode.html">Migrating from Xcode</a></li>
                  <li><a href="/versions/master/migrate-cocoapods.html">Converting CocoaPods</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#cpp-menu" aria-expanded="false"
                    aria-controls="cpp-menu">
                  C++<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="cpp-menu">
                  <li><a href="/versions/master/bazel-and-cpp.html">C++ Resources</a></li>
                  <li><a href="/versions/master/cpp-use-cases.html">C++ Use Cases</a></li>
                  <li><a href="/versions/master/crosstool-reference.html">Understanding CROSSTOOL</a></li>
                  <li><a href="/versions/master/tutorial/crosstool.html">Tutorial: CROSSTOOL</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#java-menu" aria-expanded="false"
                    aria-controls="java-menu">
                  Java<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="java-menu">
                  <li><a href="/versions/master/bazel-and-java.html">Java Resources</a></li>
                  <li><a href="/versions/master/migrate-maven.html">Migrating from Maven</a></li>
                  <li><a href="/versions/master/generate-workspace.html">Converting Maven Dependencies</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#javascript-menu" aria-expanded="false"
                    aria-controls="javascript-menu">
                  JavaScript<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="javascript-menu">
                  <li><a href="/versions/master/bazel-and-javascript.html">JavaScript Resources</a></li>
                  <li><a href="/versions/master/build-javascript.html">Building JavaScript</a></li>
                </ul>
              </li>

           </ul>

           <h3>Reference</h3>
           <ul class="sidebar-nav">
             <li><a href="/versions/master/user-manual.html">Commands and Options</a></li>
             <li><a href="/versions/master/skylark/build-style.html">BUILD Style Guide</a></li>
             <li><a href="/versions/master/command-line-reference.html">Command Line Reference</a></li>
             <li><a href="/versions/master/test-encyclopedia.html">Writing Tests</a></li>
             <li><a href="/versions/master/build-event-protocol.html">Build Event Protocol</a></li>
             <li><a href="/versions/master/output_directories.html">Output Directory Layout</a></li>
             <li><a href="/versions/master/platforms.html">Platforms</a></li>
             <li><a href="/versions/master/toolchains.html">Toolchains</a></li>
           </ul>

            <h3>Extending Bazel</h3>
           <ul class="sidebar-nav">
              <li><a href="/versions/master/skylark/concepts.html">Extension Overview</a></li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-concepts" aria-expanded="false"
                    aria-controls="starlark-concepts">
                  Concepts<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-concepts">
                  <li><a href="/versions/master/skylark/macros.html">Macros</a></li>
                  <li><a href="/versions/master/skylark/rules.html">Rules</a></li>
                  <li><a href="/versions/master/skylark/depsets.html">Depsets</a></li>
                  <li><a href="/versions/master/skylark/aspects.html">Aspects</a></li>
                  <li><a href="/versions/master/skylark/repository_rules.html">Repository Rules</a></li>
                  <li><a href="/versions/master/skylark/faq.html">FAQ</a></li>
                </ul>
              </li>

              <li>
                <a class="sidebar-nav-heading" data-toggle="collapse"
                    href="#starlark-practices" aria-expanded="false"
                    aria-controls="starlark-practices">
                  Best Practices<span class="caret"></span>
                </a>
                <ul class="collapse sidebar-nav sidebar-submenu" id="starlark-practices">
                  <li><a href="/versions/master/skylark/bzl-style.html">.bzl Style Guide</a></li>
                  <li><a href="/versions/master/skylark/testing.html">Testing</a></li>
                  <li><a href="https://skydoc.bazel.build" target="_blank">Documenting Rules</a></li>
                  <li><a href="/versions/master/skylark/skylint.html">Linter</a></li>
                  <li><a href="/versions/master/skylark/performance.html">Optimizing Performance</a></li>
                  <li><a href="/versions/master/skylark/deploying.html">Deploying Rules</a></li>
                </ul>
              </li>

              <li><a href="https://github.com/bazelbuild/examples/tree/master/rules">Examples</a></li>
              <li><a href="/versions/master/skylark/lib/skylark-overview.html">API Reference</a></li>
              <li><a href="/versions/master/skylark/language.html">Starlark Language</a></li>
            </ul>
          </nav>
        </div>

        <div class="col-md-9">
          <a id="gh-edit" class="gh-edit default-hidden"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a>
          <script>
            var versionDocsURLRegex = /\/versions\/[\w\.]+\/(.*)/;
            var ghDocsBazeURL = 'https://github.com/bazelbuild/bazel/tree/master/site/docs/';
            var editButton = document.getElementById('gh-edit');
            // if there is an edit button and we are not in the Build Encyclopedia
            if (editButton
                && window.location.pathname.match(versionDocsURLRegex)
                && window.location.pathname.lastIndexOf('/be/') == -1
                && window.location.pathname.lastIndexOf('/skylark/lib/') == -1) {
              var docFile = window.location.pathname.match(versionDocsURLRegex)[1];
              // some pages are not using markdown :(
              if (docFile !== 'user-manual.html'
                  && docFile !== 'build-ref.html'
                  && docFile !== 'query.html'
                  && docFile !== 'test-encyclopedia.html') {
                docFile = docFile.replace('html', 'md');
              }
              editButton.href = ghDocsBazeURL + docFile;
              editButton.style.visibility = 'visible';
            }
          </script>

          <!-- /versions/master/foo/bar -> ["master", "foo", "bar"] -->
          <!-- /versions/0.12.3/baz.md -> ["0.12.3", "baz.md"] -->
          

          <p>Documentation for Bazel 0.19.1</p>
          <select id="touchsplashmenu" onchange="location.href=this.value">
              <option value="">Choose a Bazel version</option>
              
              <option value="/versions/master/android-ndk.html">master</option>
              
              <option value="/versions/0.19.2/android-ndk.html">0.19.2</option>
              
              <option value="/versions/0.19.1/android-ndk.html">0.19.1</option>
              
              <option value="/versions/0.18.1/android-ndk.html">0.18.1</option>
              
              <option value="/versions/0.17.2/android-ndk.html">0.17.2</option>
              
              <option value="/versions/0.17.1/android-ndk.html">0.17.1</option>
              
          </select>

          <h1 id="using-the-android-native-development-kit-with-bazel">Using the Android Native Development Kit with Bazel</h1>

<p><em>If you’re new to Bazel, please start with the <a href="https://docs.bazel.build/versions/master/tutorial/android-app.html">Building Android with
Bazel</a>
tutorial.</em></p>

<h2 id="table-of-contents">Table of contents</h2>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#quick-start">Quick start</a></li>
  <li><a href="#example-setup">Example setup</a></li>
  <li><a href="#configuring-the-stl">Configuring the STL</a></li>
  <li><a href="#configuring-the-target-abi">Configuring the target ABI</a></li>
  <li><a href="#selecting-a-c-standard">Selecting a C++ standard</a></li>
  <li><a href="#how-it-works-introducing-android-configuration-transitions">How it works: introducing Android configuration transitions</a></li>
  <li><a href="#building-a-cc_library-for-android-without-using-android_binary">Building a <code class="highlighter-rouge">cc_library</code> for Android without using <code class="highlighter-rouge">android_binary</code></a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>Bazel can run in many different build configurations, including several that use
the Android Native Development Kit (NDK) toolchain. This means that normal
<code class="highlighter-rouge">cc_library</code> and <code class="highlighter-rouge">cc_binary</code> rules can be compiled for Android directly within
Bazel. Bazel accomplishes this by using the <code class="highlighter-rouge">android_ndk_repository</code> repository
rule.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Please ensure that you have installed the Android SDK and NDK.</p>

<p>To set up the SDK and NDK, add the following snippet to your <code class="highlighter-rouge">WORKSPACE</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">android_sdk_repository</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"androidsdk"</span><span class="p">,</span> <span class="c"># Required. Name *must* be "androidsdk".</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">"/path/to/sdk"</span><span class="p">,</span> <span class="c"># Optional. Can be omitted if `ANDROID_HOME` environment variable is set.</span>
<span class="p">)</span>

<span class="n">android_ndk_repository</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"androidndk"</span><span class="p">,</span> <span class="c"># Required. Name *must* be "androidndk".</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">"/path/to/ndk"</span><span class="p">,</span> <span class="c"># Optional. Can be omitted if `ANDROID_NDK_HOME` environment variable is set.</span>
<span class="p">)</span>
</code></pre></div></div>

<p>For more information on the <code class="highlighter-rouge">android_ndk_repository</code> rule, see its the <a href="https://docs.bazel.build/versions/master/be/android.html#android_ndk_repository">Build
Encyclopedia
entry</a>.</p>

<h2 id="quick-start">Quick start</h2>

<p>To build C++ for Android, simply add <code class="highlighter-rouge">cc_library</code> dependencies to your
<code class="highlighter-rouge">android_binary</code> or <code class="highlighter-rouge">android_library</code> rules.</p>

<p>For example, given the following BUILD file for an Android app:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In &lt;project&gt;/app/src/main/BUILD.bazel</span>

<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"jni_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"cpp/native-lib.cpp"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">android_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"java/com/example/android/bazel/MainActivity.java"</span><span class="p">],</span>
    <span class="n">resource_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">([</span><span class="s">"res/**/*"</span><span class="p">]),</span>
    <span class="n">custom_package</span> <span class="o">=</span> <span class="s">"com.example.android.bazel"</span><span class="p">,</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="s">"LibraryManifest.xml"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">":jni_lib"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">android_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"app"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s">":lib"</span><span class="p">],</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="s">"AndroidManifest.xml"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This BUILD file results in the following target graph:</p>

<p><img src="/assets/android_ndk.png" alt="Build graph of Android project with cc_library dependencies" width="600px" /></p>

<p>To build the app, simply run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bazel build //app/src/main:app

</code></pre></div></div>

<p>The <code class="highlighter-rouge">bazel build</code> command compiles the Java files, Android resource files, and
<code class="highlighter-rouge">cc_library</code> rules, and packages everything into an APK:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zipinfo -1 bazel-bin/app/src/main/app.apk
nativedeps
lib/armeabi-v7a/libapp.so
classes.dex
AndroidManifest.xml
...
res/...
...
META-INF/CERT.SF
META-INF/CERT.RSA
META-INF/MANIFEST.MF
</code></pre></div></div>

<p>Bazel compiles all of the cc_libraries into a single shared object (<code class="highlighter-rouge">.so</code>) file,
targeted for the <code class="highlighter-rouge">armeabi-v7a</code> ABI by default. To change this or build for
multiple ABIs at the same time, see the section on <a href="#configuring-the-target-abi">configuring the target
ABI</a>.</p>

<h2 id="example-setup">Example setup</h2>

<p>This example is available in the <a href="https://github.com/bazelbuild/examples/tree/master/android-ndk">Bazel examples
repository</a>.</p>

<p>In the <code class="highlighter-rouge">BUILD.bazel</code> file, we define three targets with the <code class="highlighter-rouge">android_binary</code>,
<code class="highlighter-rouge">android_library</code> and <code class="highlighter-rouge">cc_library</code> rules.</p>

<p>The <code class="highlighter-rouge">android_binary</code> top-level target builds the APK.</p>

<p>The <code class="highlighter-rouge">cc_library</code> target contains a single C++ source file with a JNI function
implementation:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;jni.h&gt;
#include &lt;string&gt;
</span>
<span class="k">extern</span> <span class="s">"C"</span>
<span class="n">JNIEXPORT</span> <span class="n">jstring</span>

<span class="n">JNICALL</span>
<span class="n">Java_com_example_android_bazel_MainActivity_stringFromJNI</span><span class="p">(</span>
        <span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span>
        <span class="n">jobject</span> <span class="cm">/* this */</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">hello</span> <span class="o">=</span> <span class="s">"Hello from C++"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">hello</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">android_library</code> target specifies the Java sources, resource files, and the
dependency on a <code class="highlighter-rouge">cc_library</code> target. For this example, <code class="highlighter-rouge">MainActivity.java</code> loads
the shared object file <code class="highlighter-rouge">libapp.so</code>, and defines the method signature for the JNI
function:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"app"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span> <span class="nf">stringFromJNI</span><span class="o">();</span>

<span class="o">}</span>
</code></pre></div></div>

<p><strong>Note</strong>: The name of the native library is derived from the name of the top
level <code class="highlighter-rouge">android_binary</code> target. In this example, it is <code class="highlighter-rouge">app</code>.</p>

<h2 id="configuring-the-stl">Configuring the STL</h2>

<p>To configure the C++ STL, use the flag <code class="highlighter-rouge">--android_crosstool_top</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //:app --android_crosstool_top=&lt;target label&gt;
</code></pre></div></div>

<p>The available STLs in <code class="highlighter-rouge">@androidndk</code> are:</p>

<table>
  <thead>
    <tr>
      <th>STL</th>
      <th>Target label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>STLport</td>
      <td><code class="highlighter-rouge">@androidndk//:toolchain-stlport</code></td>
    </tr>
    <tr>
      <td>libc++</td>
      <td><code class="highlighter-rouge">@androidndk//:toolchain-libcpp</code></td>
    </tr>
    <tr>
      <td>gnustl</td>
      <td><code class="highlighter-rouge">@androidndk//:toolchain-gnu-libstdcpp</code></td>
    </tr>
  </tbody>
</table>

<p>For r16 and below, the default STL is <code class="highlighter-rouge">gnustl</code>. For r17 and above, it is
<code class="highlighter-rouge">libc++</code>. For convenience, the target <code class="highlighter-rouge">@androidndk//:default_crosstool</code> is
aliased to the respective default STLs.</p>

<p>Please note that from r18 onwards, <a href="https://android.googlesource.com/platform/ndk/+/master/docs/Roadmap.html#ndk-r18">STLport and gnustl will be
removed</a>,
making <code class="highlighter-rouge">libc++</code> the only STL in the NDK.</p>

<p>See the <a href="https://developer.android.com/ndk/guides/cpp-support">NDK
documentation</a> for more
information on these STLs.</p>

<h2 id="configuring-the-target-abi">Configuring the target ABI</h2>

<p>To configure the target ABI, use the <code class="highlighter-rouge">--fat_apk_cpu</code> flag as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //:app --fat_apk_cpu=&lt;comma-separated list of ABIs&gt;
</code></pre></div></div>

<p>By default, Bazel builds native Android code for <code class="highlighter-rouge">armeabi-v7a</code>. To build for x86
(e.g. for emulators), pass <code class="highlighter-rouge">--fat_apk_cpu=x86</code>. To create a fat APK for multiple
architectures, you can specify multiple CPUs: <code class="highlighter-rouge">--fat_apk_cpu=armeabi-v7a,x86</code>.</p>

<p>If more than one ABI is specified, Bazel will build an APK containing a shared
object for each ABI.</p>

<p>Depending on the NDK revision and Android API level, the following ABIs are
available:</p>

<table>
  <thead>
    <tr>
      <th>NDK revision</th>
      <th>ABIs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>16 and lower</td>
      <td>armeabi, armeabi-v7a, arm64-v8a, mips, mips64, x86, x86_64</td>
    </tr>
    <tr>
      <td>17 and above</td>
      <td>armeabi-v7a, arm64-v8a, x86, x86_64</td>
    </tr>
  </tbody>
</table>

<p>See <a href="https://developer.android.com/ndk/guides/abis.html">the NDK docs</a> for more
information on these ABIs.</p>

<p>Multi-ABI Fat APKs are not recommended for release builds since they increase
the size of the APK, but can be useful for development and QA builds.</p>

<h2 id="selecting-a-c-standard">Selecting a C++ standard</h2>

<p>Use the following flags to build according to a C++ standard:</p>

<table>
  <thead>
    <tr>
      <th>C++ Standard</th>
      <th>Flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>C++98</td>
      <td>Default, no flag needed</td>
    </tr>
    <tr>
      <td>C++11</td>
      <td><code class="highlighter-rouge">--cxxopt=-std=c++11</code></td>
    </tr>
    <tr>
      <td>C++14</td>
      <td><code class="highlighter-rouge">--cxxopt=-std=c++14</code></td>
    </tr>
  </tbody>
</table>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //:app --cxxopt=-std=c++11
</code></pre></div></div>

<p>Read more about passing compiler and linker flags with <code class="highlighter-rouge">--cxxopt</code>, <code class="highlighter-rouge">--copt</code>, and
<code class="highlighter-rouge">--linkopt</code> in the <a href="https://docs.bazel.build/versions/master/user-manual.html#flag--cxxopt">User
Manual</a>.</p>

<p>Compiler and linker flags can also be specified as attributes in <code class="highlighter-rouge">cc_library</code>
using <code class="highlighter-rouge">copts</code> and <code class="highlighter-rouge">linkopts</code>. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"jni_lib"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s">"cpp/native-lib.cpp"</span><span class="p">],</span>
    <span class="n">copts</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-std=c++11"</span><span class="p">],</span>
    <span class="n">linkopts</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-ldl"</span><span class="p">],</span> <span class="c"># link against libdl</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="how-it-works-introducing-android-configuration-transitions">How it works: introducing Android configuration transitions</h2>

<p>The <code class="highlighter-rouge">android_binary</code> rule can explicitly ask Bazel to build its dependencies in
an Android-compatible configuration so that the Bazel build <em>just works</em> without
any special flags, except for <code class="highlighter-rouge">--fat_apk_cpu</code> and <code class="highlighter-rouge">--android_crosstool_top</code> for
ABI and STL configuration.</p>

<p>Behind the scenes, this automatic configuration uses Android <a href="https://docs.bazel.build/versions/master/skylark/rules.html#configurations">configuration
transitions</a>.</p>

<p>A compatible rule, like <code class="highlighter-rouge">android_binary</code>, automatically changes the
configuration of its dependencies to an Android configuration, so only
Android-specific subtrees of the build are affected. Other parts of the build
graph are processed using the top-level target configuration. It may even
process a single target in both configurations, if there are paths through the
build graph to support that.</p>

<p>Once Bazel is in an Android-compatible configuration, either specified at the
top level or due to a higher-level transition point, additional transition
points encountered do not further modify the configuration.</p>

<p>The only built-in location that triggers the transition to the Android
configuration is <code class="highlighter-rouge">android_binary</code>’s <code class="highlighter-rouge">deps</code> attribute.</p>

<p><strong>Note:</strong> The <code class="highlighter-rouge">data</code> attribute of <code class="highlighter-rouge">android_binary</code> intentionally does <em>not</em>
trigger the transition. Additionally, <code class="highlighter-rouge">android_local_test</code> and <code class="highlighter-rouge">android_library</code>
intentionally do <em>not</em> trigger the transition at all.</p>

<p>For example, if you try to build an <code class="highlighter-rouge">android_library</code> target with a <code class="highlighter-rouge">cc_library</code>
dependency without any flags, you may encounter an error about a missing JNI
header:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: &lt;project&gt;/app/src/main/BUILD.bazel:16:1: C++ compilation of rule '//app/src/main:jni_lib' failed (Exit 1)
app/src/main/cpp/native-lib.cpp:1:10: fatal error: 'jni.h' file not found
#include &lt;jni.h&gt;
         ^~~~~~~
1 error generated.
Target //app/src/main:lib failed to build
Use --verbose_failures to see the command lines of failed build steps.
</code></pre></div></div>

<p>Ideally, these automatic transitions should make Bazel do the right thing in the
majority of cases. However, if the target on the Bazel command-line is already
below any of these transition rules, such as C++ developers testing a specific
<code class="highlighter-rouge">cc_library</code>, then a custom <code class="highlighter-rouge">--crosstool_top</code> must be used.</p>

<h2 id="building-a-cc_library-for-android-without-using-android_binary">Building a <code class="highlighter-rouge">cc_library</code> for Android without using <code class="highlighter-rouge">android_binary</code></h2>

<p>To build a standalone <code class="highlighter-rouge">cc_binary</code> or <code class="highlighter-rouge">cc_library</code> for Android without using an
<code class="highlighter-rouge">android_binary</code>, use the <code class="highlighter-rouge">--crosstool_top</code>, <code class="highlighter-rouge">--cpu</code> and <code class="highlighter-rouge">--host_crosstool_top</code>
flags.</p>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my/cc/jni:target \
      --crosstool_top=@androidndk//:default_crosstool \
      --cpu=&lt;abi&gt; \
      --host_crosstool_top=@bazel_tools//tools/cpp:toolchain
</code></pre></div></div>

<p>Here, we specify that top-level <code class="highlighter-rouge">cc_library</code> and <code class="highlighter-rouge">cc_binary</code> targets are built
using the NDK toolchain. However, this causes Bazel’s own host tools to be built
with the NDK toolchain (and thus for Android), because the host toolchain is
copied from the target toolchain. To work around this, we specify the value of
<code class="highlighter-rouge">--host_crosstool_top</code> to be <code class="highlighter-rouge">@bazel_tools//tools/cpp:toolchain</code> to explicitly
set the host’s C++ toolchain.</p>

<p>With this approach, the entire build tree is affected.</p>

<p>Note that all of the targets on the command line must be compatible with
building for Android when specifying these flags, which may make it difficult to
use <a href="https://docs.bazel.build/versions/master/command-line-reference.html#target-pattern-syntax">Bazel
wild-cards</a>
like <code class="highlighter-rouge">/...</code> and <code class="highlighter-rouge">:all</code>.</p>

<p>These flags can be put into a <code class="highlighter-rouge">bazelrc</code> config (one for each ABI), in
<code class="highlighter-rouge">&lt;project&gt;/.bazelrc</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>common:android_x86 --crosstool_top=@androidndk//:default_crosstool
common:android_x86 --cpu=x86
common:android_x86 --host_crosstool_top=@bazel_tools//tools/cpp:toolchain

common:android_armeabi-v7a --crosstool_top=@androidndk//:default_crosstool
common:android_armeabi-v7a --cpu=armeabi-v7a
common:android_armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain

# In general
common:android_&lt;abi&gt; --crosstool_top=@androidndk//:default_crosstool
common:android_&lt;abi&gt; --cpu=&lt;abi&gt;
common:android_&lt;abi&gt; --host_crosstool_top=@bazel_tools//tools/cpp:toolchain
</code></pre></div></div>

<p>Then, to build a <code class="highlighter-rouge">cc_library</code> for <code class="highlighter-rouge">x86</code> for example, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //my/cc/jni:target --config=android_x86
</code></pre></div></div>

<p>In general, use this method for low-level targets (like <code class="highlighter-rouge">cc_library</code>) or when
you know exactly what you’re building; rely on the automatic configuration
transitions from <code class="highlighter-rouge">android_binary</code> for high-level targets where you’re expecting
to build a lot of targets you don’t control.</p>

        </div>
      </div>
    </div>

    <!-- Satisfaction Survey -->
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=oohdpic4fyfp3jcnym6aqkdf3e"></script>

        <footer class="footer">
      <div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-2">
      <p>About</p>
      <ul class="list-unstyled">
        <li><a href="https://github.com/bazelbuild/bazel/wiki/Bazel-Users">Who's Using Bazel?</a></li>
        <li><a href="https://www.bazel.build/roadmap.html">Roadmap</a></li>
        <li><a href="https://www.bazel.build/contributing.html">Contribute</a></li>
        <li><a href="https://www.bazel.build/governance.html">Governance Plan</a></li>
        <li><a href="https://policies.google.com/privacy">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Support</p>
      <ul class="list-unstyled">
        <li><a href="http://stackoverflow.com/questions/tagged/bazel">Stack Overflow</a></li>
        <li><a href="https://github.com/bazelbuild/bazel/issues">Issue Tracker</a></li>
        <li><a href="/">Documentation</a></li>
        <li><a href="https://www.bazel.build/faq.html">FAQ</a></li>
        <li><a href="https://www.bazel.build/support.html">Support Policy</a></li>
      </ul>
    </div>
    <div class="col-sm-4 col-md-2">
      <p>Stay Connected</p>
      <ul class="list-unstyled">
        <li><a href="https://twitter.com/bazelbuild">Twitter</a></li>
        <li><a href="https://blog.bazel.build">Blog</a></li>
        <li><a href="https://github.com/bazelbuild/bazel">GitHub</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/bazel-discuss">Discussion group</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <p class="text-muted">&copy; 2018 Google</p>
    </div>
  </div>
</div>

    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Anchor JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
    <script>
      // Automatically add anchors and links to all header elements that don't already have them.
      anchors.add();
    </script>

    <script>
      var shiftWindow = function() {
        if (location.hash.length !== 0) {
          window.scrollBy(0, -50);
        }
      };
      window.addEventListener("hashchange", shiftWindow);

      var highlightCurrentSidebarNav = function() {
        var href = location.pathname;
        var item = $('#sidebar-nav [href$="' + href + '"]');
        if (item) {
          var li = item.parent();
          li.addClass("active");

          if (li.parent() && li.parent().is("ul")) {
            do {
              var ul = li.parent();
              if (ul.hasClass("collapse")) {
                ul.collapse("show");
              }
              li = ul.parent();
            } while (li && li.is("li"));
          }
        }
      };

      $(document).ready(function() {
        // Scroll to anchor of location hash, adjusted for fixed navbar.
        window.setTimeout(function() {
          shiftWindow();
        }, 1);

        // Flip the caret when submenu toggles are clicked.
        $(".sidebar-submenu").on("show.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.addClass("dropup");
          }
        });
        $(".sidebar-submenu").on("hide.bs.collapse", function() {
          var toggle = $('[href$="#' + $(this).attr('id') + '"]');
          if (toggle) {
            toggle.removeClass("dropup");
          }
        });

        // Highlight the current page on the sidebar nav.
        highlightCurrentSidebarNav();
      });
    </script>

    <!-- Google Analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61082125-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>

